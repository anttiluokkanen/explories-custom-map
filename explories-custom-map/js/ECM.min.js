var ECM=function(_){"use strict";function W(){navigator.geolocation?J?D.panTo(J):(_("#myLocationBtn").prop("disabled",!0),_(".ecm-btn-location").prop("disabled",!0),_("#myLocationBtn").addClass("ecm-btn-loading"),_(".ecm-btn-location").addClass("ecm-btn-loading"),navigator.geolocation.getCurrentPosition(function(e){J={lat:e.coords.latitude,lng:e.coords.longitude},t=new google.maps.Marker({position:J,map:D,optimized:!1,icon:{path:"M-20,0a20,20 0 1,0 40,0a20,20 0 1,0 -40,0",fillColor:"#06c",fillOpacity:1,strokeWeight:2,strokeColor:"#ffffff",scale:.4},title:"Your location"}),D.getBounds().contains(J)||we(),_("#followUserCB").parent().show(),setTimeout(P,X.userPosInterval),_("#myLocationBtn").removeClass("ecm-btn-loading"),_("#myLocationBtn").hide(),_(".ecm-btn-location").removeClass("ecm-btn-loading"),_(".ecm-btn-location").prop("disabled",!1)},function(e){_("#myLocationBtn").removeClass("ecm-btn-loading"),_(".ecm-btn-location").removeClass("ecm-btn-loading"),_("#myLocationBtn").prop("disabled",!1),_(".ecm-btn-location").prop("disabled",!1),console.error("Getting user location failed: "+e)},{enableHighAccuracy:!0})):console.error("Unable to get user location because geolocation is not supported by browser.")}function G(r){var a=_("#"+r).parent();a.addClass("loading");var e=D.getBounds(),t=X.externalMarkers[r].url,n=X.initLocation.lat,o=X.initLocation.lat;D.getCenter().lat()&&(n=D.getCenter().lat(),o=D.getCenter().lng()),t=(t=(t=(t=(t=(t=(t=t.replace("{lat}",n)).replace("{lng}",o)).replace("{north}",e.getNorthEast().lat())).replace("{east}",e.getNorthEast().lng())).replace("{south}",e.getSouthWest().lat())).replace("{west}",e.getSouthWest().lng())).replace("{lan}",X.lan),k[r]&&k[r].abort(),k[r]=_.getJSON(t),k[r].done(function(e){a.removeClass("loading");var t=X.externalMarkers[r].callbackName;window.ECM[t].call(this,e,r)}),k[r].fail(function(e,t,a){"abort"!=a&&console.error("Loading "+r+" failed: "+t+", "+a)})}function f(t){R[t]=[];for(var e=0;e<H[t].length;e++){var a=H[t][e],r=X.externalMarkers[t].iconW,n=X.externalMarkers[t].iconH,o={lat:a.latitude,lng:a.longitude},i=new google.maps.Size(r,n);void 0!==r&&void 0!==n&&null!=r&&null!=n||(i=null);var l=new google.maps.MarkerImage(a.icon,null,null,null,i),s=new google.maps.Marker({index:parseInt(e),external:!0,id:a.id,name:a.name,position:o,map:D,icon:l,optimized:!0});s.addListener("click",function(){var e=H[t][this.index];g.setContent(Me(e)),g.open(D,this),google.maps.event.clearListeners(g,"domready"),e.name&&X.routing&&X.externalMarkers[e.name].slug&&X.externalMarkers[e.name].articleApiUrl&&g.addListener("domready",function(){_(".gm-style-iw .ecm-card").click(function(e){e.preventDefault();var t={view:"article",sourceSlug:_(this).attr("data-article-source"),articleId:_(this).attr("data-article-id"),articleSlug:_(this).attr("data-article-slug"),articleApiUrl:_(this).attr("data-article-api-url"),title:_(this).find("h1").text()};E(t),ie("",t.articleApiUrl)})})}),R[t].push(s)}ne(),0<_(".ecm-feed").length&&(se(!1),se(!0))}function h(a,r){var e=K[a][r],t=new google.maps.Polyline({path:e.waypoints,geodesic:!0,strokeColor:"#ffffff",strokeOpacity:1,strokeWeight:8}),n=new google.maps.Polyline({path:e.waypoints,geodesic:!0,strokeColor:e.polylineOptions.strokeColor,strokeOpacity:e.polylineOptions.strokeOpacity,strokeWeight:e.polylineOptions.strokeWeight});t.setMap(D),T[a][r]=t,n.setMap(D),L[a][r]=n,K[a][r].length=n.getLengthInMeters(),google.maps.event.addListener(n,"click",function(e){var t=K[a][r];g.setContent(Me(t)),g.setPosition(e.latLng),g.open(D)})}var n,c,p,D,e,o,g,J,t,a=document.getElementById("ecmScript"),v=a.src.replace(/js\/(ECM.js|ECM.min.js).*$/,""),r=a.src.replace(/explories-custom-map\/js\/(ECM.js|ECM.min.js).*$/,""),i=document.getElementById("ecm"),l="https://ecm.explories.net/themes/",s="default",V=v+"themes/"+s+"/",d=V+s+".css",m=V+"config.js",u=V+"images/map-cluster.svg",H={},K={},k=[],y=[],b=[],x=[],R={},q=null,C=[],w=[],M=[],S=[],L=[],T=[],Q=[],Y=[],I=null,$=!1,A={ecmMarkerClusterer:{id:"ecmMarkerClusterer",file:v+"vendor/markerclusterer-1.0.1/markerclusterer.min.js",elType:"script",loaded:!1}},X={baseTheme:null,themeName:null,routing:!1,ecmUrl:null,ecmTitle:null,markersUrl:"markers.json",routesUrl:"routes.json",lan:"fi",initLocation:{lat:60.169872,lng:24.938099},cardDefaultImg:V+"images/default-img.jpg",externalMarkers:null,mapDefaultTravelMode:"WALKING",mapInitZoom:10,mapMinZoom:0,mapMaxZoom:21,mapLayers:null,mapTypeId:"terrain",mapTypes:["roadmap","satellite","hybrid","terrain"],mapRouteMarkersThreshold:12,markerClustererOptions:{gridSize:56,zoomOnClick:!1,minimumClusterSize:2,textColor:"white",textSize:10,width:32,height:32},modes:null,offsetTop:"auto",offsetTopSel:"header",showBadgeFilters:!0,showMapFeedToggle:!0,showModeButtons:!0,showPrint:!1,showTagFilters:!0,showTypeFilters:!0,tagFiltersIcons:!0,usePlugin:!1,userPosInterval:5e3},ee={en:{badgeFiltersLegend:"Badges",hybrid:"Hybrid",mapLayers:"Map layers",mapSettings:"Map settings",mapType:"Map type",mapZoom:"Map zoom",marker:"Marker",myLocation:"My location",myLocationShow:"Show my location",myLocationCenter:"Center my location on map",roadmap:"Roadmap",route:"Route",satellite:"Satellite",shareArticle:"Share article",tagFiltersLegend:"Category",toggleTags:"Toggle all",typeFiltersLegend:"Type",terrain:"Terrain"},fi:{badgeFiltersLegend:"Badges",hybrid:"Hybridi",mapLayers:"Karttatasot",mapSettings:"Kartan asetukset",mapType:"Kartan tyyppi",mapZoom:"Kartan zoomaus",marker:"Kohde",myLocation:"Oma sijainti",myLocationShow:"Näytä sijaintini kartalla",myLocationCenter:"Keskitä kartta sijaintini mukaan",roadmap:"Tiekartta",route:"Reitti",satellite:"Satelliitti",shareArticle:"Jaa artikkeli",tagFiltersLegend:"Kategoria",toggleTags:"Valitse kaikki",typeFiltersLegend:"Tyyppi",terrain:"Maastokartta"}},te={markers:{id:1,name:"marker",show:!0},routes:{id:2,name:"route",show:!0}},O=function(){if(0!=Object.keys(A).length)for(var e in A)if(A.hasOwnProperty(e)){var t,a=A[e];if(0<_("#"+e).length)continue;"script"==a.elType?((t=document.createElement("script")).id=e,t.src=a.file,document.body.appendChild(t)):"link"==a.elType&&((t=document.createElement("link")).id=e,t.href=a.file,t.rel="stylesheet",document.body.appendChild(t)),t.onload=function(){Z(this.id)}}},Z=function(e){for(var t in A[e].loaded=!0,"ecmThemeConfig"==e&&1==X.usePlugin&&(A.ecmPluginConfig={id:"ecmPluginConfig",file:r+"assets/js/front.js",elType:"script",loaded:!1},O()),A)if(A.hasOwnProperty(t)&&!A[t].loaded)return!1;return n=X.initMode,i.getAttribute("data-offset-top")?(i.style.top=i.getAttribute("data-offset-top"),X.offsetTop=i.getAttribute("data-offset-top")):"auto"==X.offsetTop&&null!=X.offsetTopSel?(ze(),_(window).resize(function(){ze()})):null!=X.offsetTop&&(document.getElementById("ecm").style.top=X.offsetTop),_e&&(localStorage.getItem("lat")&&localStorage.getItem("lng")&&(X.initLocation.lat=parseFloat(localStorage.getItem("lat")),X.initLocation.lng=parseFloat(localStorage.getItem("lng"))),localStorage.getItem("mapInitZoom")&&(X.mapInitZoom=parseInt(localStorage.getItem("mapInitZoom"))),localStorage.getItem("types")&&(te=JSON.parse(localStorage.getItem("types")))),X.baseTheme&&(i.className=X.baseTheme),F(),!0},F=function(){e=document.getElementById("ecmMap"),o={center:X.initLocation,zoom:X.mapInitZoom,minZoom:X.mapMinZoom,maxZoom:X.mapMaxZoom,zoomControl:!1,scaleControl:!0,mapTypeId:X.mapTypeId,streetViewControl:!1,fullscreenControl:!1,mapTypeControl:!1,gestureHandling:"greedy",styles:X.modes[X.initMode].styles},D=new google.maps.Map(e,o),g=new google.maps.InfoWindow({maxWidth:320,content:""}),google.maps.event.addListener(g,"content_changed",function(){var e;"function"!=typeof doGTranslate||"function"!=typeof GTranslateGetCurrentLang||(e=GTranslateGetCurrentLang())&&doGTranslate(e)}),D.addListener("zoom_changed",function(){ge(),_("#zoom").val(D.getZoom()),_("#zoomVal").text(D.getZoom()),me(),_e&&localStorage.setItem("mapInitZoom",D.getZoom())}),D.addListener("idle",function(){for(var e in X.externalMarkers)X.externalMarkers.hasOwnProperty(e)&&X.externalMarkers[e].reloadOnBoundsChange&&_("#"+e).prop("checked")&&_("#"+e).trigger("change");_e&&(localStorage.setItem("lat",D.getCenter().lat()),localStorage.setItem("lng",D.getCenter().lng()))}),D.addListener("click",function(e){g.close()}),google.maps.LatLng.prototype.kmTo=function(e){var t=Math,a=t.PI/180,r=this.lat()*a,n=e.lat()*a,o=r-n,i=this.lng()*a-e.lng()*a;return 6378.137*(2*t.asin(t.sqrt(t.pow(t.sin(o/2),2)+t.cos(r)*t.cos(n)*t.pow(t.sin(i/2),2))))},google.maps.Polyline.prototype.getLengthInMeters=function(e){for(var t=this.getPath(e),a=t.getLength(),r=0,n=0;n<a-1;n++)r+=t.getAt(n).kmTo(t.getAt(n+1));return 1e3*r},google.maps.event.addListenerOnce(D,"idle",function(){Se(),U(),z()})},P=function(){navigator.geolocation.getCurrentPosition(function(e){J={lat:e.coords.latitude,lng:e.coords.longitude},t.setPosition(J),$&&D.panTo(J),setTimeout(P,X.userPosInterval)},function(e){console.error("Updating user location failed.")},{enableHighAccuracy:!0})},U=function(){if(Pe(),null===X.markersUrl)return c=[],void(Array.isArray(p)&&B());var e=_.getJSON(X.markersUrl);e.done(function(e){c=e,j(),N(c),Array.isArray(p)&&B()}),e.fail(function(e,t,a){console.error("Loading markers failed: "+t+", "+a)})},z=function(){if(Pe(),null===X.routesUrl)return p=[],void(Array.isArray(c)&&B());var e=_.getJSON(X.routesUrl);e.done(function(e){for(var t in p=e){var a;je(p[t])?p[t].travelMode?(a=Ce(p[t]),ce(t,a,p[t].polylineOptions)):ke(t):p.splice(t,1)}N(p),Array.isArray(c)&&B()}),e.fail(function(e,t,a){console.error("Loading routes failed: "+t+", "+a)})},B=function(){var e,t,a,r,n;pe(),Le(),Te(),Fe(),i.getAttribute("data-feed")?(_("#ecmSettingsBtn").trigger("click"),_("#feedCB").trigger("click")):setTimeout(function(){_("#ecmSettingsBtn").trigger("click")},500),i.getAttribute("data-article")&&i.getAttribute("data-article-api-url")?ie(i.getAttribute("data-article"),i.getAttribute("data-article-api-url")):i.getAttribute("data-article")&&ie(i.getAttribute("data-article"),null),X.routing&&(n=(n=window.location.href).replace(X.ecmUrl,""),je(n)&&"/"!=n&&(e=n.split("/"),(r=_.isNumeric(e[0])?(a=parseInt(e[0]),We(a)):(t=e[0],a=e[1],Ge(t)))&&(r=r.replace("{id}",a),ie("",r)))),Ue()},N=function(t){for(var a=0;a<t.length;a++){if(t[a].tags&&null!=t[a].tags)for(var r=0;r<t[a].tags.length;r++){Q.some(function(e){return e.id===t[a].tags[r].id})||Q.push(t[a].tags[r])}if(t[a].badges&&null!=t[a].badges)for(var n=0;n<t[a].badges.length;n++){Y.some(function(e){return e.id===t[a].tags[n].id})||Y.push(t[a].badges[n])}}},ae=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)e[t].setMap(null);return[]},j=function(){if(x=ae(x),te.markers.show){for(var e in c){var t,a,r;ve(c[e])&&(null===I||null!==I&&!he(c[e])||(t={lat:c[e].latitude,lng:c[e].longitude},Ne(c[e].icon)||(c[e].icon=V+"images/markers/"+c[e].icon),a=new google.maps.MarkerImage(c[e].icon,null,null,null,new google.maps.Size(32,32)),(r=new google.maps.Marker({index:parseInt(e),id:c[e].id,position:t,map:D,icon:a,optimized:!0})).addListener("click",function(){var e=c[this.index];g.setContent(Me(e)),g.open(D,this),google.maps.event.clearListeners(g,"domready"),X.routing&&e.slug&&e.articleApiUrl&&g.addListener("domready",function(){_(".gm-style-iw .ecm-card").click(function(e){e.preventDefault();var t={view:"article",sourceSlug:_(this).attr("data-article-source"),articleId:_(this).attr("data-article-id"),articleSlug:_(this).attr("data-article-slug"),articleApiUrl:_(this).attr("data-article-api-url"),title:_(this).find("h1").text()};E(t),ie("",t.articleApiUrl)})})}),x.push(r)))}ne()}},E=function(e){var t;X.routing&&(t="",e.sourceSlug&&(t=e.sourceSlug+"/"),e.articleId&&(t+=e.articleId+"/"),e.articleSlug&&(t+=e.articleSlug+"/"),""==t&&(t=X.ecmUrl),history.pushState(e,"",t),re(e))},re=function(e){e.title?_("title").text(e.title+" - "+X.ecmTitle):_("title").text(X.ecmTitle)},ne=function(){null!==q&&q.clearMarkers();var e=[{textColor:X.markerClustererOptions.textColor,textSize:X.markerClustererOptions.textSize,url:u,width:X.markerClustererOptions.width,height:X.markerClustererOptions.height}],t={gridSize:X.markerClustererOptions.gridSize,zoomOnClick:X.markerClustererOptions.zoomOnClick,minimumClusterSize:X.markerClustererOptions.minimumClusterSize,styles:e},a=Ie();try{q=new MarkerClusterer(D,x.concat(w,a),t)}catch(e){throw alert("Unable to load MarkerClusterer. If you are using private browsing please disable it."),new Error("MarkerClusterer is undefined. Probably caused by private browsing mode.")}google.maps.event.addListener(q,"clusterclick",function(e){oe(e.getMarkers())})},oe=function(e){var t=_('<div class="ecm-cards-container"></div>');t.click(function(){t.remove(),_("#ecmSettingsBtn").show()});for(var a=Oe({icon:"icon-close.svg",name:"close",onClick:function(){t.remove(),_("#ecmSettingsBtn").show()},size:32}),r=_('<div class="ecm-cards"></div>'),n=0;n<e.length;n++){var o=e[n].index,i=c[o];e[n].external&&(i=H[e[n].name][o]),e[n].route&&(i=p[o]),r.append(Me(i))}r.find(".ecm-card").click(function(e){var t;e.stopPropagation(),_(this).attr("data-article-api-url")&&(e.preventDefault(),t={view:"article",sourceSlug:_(this).attr("data-article-source"),articleId:_(this).attr("data-article-id"),articleSlug:_(this).attr("data-article-slug"),articleApiUrl:_(this).attr("data-article-api-url"),title:_(this).find("h1").text()},E(t),ie("",t.articleApiUrl))}),t.append(a),t.append(r),_("#ecm").append(t),Fe(),_("#ecmSettingsBtn").hide(),E({view:"cluster"})},ie=function(e,t){var a=null!=t?t:"https://explori.es/api/news/";_(".ecm-article-container").remove();var d=_('        <div class="ecm-article-container">            <div class="ecm-article">                <div class="ecm-loader"></div>            </div>        </div>'),r=Oe({icon:"icon-close.svg",name:"close-article",size:48});r.css("top",_("#ecm").css("top")),d.prepend(r),d.click(le),_("#ecm").append(d),Fe();var n=_.getJSON(a+e);n.done(function(e){var t=_('<div class="ecm-article-logo"></div>'),a=_('<div class="ecm-article-img"></div>'),r=_('<div class="ecm-article-img-caption"></div>'),n=_("<h1>"+e.title+"</h1>"),o=_('<div class="ecm-article-body"></div>');e.text?o.html(e.text):e.content&&o.html(e.content),void 0!==e.publication&&je(e.publication.image)&&(t.css("background-image","url('"+e.publication.image+"')"),je(e.publication.themeColor)&&t.css("background-color",e.publication.themeColor),_(".ecm-article").append(t)),e.caption&&je(e.caption)&&(r.append("<p>"+e.caption+"</p>"),a.append(r)),void 0!==e.images&&je(e.images.large)?(a.css("background-image","url('"+e.images.large+"')"),_(".ecm-article").append(a)):je(e.image)&&(a.css("background-image","url('"+e.image+"')"),_(".ecm-article").append(a)),o.prepend(n);var i=_('<div class="ecm-article-info"></div>'),l="";e.authors&&je(e.authors)?l=e.authors:e.user&&je(e.user.name)&&(l=e.user.name),je(l)&&i.append('<p class="ecm-article-author">'+l+"</p>"),i.append('<p class="ecm-article-datetime">'+Ee(e.published)+"</p>"),o.prepend(i),d.find(".ecm-article").append(o),_(".ecm-article").click(function(e){e.stopPropagation()});var s=_('            <ul class="ecm-share">                <li><a href="#" class="ecm-icon-facebook" target="_blank"><span class="sr-only">Share on Facebook</span></a></li>                <li><a href="#" class="ecm-icon-twitter" target="_blank"><span class="sr-only">Share on Twitter</span></a></li>                <li><a href="#" class="ecm-icon-linkedin" target="_blank"><span class="sr-only">Share on LinkedIn</span></a></li>            </ul>            '),c=encodeURIComponent(window.location.href);s.find(".ecm-icon-facebook").attr("href","https://www.facebook.com/sharer.php?u="+c),s.find(".ecm-icon-twitter").attr("href","https://twitter.com/share?url="+c),s.find(".ecm-icon-linkedin").attr("href","https://www.linkedin.com/cws/share?url="+c),d.find(".ecm-article").append('<h2 class="ecm-share-h">'+ee[X.lan].shareArticle+"</h2>"),d.find(".ecm-article").append(s),d.find(".ecm-loader").remove(),!1===e.allowTranslate&&d.addClass("notranslate")}),n.fail(function(e,t,a){console.error("Loading Explories article failed: "+t+", "+a)})},le=function(){_(".ecm-article-container").remove(),X.routing&&E({})},se=function(e){if(e){var t=_('<div class="ecm-cards-container ecm-feed ecm-feed-condensed"></div>'),a=_('<div class="ecm-cards"></div>');if(te.routes.show)for(var r in p)ve(p[r])&&(null===I||he(p[r]))&&je(p[r].url)&&a.append(Me(p[r]));for(var n=Ie(),o=x.concat(n),i=0;i<o.length;i++){var l=o[i].index,s=c[l];o[i].external&&(s=H[o[i].name][l]),je(s.url)&&a.append(Me(s))}a.find(".ecm-card").click(function(e){var t;e.stopPropagation(),_(this).attr("data-article-api-url")&&(e.preventDefault(),t={view:"article",sourceSlug:_(this).attr("data-article-source"),articleId:_(this).attr("data-article-id"),articleSlug:_(this).attr("data-article-slug"),articleApiUrl:_(this).attr("data-article-api-url"),title:_(this).find("h1").text()},E(t),ie("",t.articleApiUrl))}),t.append(a),_("#ecm").append(t)}else _(".ecm-feed").remove()},ce=function(r,e,n){y[r]=new google.maps.DirectionsService,b[r]=new google.maps.DirectionsRenderer({routeIndex:Date.now(),suppressPolylines:!0,suppressMarkers:D.getZoom()<X.mapRouteMarkersThreshold,suppressInfoWindows:!1,preserveViewport:!0,markerOptions:{icon:{path:"M-20,0a20,20 0 1,0 40,0a20,20 0 1,0 -40,0",fillColor:n.strokeColor,fillOpacity:1,strokeWeight:2,strokeColor:"#ffffff",scale:.4}}}),b[r].setMap(D),y[r].route(e,function(e,t){var a;"OK"===t?(b[r].setDirections(e),a=e.routes[0],p[r].length=be(a),p[r].duration=xe(a),C[r]=e,ye(r,e,n)):console.error("Directions request failed due to "+t)})},de=function(e){if(L[e])for(var t=0;t<L[e].length;t++)L[e][t].setMap(null),T[e][t].setMap(null)},pe=function(){if(!function(){ae(w);for(var e=0;e<M.length;e++)if(Array.isArray(M[e])){for(var t=0;t<M[e].length;t++)M[e][t].setMap(null);b[e].setMap(null)}else M[e]&&M[e].setMap(null),S[e]&&S[e].setMap(null)}(),ae(w),w=[],te.routes.show){for(var e,t,a,r,n=0;n<p.length;n++){ve(p[n])&&(null===I||null!==I&&!he(p[n])||(p[n].travelMode?ye(n,C[n],p[n].polylineOptions):(ke(n),je(p[n].icon)&&(e={lat:p[n].latitude,lng:p[n].longitude},Ne(p[n].icon)||(p[n].icon=V+"images/markers/"+p[n].icon),t=new google.maps.MarkerImage(p[n].icon,null,null,null,new google.maps.Size(32,32)),a=new google.maps.Marker({index:parseInt(n),id:p[n].id,position:e,map:D,icon:t,optimized:!0,route:!0}),r=n,a.addListener("click",function(e){var t=p[r];g.setContent(Me(t)),g.setPosition(e.latLng),g.open(D)}),w.push(a)))))}ge()}},ge=function(){for(var e in b)void 0!==M[e]&&null!==M[e][0].getMap()&&(b[e].setOptions({suppressMarkers:D.getZoom()<X.mapRouteMarkersThreshold}),b[e].setMap(D))},me=function(){if(X.mapLayers)for(var e=0;e<X.mapLayers.length;e++){var t=X.mapLayers[e];if(!t.minZoom||!t.maxZoom)return;var a=t.minZoom>D.getZoom()||t.maxZoom<D.getZoom();_("#ecmFiltersLayers input:eq("+e+")").prop("disabled",a)}},ue=function(){D.overlayMapTypes.setAt(0,null),_("#zoom").attr("min",X.mapMinZoom),_("#zoom").attr("max",X.mapMaxZoom),D.setOptions({minZoom:X.mapMinZoom,maxZoom:X.mapMaxZoom}),_e&&localStorage.removeItem("mapLayer")},fe=function(){I={tags:[],badges:[]},_("#ecmFiltersTags .ecm-checkbox:not(.ecm-toggle-all)").each(function(){_(this).prop("checked")?I.tags.push(parseInt(_(this).val())):_("#toggleTagsCB").prop("checked",!1)}),_("#ecmFiltersBadges .ecm-checkbox").each(function(){_(this).prop("checked")&&I.badges.push(parseInt(_(this).val()))}),0==I.tags.length&&0==I.badges.length&&(I=null),_e&&localStorage.setItem("filters",JSON.stringify(I)),j(),pe(),ne(),0<_(".ecm-feed").length&&(se(!1),se(!0))},he=function(e){var t,a,r=!1;return e.tags&&(t=_.map(e.tags,function(e){return e.id}),r=Be(I.tags,t)),e.badges&&(a=_.map(e.badges,function(e){return e.id}),r=r&&Be(I.badges,a)),r},ve=function(e){return!e.modes||-1!=e.modes.indexOf(n)},ke=function(a){var e,t,r=p[a];Array.isArray(r.waypoints)&&(e=new google.maps.Polyline({path:r.waypoints,geodesic:!0,strokeColor:"#ffffff",strokeOpacity:1,strokeWeight:8}),t=new google.maps.Polyline({path:r.waypoints,geodesic:!0,strokeColor:r.polylineOptions.strokeColor,strokeOpacity:r.polylineOptions.strokeOpacity,strokeWeight:r.polylineOptions.strokeWeight}),e.setMap(D),S[a]=e,t.setMap(D),M[a]=t,p[a].length=t.getLengthInMeters(),google.maps.event.addListener(t,"click",function(e){var t=p[a];g.setContent(Me(t)),g.setPosition(e.latLng),g.open(D)}))},ye=function(a,e,t){for(var r=[],n=e.routes[0].legs,o=0;o<n.length;o++)for(var i=n[o].steps,l=0;l<i.length;l++){for(var s=i[l].path,c=new google.maps.Polyline(t),d=0;d<s.length;d++)c.getPath().push(s[d]);r.push(c),c.setMap(D),google.maps.event.addListener(c,"click",function(e){var t=p[a];g.setContent(Me(t)),g.setPosition(e.latLng),g.open(D)})}M[a]=r},be=function(e){for(var t=0,a=0;a<e.legs.length;++a)t+=e.legs[a].distance.value;return t},xe=function(e){for(var t=0,a=0;a<e.legs.length;++a)t+=e.legs[a].duration.value;return t},Ce=function(e){var t=e.waypoints[0],a=e.waypoints[e.waypoints.length-1],r=new google.maps.LatLng(t.lat,t.lng),n=new google.maps.LatLng(a.lat,a.lng),o=[];e.waypoints.shift(),e.waypoints.pop();for(var i=0;i<e.waypoints.length;i++)o.push({location:new google.maps.LatLng(e.waypoints[i].lat,e.waypoints[i].lng)});return void 0===e.travelMode&&(e.travelMode=X.mapDefaultTravelMode),{origin:r,destination:n,waypoints:o,optimizeWaypoints:!0,travelMode:e.travelMode}},we=function(){D.setZoom(D.getZoom()-1),google.maps.event.addListenerOnce(D,"idle",function(){D.getBounds().contains(J)||we()})},Me=function(e){var t,a,r,n,o,i,l,s,c,d=_('<div class="ecm-card-wrapper text-center"></div>'),p=_('<a class="ecm-card"></a>');if(e.external&&(p.addClass("ecm-card-external"),!e.articleApiUrl&&je(e.url)&&p.append('<div class="ecm-card-external-icon"></div>'),e.logo&&(a=_('<div class="ecm-card-logo" style="background-image:url(\''+e.logo+"');\"></div>"),e.color&&a.css("background-color",e.color),p.append(a))),e.url?(p.attr("href",e.url),e.target&&p.attr("target",e.target)):e.articleApiUrl?p.attr("href","#"):p.addClass("ecm-card-no-link"),(e.image||je(X.cardDefaultImg))&&(r=_('<div class="ecm-card-img-container"></div>'),n=_('<div class="ecm-card-img"></div>'),e.image?(Ne(e.image)||(e.image=v+e.image),n.css("background-image","url('"+e.image+"')")):(n.css("background-image","url('"+X.cardDefaultImg+"')"),n.addClass("ecm-default-img")),r.append(n),p.append(r)),(e.badges||e.length)&&(o=_('<div class="ecm-card-info"></div>')),e.badges&&Array.isArray(e.badges))for(var g=0;g<e.badges.length;g++){var m=_('<span class="ecm-card-badge">'+e.badges[g].name+"</span>");m.addClass("ecm-card-badge-"+e.badges[g].id),o.append(m)}if(e.length&&(i=_('<span class="ecm-card-length">'+(e.length/1e3).toFixed(2)+" km</span>"),o.append(i)),(e.badges||e.length)&&p.append(o),e.title&&(l=_("<h1>"+e.title+"</h1>"),p.append(l)),e.description&&(s=_("<p>"+e.description+"</p>"),p.append(s)),e.tags&&Array.isArray(e.tags)){for(var u=_('<div class="ecm-card-tags"></div>'),f=0;f<e.tags.length;f++){Ne(e.tags[f].icon)||(e.tags[f].icon=V+"images/markers/"+e.tags[f].icon);var h=_("<img />");h.attr("src",e.tags[f].icon),h.attr("alt",e.tags[f].name),u.append(h)}p.append(u)}return X.routing&&e.slug&&e.articleApiUrl&&(t=e.articleApiUrl.replace("{id}",e.id),p.attr("data-article-api-url",t),p.attr("data-article-id",e.id),p.attr("data-article-slug",e.slug)),e.name&&X.routing&&X.externalMarkers[e.name].slug&&X.externalMarkers[e.name].articleApiUrl&&(t=X.externalMarkers[e.name].articleApiUrl.replace("{id}",e.id),p.attr("data-article-api-url",t),p.attr("data-article-source",X.externalMarkers[e.name].slug),p.attr("data-article-id",e.id),p.attr("data-article-slug",e.slug)),X.externalMarkers&&X.externalMarkers[e.name]&&!1===X.externalMarkers[e.name].allowTranslate&&p.addClass("notranslate"),d.append(p),e.hasGpx&&(c=_('<a target="_blank" href="https://locations.explories.net/api/routes/'+e.id+'/gpx" class="ecm-btn gpx-button"><img src="'+v+'images/icon-download.svg" style="width: 24px; height: 24px; vertical-align: middle;" />GPX</a>'),d.append(c)),d[0].outerHTML},Se=function(){if(X.showModeButtons&&void 0!==X.modes&&null!==X.modes){var e,t,a=_('<div class="ecm-mode-buttons"></div>');for(var r in X.modes){X.modes.hasOwnProperty(r)&&(e=X.modes[r],(t=_('<button type="button" class="ecm-btn">'+ee[X.lan][r]+"</button>")).attr("id","ecm"+r.charAt(0).toUpperCase()+r.slice(1)+"Btn"),t.attr("data-id",e.id),t.attr("data-mode",r),t.addClass("ecm-btn-"+r),r==X.initMode&&t.addClass("ecm-btn-active"),t.click(function(){var e;_(".ecm-mode-buttons .ecm-btn").removeClass("ecm-btn-active"),_(this).addClass("ecm-btn-active"),e=_(this).attr("data-mode"),void 0!==X.modes[e]?(n=e,o=X.modes[e].styles,D.setOptions({styles:o}),j(),pe()):console.error("Invalid mode")}),a.append(t))}_("#ecm").append(a)}},Le=function(){var e,t=_('<div class="ecm-map-controls"></div>');X.showPrint&&(e=Oe({icon:"icon-print.svg",name:"print",onClick:function(){window.print()},size:32}),t.append(e));var a=Oe({icon:"icon-location.svg",name:"location",onClick:function(){W()},size:32}),r=Oe({icon:"icon-plus.svg",name:"zoom-in",onClick:function(){D.setZoom(D.getZoom()+1)},size:32}),n=Oe({icon:"icon-minus.svg",name:"zoom-out",onClick:function(){D.setZoom(D.getZoom()-1)},size:32});t.append(a),t.append(r),t.append(n),_("#ecm").append(t)},Te=function(){var e=Oe({icon:["icon-settings.svg"],id:"ecmSettingsBtn",name:"settings",onClick:function(){_("#ecmSettings").toggleClass("ecm-panel-open"),_(".ecm-feed").toggleClass("ecm-feed-condensed")},size:32});_("#ecm").append(e);var t,a=_('<div id="ecmSettings" class="ecm-panel ecm-panel-settings notranslate"></div>'),r=Oe({icon:["icon-close.svg"],id:"ecmCloseSettingsBtn",name:"settings-close",onClick:function(){_("#ecmSettings").toggleClass("ecm-panel-open"),_(".ecm-feed").toggleClass("ecm-feed-condensed")},size:32});if(a.append(r),X.showMapFeedToggle&&(t=Ze({id:"feedCB",className:"ecm-switch",groupClass:"ecm-switch-group",label:"Feed",labelPre:"Map",onChange:function(){se(_(this).prop("checked"))}}),a.append(t)),X.showTypeFilters){var n,o,i,l=_('<fieldset id="ecmFiltersTypes" class="ecm-filters"></fieldset>');for(var s in l.append("<legend>"+ee[X.lan].typeFiltersLegend+"</legend>"),te){te.hasOwnProperty(s)&&(n=te[s],o=!0,_e&&je(localStorage.getItem("types"))&&0==JSON.parse(localStorage.getItem("types"))[s].show&&(o=!1),i=Ze({id:"typeCB_"+n.id,checked:o,label:ee[X.lan][n.name],onChange:function(){!function(){_("#ecmFiltersTypes .ecm-checkbox").each(function(){var e=_(this).val();te[e].show=_(this).is(":checked")}),te.markers.show||q.clearMarkers(),_("#ecmFiltersBadges").prop("disabled",!te.routes.show),_("#ecmFiltersBadges .ecm-checkbox").prop("disabled",!te.routes.show);var e=!te.markers.show&&!te.routes.show;_("#ecmFiltersTags").prop("disabled",e),_("#ecmFiltersTags .ecm-checkbox").prop("disabled",e),_e&&localStorage.setItem("types",JSON.stringify(te)),fe()}()},value:s}),l.append(i))}a.append(l)}if(X.showTagFilters){var c=_('<fieldset id="ecmFiltersTags" class="ecm-filters"></fieldset>');c.append("<legend>"+ee[X.lan].tagFiltersLegend+"</legend>");var d=Ze({id:"toggleTagsCB",className:"ecm-toggle-all",groupClass:"ecm-toggle-tags-group",checked:!0,label:ee[X.lan].toggleTags,onChange:function(){_("#ecmFiltersTags .ecm-checkbox").prop("checked",_(this).prop("checked")),fe()}});X.tagFiltersIcons&&d.addClass("ecm-toggle-all-icon"),c.append(d);for(var p=0;p<Q.length;p++){var g=Q[p],m=!0;_e&&je(localStorage.getItem("filters"))&&"null"!=localStorage.getItem("filters")&&-1==JSON.parse(localStorage.getItem("filters")).tags.indexOf(g.id)&&(m=!1);var u=Ze({id:"tagCB_"+g.id,checked:m,label:Q[p].name,onChange:fe,value:g.id});X.tagFiltersIcons&&(u.addClass("ecm-form-group-cb-icon"),Ne(g.icon)?u.css("background-image","url('"+g.icon+"')"):u.css("background-image","url('"+V+"images/markers/"+g.icon+"')")),c.append(u)}a.append(c)}if(Array.isArray(X.externalMarkersSets)&&0<X.externalMarkersSets.length)for(var f=0;f<X.externalMarkersSets.length;f++){var h,v,k,y=X.externalMarkersSets[f],b="ecmFiltersExternalMarkers"+y.id[0].toUpperCase()+y.id.substring(1),x=_('<fieldset id="'+b+'" class="ecm-filters"></fieldset>');for(var C in x.append("<legend>"+ee[X.lan][y.id]+"</legend>"),y.showToggleAll&&(h=Ze({id:"toggleExternal"+y.id+"CB",className:"ecm-toggle-all",groupClass:"ecm-toggle-tags-group",checked:!0,label:ee[X.lan].toggleTags,onChange:function(){var e=_(this).parent().parent();_(e).find(".ecm-checkbox:not(.ecm-toggle-all)").prop("checked",_(this).prop("checked")),_(e).find(".ecm-checkbox:not(.ecm-toggle-all)").trigger("change")}}),X.tagFiltersIcons&&h.addClass("ecm-toggle-all-icon"),x.append(h)),X.externalMarkers){X.externalMarkers.hasOwnProperty(C)&&X.externalMarkers[C].set==y.id&&(v=X.externalMarkers[C].checked,_e&&je(localStorage.getItem(C))&&(v=JSON.parse(localStorage.getItem(C))),k=Ze({id:C,label:ee[X.lan][C],checked:v,onChange:function(){var e,t=_(this).parent().parent();_(this).prop("checked")?(G(_(this).attr("id")),_(t).find(".ecm-checkbox:not(.ecm-toggle-all):checked").length==_(t).find(".ecm-checkbox:not(.ecm-toggle-all)").length&&_(t).find(".ecm-toggle-all").prop("checked",!0)):(e=_(this).attr("id"),delete H[e],R[e]=ae(R[e]),delete R[e],ne(),delete K[e],de(e),0<_(".ecm-feed").length&&(se(!1),se(!0)),_(t).find(".ecm-toggle-all").prop("checked",!1)),_e&&localStorage.setItem(_(this).attr("id"),_(this).prop("checked"))},value:C}),X.tagFiltersIcons&&(k.addClass("ecm-form-group-cb-icon"),k.css("background-image","url('"+X.externalMarkers[C].filtersIcon+"')")),y.showToggleAll&&!X.externalMarkers[C].checked&&x.find(".ecm-toggle-all").prop("checked",!1),x.append(k))}a.append(x)}if(X.showBadgeFilters&&0<Y.length){var w=_('<fieldset id="ecmFiltersBadges" class="ecm-filters"></fieldset>');w.append("<legend>"+ee[X.lan].badgeFiltersLegend+"</legend>");for(f=0;f<Y.length;f++){var M=Y[f],S=!0;_e&&je(localStorage.getItem("filters"))&&"null"!=localStorage.getItem("filters")&&-1==JSON.parse(localStorage.getItem("filters")).badges.indexOf(M.id)&&(S=!1);var L=Ze({id:"badgeCB_"+M.id,checked:S,label:Y[f].name,onChange:fe,value:M.id});w.append(L)}a.append(w)}var T=_('<fieldset id="ecmFiltersMapSettings" class="ecm-filters"></fieldset>');T.append("<legend>"+ee[X.lan].mapSettings+"</legend>");var I=_('<div class="ecm-form-group"></div>');I.append('<label for="mapType">'+ee[X.lan].mapType+"</label><br />");for(var A,O,Z=_('<select id="mapType"></select>'),F=0;F<X.mapTypes.length;F++){var P=X.mapTypes[F],U=_("<option></option>");U.attr("value",P),U.text(ee[X.lan][P]),X.mapTypeId==P&&U.prop("selected",!0),Z.append(U)}if(je(X.mapLayers))for(var z in X.mapLayers){X.mapLayers.hasOwnProperty(z)&&(A=X.mapLayers[z].checked,_e&&localStorage.getItem("mapLayer")==X.mapLayers[z].name&&(A=!0),(O=_("<option></option>")).attr("value",z),O.text(ee[X.lan][X.mapLayers[z].name]),A&&O.prop("selected",!0),Z.append(O))}I.append(Z),Z.change(function(){var e,t,a,d,p;-1!=X.mapTypes.indexOf(_(this).val())?(ue(),D.setOptions({mapTypeId:_(this).val()}),_e&&localStorage.setItem("mapTypeId",_(this).val())):(e=_(this).val(),t=!0,d=X.mapLayers[e],p=new google.maps.LatLngBounds(new google.maps.LatLng(d.bounds[1],d.bounds[0]),new google.maps.LatLng(d.bounds[3],d.bounds[2])),t?(_("#ecmFiltersLayers").addClass("loading"),_("#ecmFiltersLayers .ecm-checkbox").each(function(){_(this).val()!=e&&_(this).prop("checked",!1)}),D.overlayMapTypes.setAt(0,null),X.mapMinZoom<d.minZoom&&(_("#zoom").attr("min",d.minZoom),D.setOptions({minZoom:d.minZoom})),X.mapMaxZoom>d.maxZoom&&(_("#zoom").attr("max",d.maxZoom),D.setOptions({maxZoom:d.maxZoom})),(a=new google.maps.ImageMapType({name:d.name,minZoom:d.minZoom,maxZoom:d.maxZoom,tileSize:new google.maps.Size(256,256),isPng:!0,opacity:1,getTileUrl:function(e,t){var a=D.getProjection(),r=Math.pow(2,t),n=256/r,o=256/r,i=new google.maps.LatLngBounds(a.fromPointToLatLng(new google.maps.Point(e.x*n,(e.y+1)*o)),a.fromPointToLatLng(new google.maps.Point((e.x+1)*n,e.y*o))),l=0<=e.x?e.x:r+e.x,s=e.y;if(p.intersects(i)&&t>=d.minZoom&&t<=d.maxZoom){var c=d.url.replace("{zoom}",t);return c=(c=c.replace("{x}",l)).replace("{y}",s)}}})).addListener("tilesloaded",function(){_("#ecmFiltersLayers").removeClass("loading")}),D.overlayMapTypes.insertAt(0,a),_e&&localStorage.setItem("mapLayer",d.name)):ue())}),T.append(I);var B=_('<div class="ecm-form-group"></div>');B.append('<label for="zoom">'+ee[X.lan].mapZoom+"</label><br />"),B.append('<div class="ecm-range-labels"><span class="pull-left">-</span><span id="zoomVal">'+D.getZoom()+'</span><span class="pull-right">+</span></div>');var N=_('<input id="zoom" type="range" step="1" />');N.attr("min",X.mapMinZoom),N.attr("max",X.mapMaxZoom),B.append(N),N.val(D.getZoom()),N.on("input",function(){D.setZoom(parseInt(_(this).val())),_("#zoomVal").text(_(this).val())}),T.append(B);var j=Oe({id:"myLocationBtn",icon:"icon-location.svg",name:"location",className:"ecm-btn-icon-text ecm-btn-block",text:ee[X.lan].myLocationShow,onClick:function(){W()}}),E=Ze({id:"followUserCB",checked:$,label:ee[X.lan].myLocationCenter,onChange:function(){($=_(this).prop("checked"))&&D.panTo(J)}});for(var C in E.hide(),T.append(j),T.append(E),a.append(T),_("#ecm").append(a),fe(),X.externalMarkers)X.externalMarkers.hasOwnProperty(C)&&_("#"+C).prop("checked")&&G(C);_("#mapType").trigger("change")},Ie=function(){var e=[];for(var t in R)if(R.hasOwnProperty(t))for(var a=0;a<R[t].length;a++)e.push(R[t][a]);return e},Ae=function(e){var t=[];if(Array.isArray(e))for(var a=0;a<e.length;a++)t.push({lat:e[a][1],lng:e[a][0]});return t},Oe=function(e){var t={className:null,disabled:!1,icon:null,id:null,name:null,onClick:null,size:null,text:null,tooltip:null};_.extend(t,e);var a,r=_('<button type="button" class="ecm-btn"></button>');if(t.disabled&&r.prop("disabled",!0),t.id&&r.attr("id",t.id),t.size&&r.addClass("ecm-btn-"+t.size),t.name&&r.addClass("ecm-btn-"+t.name),t.className&&r.addClass(t.className),t.icon)if(Array.isArray(t.icon))for(var n=0;n<t.icon.length;n++)a=_('<svg data-src="'+v+"images/"+t.icon[n]+'"></svg>'),r.append(a);else a=_('<svg data-src="'+v+"images/"+t.icon+'"></svg>'),r.append(a);return t.text&&r.append(t.text),t.onClick&&r.click(t.onClick),r},Ze=function(e){var t={checked:!1,className:null,data:null,groupClass:null,id:null,label:null,labelPre:null,name:null,onChange:null,tooltip:null,value:null};_.extend(t,e);var a,r=_('<div class="ecm-form-group-cb"></div>');t.labelPre&&((a=_("<label></label>")).text(t.labelPre),r.append(a));var n,o=_('<input type="checkbox" class="ecm-checkbox" />');if(o.attr("id",t.id),o.attr("value",t.value),t.name&&o.attr("name",t.name),t.className&&o.addClass(t.className),t.groupClass&&r.addClass(t.groupClass),t.data)for(var i=0;i<t.data.length;i++)o.attr("data-"+t.data[i].name,t.data[i].value);return t.checked&&o.prop("checked",!0),t.onChange&&o.change(t.onChange),r.append(o),t.label&&((n=_("<label></label>")).text(t.label),n.attr("for",t.id),r.append(n)),r},Fe=function(){var e=document.querySelectorAll("svg[data-src]");SVGInjector(e,{evalScripts:!1,each:function(e){}},function(e){})},Pe=function(){_("#ecm").prepend('<div class="ecm-loader"></div>')},Ue=function(){_("#ecm > .ecm-loader").remove()},ze=function(){0<_(X.offsetTopSel).length&&(document.getElementById("ecm").style.top=_(X.offsetTopSel).outerHeight()+"px")},Be=function(t,e){return e.some(function(e){return 0<=t.indexOf(e)})},Ne=function(e){return/^((http|https):\/\/)|\/\//.test(e)},je=function(e){return null!=e&&""!=e},Ee=function(e){if(null==e||null==e||""==e)return"";var t=new Date(e.replace(/-/g,"/"));return t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear()+" "+(("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2))},_e=function(){var e="test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}},We=function(e){for(var t in c)if(c[t].id==e)return c[t].articleApiUrl;return!1},Ge=function(e){for(var t in X.externalMarkers)if(X.externalMarkers.hasOwnProperty(t)&&X.externalMarkers[t].slug==e)return X.externalMarkers[t].articleApiUrl;return!1};return{init:function(){var e,t=document.createElement("div");if(t.id="ecmMap",document.getElementById("ecm").appendChild(t),"undefined"==typeof jQuery)throw new Error("ECM requires jQuery");"undefined"==typeof SVGInjector&&(A.ecmSVGi={id:"ecmSVGi",file:v+"vendor/svg-injector-1.1.3/dist/svg-injector.min.js",elType:"script",loaded:!1}),i.getAttribute("data-lan")&&(X.lan=i.getAttribute("data-lan")),i.getAttribute("data-theme")?(s=i.getAttribute("data-theme"),d=(V=v+"themes/"+s+"/")+s+".css",m=V+"config.js",u=V+"images/map-cluster.svg"):i.getAttribute("data-theme-key")&&(e=i.getAttribute("data-theme-key"),d=l+"?key="+e+"&type=css",m=l+"?key="+e+"&type=config",u=l+"?key="+e+"&type=mapCluster"),A.ecmThemeCss={id:"ecmThemeCss",file:d,elType:"link",loaded:!1},A.ecmThemeConfig={id:"ecmThemeConfig",file:m,elType:"script",loaded:!1},O(),window.onpopstate=function(e){null!=e.state&&e.state.view?null!=e.state&&"article"==e.state.view?ie("",e.state.articleApiUrl):null!=e.state&&e.state.view:_(".ecm-article-container").is(":visible")?(_(".ecm-article-container").remove(),re(e.state)):_(".ecm-cards-container").is(":visible")&&(_(".ecm-cards-container").remove(),_("#ecmSettingsBtn").show(),re(e.state))}},setConfig:function(e){for(var t in e)e.hasOwnProperty(t)&&(X[t]=e[t]);X.markersUrl&&(X.markersUrl=X.markersUrl.replace("{lan}",X.lan)),X.routesUrl&&(X.routesUrl=X.routesUrl.replace("{lan}",X.lan)),X.themeName&&(V=l+X.themeName+"/")},setTexts:function(e){for(var t in e)if(e.hasOwnProperty(t))for(var a=Object.getOwnPropertyNames(e[t]),r=0;r<a.length;r++)ee[t][a[r]]=e[t][a[r]]},convertLN2ECM:function(e,t){H[t]=[];for(var a=0;a<e.length;a++){e[a].images||(e[a].images={medium:e[a].thumbnail});var r="https://explori.es/fi/Article/"+e[a].id+"/"+e[a].slug,n="_blank",o=!0;X.externalMarkers[t].articleViewUrl&&(r=(r=(r=X.externalMarkers[t].articleViewUrl).replace("{id}",e[a].id)).replace("{slug}",e[a].slug),o=!(n="_self")),void 0!==X.externalMarkers[t].external&&(o=X.externalMarkers[t].external);var i={id:e[a].id,name:t,title:e[a].title,slug:e[a].slug,image:e[a].images.medium,logo:e[a].publication.image,color:e[a].publication.themeColor,latitude:parseFloat(e[a].latitude),longitude:parseFloat(e[a].longitude),url:r,target:n,icon:e[a].publication.marker,external:o};X.routing&&X.externalMarkers[t].slug&&X.externalMarkers[t].articleApiUrl&&(i.articleApiUrl=X.externalMarkers[t].articleApiUrl,i.articleApiUrl=i.articleApiUrl.replace("{id}",e[a].id)),H[t].push(i)}f(t)},convertLocationsDB2ECM:function(e,t){var a,r,n,o,i=X.externalMarkers[t].filtersIcon,l=X.externalMarkers[t].articleApiUrl;H[t]=[],K[t]=[],de(t),L[t]=[],T[t]=[];for(var s=0;s<e.places.length;s++)n="_blank",o=!0,void 0!==X.externalMarkers[t].external&&(o=X.externalMarkers[t].external),a={id:e.places[s].id,name:t,title:e.places[s].title,description:e.places[s].description,slug:e.places[s].slug,image:e.places[s].image,latitude:parseFloat(e.places[s].latitude),longitude:parseFloat(e.places[s].longitude),url:e.places[s].url,target:n,icon:i,external:o},je(l)&&(a.articleApiUrl=l),H[t].push(a);for(s=0;s<e.routes.length;s++){n="_blank",o=!0,void 0!==X.externalMarkers[t].external&&(o=X.externalMarkers[t].external),a={id:e.routes[s].id,name:t,title:e.routes[s].title,slug:e.routes[s].slug,image:e.routes[s].image,latitude:parseFloat(e.routes[s].waypoints[0][0].lat),longitude:parseFloat(e.routes[s].waypoints[0][0].lng),url:e.routes[s].url,target:n,icon:i,external:o,hasGpx:e.routes[s].hasGpx},H[t].push(a);for(var c=e.routes[s].waypoints,d=0;d<c.length;d++)r={id:e.routes[s].id,title:e.routes[s].title,image:e.routes[s].image,polylineOptions:{strokeColor:"#0099ff",strokeOpacity:1,strokeWeight:5},waypoints:c[d],hasGpx:e.routes[s].hasGpx},K[t].push(r),h(t,K[t].length-1)}f(t)},convertRetkipaikka2ECM:function(t,e){H[e]=[],K[e]=[],de(e),L[e]=[],T[e]=[];for(var a=0;a<t.length;a++){var r=!1;for(var n in H)if(H.hasOwnProperty(n)&&-1!=n.search("retkipaikka")&&n!=e&&(r=H[n].some(function(e){return e.id===t[a].id})))break;if(!r){t[a].images||(t[a].images={medium:t[a].thumbnail});var o,i,l,s,c=!0,d="https://kartta.retkipaikka.fi/assets/marker.png",p={esteeton:0,helppo:1,keskivaativa:2,vaativa:3,luokittelematon:4},g={esteeton:"#3c3",helppo:"#03c",keskivaativa:"#c33",vaativa:"#000",luokittelematon:"#cc3"};if(t[a].marker&&(d="https://kartta.retkipaikka.fi/assets/"+t[a].marker),null!=t[a].link&&t[a].link.search("retkipaikka.fi")&&(c=!1),void 0!==X.externalMarkers[e].external&&(c=X.externalMarkers[e].external),t[a].images[0]&&(t[a].images[0]=t[a].images[0].replace("http://","https://")),"Point"==t[a].geometry.type)o=parseFloat(t[a].geometry.coordinates[1]),i=parseFloat(t[a].geometry.coordinates[0]);else if("LineString"==t[a].geometry.type)o=parseFloat(t[a].geometry.coordinates[0][1]),i=parseFloat(t[a].geometry.coordinates[0][0]),s=Ae(t[a].geometry.coordinates),l={id:t[a].id,title:t[a].title,image:t[a].images[0],polylineOptions:{strokeColor:"#0099ff",strokeOpacity:1,strokeWeight:5},waypoints:s},je(t[a].route_difficulty)&&(l.badges=[{id:p[t[a].route_difficulty],name:t[a].route_difficulty[0].toUpperCase()+t[a].route_difficulty.substring(1)}],l.polylineOptions.strokeColor=g[t[a].route_difficulty]),K[e].push(l),h(e,K[e].length-1);else if("MultiLineString"==t[a].geometry.type){o=parseFloat(t[a].geometry.coordinates[0][0][1]),i=parseFloat(t[a].geometry.coordinates[0][0][0]);for(var m=0;m<t[a].geometry.coordinates.length;m++)s=Ae(t[a].geometry.coordinates[m]),l={id:t[a].id,title:t[a].title,image:t[a].images[0],polylineOptions:{strokeColor:"#0099ff",strokeOpacity:1,strokeWeight:5},waypoints:s},je(t[a].route_difficulty)&&(l.badges=[{id:p[t[a].route_difficulty],name:t[a].route_difficulty[0].toUpperCase()+t[a].route_difficulty.substring(1)}],l.polylineOptions.strokeColor=g[t[a].route_difficulty]),K[e].push(l),h(e,K[e].length-1)}var u={id:t[a].id,name:e,title:t[a].title,image:t[a].images[0],logo:null,color:null,latitude:o,longitude:i,url:t[a].link,target:"_blank",icon:d,external:c};H[e].push(u)}}f(e)}}}(jQuery);