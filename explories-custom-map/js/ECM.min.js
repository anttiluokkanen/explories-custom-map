/**
 * ECM.min.js
 * @copyright   2018 Fakiirimedia Oy
 * @author      Hape Haavikko <hape.haavikko@fakiirimedia.com>
 * @version     1.3.6
 */
var ECM=function(_){"use strict";function W(){navigator.geolocation?V?J.panTo(V):(_("#myLocationBtn").prop("disabled",!0),_(".ecm-btn-location").prop("disabled",!0),_("#myLocationBtn").addClass("ecm-btn-loading"),_(".ecm-btn-location").addClass("ecm-btn-loading"),navigator.geolocation.getCurrentPosition(function(e){V={lat:e.coords.latitude,lng:e.coords.longitude},t=new google.maps.Marker({position:V,map:J,optimized:!1,icon:{path:"M-20,0a20,20 0 1,0 40,0a20,20 0 1,0 -40,0",fillColor:"#06c",fillOpacity:1,strokeWeight:2,strokeColor:"#ffffff",scale:.4},title:"Your location"}),J.getBounds().contains(V)||xe(),_("#followUserCB").parent().show(),setTimeout(P,X.userPosInterval),_("#myLocationBtn").removeClass("ecm-btn-loading"),_("#myLocationBtn").hide(),_(".ecm-btn-location").removeClass("ecm-btn-loading"),_(".ecm-btn-location").prop("disabled",!1)},function(e){_("#myLocationBtn").removeClass("ecm-btn-loading"),_(".ecm-btn-location").removeClass("ecm-btn-loading"),_("#myLocationBtn").prop("disabled",!1),_(".ecm-btn-location").prop("disabled",!1),console.error("Getting user location failed: "+e)},{enableHighAccuracy:!0})):console.error("Unable to get user location because geolocation is not supported by browser.")}function D(r){var a=_("#"+r).parent();a.addClass("loading");var e=J.getBounds(),t=X.externalMarkers[r].url,o=X.initLocation.lat,n=X.initLocation.lat;J.getCenter().lat()&&(o=J.getCenter().lat(),n=J.getCenter().lng()),t=(t=(t=(t=(t=(t=t.replace("{lat}",o)).replace("{lng}",n)).replace("{north}",e.getNorthEast().lat())).replace("{east}",e.getNorthEast().lng())).replace("{south}",e.getSouthWest().lat())).replace("{west}",e.getSouthWest().lng()),k[r]&&k[r].abort(),k[r]=_.getJSON(t),k[r].done(function(e){a.removeClass("loading");var t=X.externalMarkers[r].callbackName;window.ECM[t].call(this,e,r)}),k[r].fail(function(e,t,a){"abort"!=a&&console.error("Loading "+r+" failed: "+t+", "+a)})}function f(t){G[t]=[];for(var e=0;e<K[t].length;e++){var a=K[t][e],r=X.externalMarkers[t].iconW,o=X.externalMarkers[t].iconH,n={lat:a.latitude,lng:a.longitude},i=new google.maps.Size(r,o);void 0!==r&&void 0!==o&&null!=r&&null!=o||(i=null);var l=new google.maps.MarkerImage(a.icon,null,null,null,i),s=new google.maps.Marker({index:parseInt(e),external:!0,id:a.id,name:a.name,position:n,map:J,icon:l,optimized:!0});s.addListener("click",function(){var e=K[t][this.index];g.setContent(Me(e)),g.open(J,this),google.maps.event.clearListeners(g,"domready"),e.name&&X.routing&&X.externalMarkers[e.name].slug&&X.externalMarkers[e.name].articleApiUrl&&g.addListener("domready",function(){_(".gm-style-iw .ecm-card").click(function(e){e.preventDefault();var t={view:"article",sourceSlug:_(this).attr("data-article-source"),articleId:_(this).attr("data-article-id"),articleSlug:_(this).attr("data-article-slug"),articleApiUrl:_(this).attr("data-article-api-url"),title:_(this).find("h1").text()};E(t),ie("",t.articleApiUrl)})})}),G[t].push(s)}oe(),0<_(".ecm-feed").length&&(se(!1),se(!0))}function h(a,r){var e=R[a][r],t=new google.maps.Polyline({path:e.waypoints,geodesic:!0,strokeColor:"#ffffff",strokeOpacity:1,strokeWeight:8}),o=new google.maps.Polyline({path:e.waypoints,geodesic:!0,strokeColor:e.polylineOptions.strokeColor,strokeOpacity:e.polylineOptions.strokeOpacity,strokeWeight:e.polylineOptions.strokeWeight});t.setMap(J),I[a][r]=t,o.setMap(J),L[a][r]=o,R[a][r].length=o.getLengthInMeters(),google.maps.event.addListener(o,"click",function(e){var t=R[a][r];g.setContent(Me(t)),g.setPosition(e.latLng),g.open(J)})}var o,c,p,J,e,n,g,V,t,a=document.getElementById("ecmScript"),v=a.src.replace(/js\/(ECM.js|ECM.min.js).*$/,""),r=a.src.replace(/explories-custom-map\/js\/(ECM.js|ECM.min.js).*$/,""),i=document.getElementById("ecm"),l="https://ecm.explories.net/themes/",s="default",H=v+"themes/"+s+"/",d=H+s+".css",m=H+"config.js",u=H+"images/map-cluster.svg",K={},R={},k=[],y=[],b=[],C=[],G={},q=null,w=[],x=[],M=[],S=[],L=[],I=[],Q=[],Y=[],T=null,$=!1,A={ecmMarkerClusterer:{id:"ecmMarkerClusterer",file:v+"vendor/markerclusterer-1.0.1/markerclusterer.min.js",elType:"script",loaded:!1}},X={baseTheme:null,themeName:null,routing:!1,ecmUrl:null,ecmTitle:null,markersUrl:"markers.json",routesUrl:"routes.json",lan:"fi",initLocation:{lat:60.169872,lng:24.938099},cardDefaultImg:H+"images/default-img.jpg",externalMarkers:null,mapDefaultTravelMode:"WALKING",mapInitZoom:10,mapMinZoom:0,mapMaxZoom:21,mapLayers:null,mapTypeId:"terrain",mapTypes:["roadmap","satellite","hybrid","terrain"],mapRouteMarkersThreshold:12,markerClustererOptions:{gridSize:56,zoomOnClick:!1,minimumClusterSize:2,textColor:"white",textSize:10,width:32,height:32},modes:null,offsetTop:"auto",offsetTopSel:"header",showBadgeFilters:!0,showMapFeedToggle:!0,showModeButtons:!0,showPrint:!1,showTagFilters:!0,showTypeFilters:!0,tagFiltersIcons:!0,usePlugin:!1,userPosInterval:5e3},ee={en:{badgeFiltersLegend:"Badges",hybrid:"Hybrid",mapLayers:"Map layers",mapSettings:"Map settings",mapType:"Map type",mapZoom:"Map zoom",marker:"Marker",myLocation:"My location",myLocationShow:"Show my location",myLocationCenter:"Center my location on map",roadmap:"Roadmap",route:"Route",satellite:"Satellite",shareArticle:"Share article",tagFiltersLegend:"Category",toggleTags:"Toggle all",typeFiltersLegend:"Type",terrain:"Terrain"},fi:{badgeFiltersLegend:"Badges",hybrid:"Hybridi",mapLayers:"Karttatasot",mapSettings:"Kartan asetukset",mapType:"Kartan tyyppi",mapZoom:"Kartan zoomaus",marker:"Kohde",myLocation:"Oma sijainti",myLocationShow:"Näytä sijaintini kartalla",myLocationCenter:"Keskitä kartta sijaintini mukaan",roadmap:"Tiekartta",route:"Reitti",satellite:"Satelliitti",shareArticle:"Jaa artikkeli",tagFiltersLegend:"Kategoria",toggleTags:"Valitse kaikki",typeFiltersLegend:"Tyyppi",terrain:"Maastokartta"}},te={markers:{id:1,name:"marker",show:!0},routes:{id:2,name:"route",show:!0}},O=function(){if(0!=Object.keys(A).length)for(var e in A)if(A.hasOwnProperty(e)){var t,a=A[e];if(0<_("#"+e).length)continue;"script"==a.elType?((t=document.createElement("script")).id=e,t.src=a.file,document.body.appendChild(t)):"link"==a.elType&&((t=document.createElement("link")).id=e,t.href=a.file,t.rel="stylesheet",document.body.appendChild(t)),t.onload=function(){Z(this.id)}}},Z=function(e){for(var t in A[e].loaded=!0,"ecmThemeConfig"==e&&1==X.usePlugin&&(A.ecmPluginConfig={id:"ecmPluginConfig",file:r+"assets/js/front.js",elType:"script",loaded:!1},O()),A)if(A.hasOwnProperty(t)&&!A[t].loaded)return!1;return o=X.initMode,i.getAttribute("data-offset-top")?(i.style.top=i.getAttribute("data-offset-top"),X.offsetTop=i.getAttribute("data-offset-top")):"auto"==X.offsetTop&&null!=X.offsetTopSel?(Ue(),_(window).resize(function(){Ue()})):null!=X.offsetTop&&(document.getElementById("ecm").style.top=X.offsetTop),_e&&(localStorage.getItem("lat")&&localStorage.getItem("lng")&&(X.initLocation.lat=parseFloat(localStorage.getItem("lat")),X.initLocation.lng=parseFloat(localStorage.getItem("lng"))),localStorage.getItem("mapInitZoom")&&(X.mapInitZoom=parseInt(localStorage.getItem("mapInitZoom"))),localStorage.getItem("types")&&(te=JSON.parse(localStorage.getItem("types")))),X.baseTheme&&(i.className=X.baseTheme),F(),!0},F=function(){e=document.getElementById("ecmMap"),n={center:X.initLocation,zoom:X.mapInitZoom,minZoom:X.mapMinZoom,maxZoom:X.mapMaxZoom,zoomControl:!1,scaleControl:!0,mapTypeId:X.mapTypeId,streetViewControl:!1,fullscreenControl:!1,mapTypeControl:!1,gestureHandling:"greedy",styles:X.modes[X.initMode].styles},J=new google.maps.Map(e,n),g=new google.maps.InfoWindow({maxWidth:320,content:""}),J.addListener("zoom_changed",function(){ge(),_("#zoom").val(J.getZoom()),_("#zoomVal").text(J.getZoom()),me(),_e&&localStorage.setItem("mapInitZoom",J.getZoom())}),J.addListener("idle",function(){for(var e in X.externalMarkers)X.externalMarkers.hasOwnProperty(e)&&X.externalMarkers[e].reloadOnBoundsChange&&_("#"+e).prop("checked")&&_("#"+e).trigger("change");_e&&(localStorage.setItem("lat",J.getCenter().lat()),localStorage.setItem("lng",J.getCenter().lng()))}),J.addListener("click",function(e){g.close()}),google.maps.LatLng.prototype.kmTo=function(e){var t=Math,a=t.PI/180,r=this.lat()*a,o=e.lat()*a,n=r-o,i=this.lng()*a-e.lng()*a;return 6378.137*(2*t.asin(t.sqrt(t.pow(t.sin(n/2),2)+t.cos(r)*t.cos(o)*t.pow(t.sin(i/2),2))))},google.maps.Polyline.prototype.getLengthInMeters=function(e){for(var t=this.getPath(e),a=t.getLength(),r=0,o=0;o<a-1;o++)r+=t.getAt(o).kmTo(t.getAt(o+1));return 1e3*r},google.maps.event.addListenerOnce(J,"idle",function(){Se(),z(),U()})},P=function(){navigator.geolocation.getCurrentPosition(function(e){V={lat:e.coords.latitude,lng:e.coords.longitude},t.setPosition(V),$&&J.panTo(V),setTimeout(P,X.userPosInterval)},function(e){console.error("Updating user location failed.")},{enableHighAccuracy:!0})},z=function(){if(Pe(),null===X.markersUrl)return c=[],void(Array.isArray(p)&&B());var e=_.getJSON(X.markersUrl);e.done(function(e){c=e,j(),N(c),Array.isArray(p)&&B()}),e.fail(function(e,t,a){console.error("Loading markers failed: "+t+", "+a)})},U=function(){if(Pe(),null===X.routesUrl)return p=[],void(Array.isArray(c)&&B());var e=_.getJSON(X.routesUrl);e.done(function(e){for(var t in p=e){var a;je(p[t])?p[t].travelMode?(a=we(p[t]),ce(t,a,p[t].polylineOptions)):ke(t):p.splice(t,1)}N(p),Array.isArray(c)&&B()}),e.fail(function(e,t,a){console.error("Loading routes failed: "+t+", "+a)})},B=function(){var e,t,a,r,o;pe(),Le(),Ie(),Fe(),i.getAttribute("data-feed")?(_("#ecmSettingsBtn").trigger("click"),_("#feedCB").trigger("click")):setTimeout(function(){_("#ecmSettingsBtn").trigger("click")},500),i.getAttribute("data-article")&&i.getAttribute("data-article-api-url")?ie(i.getAttribute("data-article"),i.getAttribute("data-article-api-url")):i.getAttribute("data-article")&&ie(i.getAttribute("data-article"),null),X.routing&&(o=(o=window.location.href).replace(X.ecmUrl,""),je(o)&&"/"!=o&&(e=o.split("/"),(r=_.isNumeric(e[0])?(a=parseInt(e[0]),We(a)):(t=e[0],a=e[1],De(t)))&&(r=r.replace("{id}",a),ie("",r)))),ze()},N=function(t){for(var a=0;a<t.length;a++){if(t[a].tags&&null!=t[a].tags)for(var r=0;r<t[a].tags.length;r++){Q.some(function(e){return e.id===t[a].tags[r].id})||Q.push(t[a].tags[r])}if(t[a].badges&&null!=t[a].badges)for(var o=0;o<t[a].badges.length;o++){Y.some(function(e){return e.id===t[a].tags[o].id})||Y.push(t[a].badges[o])}}},ae=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)e[t].setMap(null);return[]},j=function(){if(C=ae(C),te.markers.show){for(var e in c){var t,a,r;ve(c[e])&&(null===T||null!==T&&!he(c[e])||(t={lat:c[e].latitude,lng:c[e].longitude},Ne(c[e].icon)||(c[e].icon=H+"images/markers/"+c[e].icon),a=new google.maps.MarkerImage(c[e].icon,null,null,null,new google.maps.Size(32,32)),(r=new google.maps.Marker({index:parseInt(e),id:c[e].id,position:t,map:J,icon:a,optimized:!0})).addListener("click",function(){var e=c[this.index];g.setContent(Me(e)),g.open(J,this),google.maps.event.clearListeners(g,"domready"),X.routing&&e.slug&&e.articleApiUrl&&g.addListener("domready",function(){_(".gm-style-iw .ecm-card").click(function(e){e.preventDefault();var t={view:"article",sourceSlug:_(this).attr("data-article-source"),articleId:_(this).attr("data-article-id"),articleSlug:_(this).attr("data-article-slug"),articleApiUrl:_(this).attr("data-article-api-url"),title:_(this).find("h1").text()};E(t),ie("",t.articleApiUrl)})})}),C.push(r)))}oe()}},E=function(e){var t;X.routing&&(t="",e.sourceSlug&&(t=e.sourceSlug+"/"),e.articleId&&(t+=e.articleId+"/"),e.articleSlug&&(t+=e.articleSlug+"/"),""==t&&(t=X.ecmUrl),history.pushState(e,"",t),re(e))},re=function(e){e.title?_("title").text(e.title+" - "+X.ecmTitle):_("title").text(X.ecmTitle)},oe=function(){null!==q&&q.clearMarkers();var e=[{textColor:X.markerClustererOptions.textColor,textSize:X.markerClustererOptions.textSize,url:u,width:X.markerClustererOptions.width,height:X.markerClustererOptions.height}],t={gridSize:X.markerClustererOptions.gridSize,zoomOnClick:X.markerClustererOptions.zoomOnClick,minimumClusterSize:X.markerClustererOptions.minimumClusterSize,styles:e},a=Te();try{q=new MarkerClusterer(J,C.concat(x,a),t)}catch(e){throw alert("Unable to load MarkerClusterer. If you are using private browsing please disable it."),new Error("MarkerClusterer is undefined. Probably caused by private browsing mode.")}google.maps.event.addListener(q,"clusterclick",function(e){ne(e.getMarkers())})},ne=function(e){var t=_('<div class="ecm-cards-container"></div>');t.click(function(){t.remove(),_("#ecmSettingsBtn").show()});for(var a=Oe({icon:"icon-close.svg",name:"close",onClick:function(){t.remove(),_("#ecmSettingsBtn").show()},size:32}),r=_('<div class="ecm-cards"></div>'),o=0;o<e.length;o++){var n=e[o].index,i=c[n];e[o].external&&(i=K[e[o].name][n]),e[o].route&&(i=p[n]),r.append(Me(i))}r.find(".ecm-card").click(function(e){var t;e.stopPropagation(),_(this).attr("data-article-api-url")&&(e.preventDefault(),t={view:"article",sourceSlug:_(this).attr("data-article-source"),articleId:_(this).attr("data-article-id"),articleSlug:_(this).attr("data-article-slug"),articleApiUrl:_(this).attr("data-article-api-url"),title:_(this).find("h1").text()},E(t),ie("",t.articleApiUrl))}),t.append(a),t.append(r),_("#ecm").append(t),Fe(),_("#ecmSettingsBtn").hide(),E({view:"cluster"})},ie=function(e,t){var a=null!=t?t:"https://explori.es/api/news/";_(".ecm-article-container").remove();var d=_('        <div class="ecm-article-container">            <div class="ecm-article">                <div class="ecm-loader"></div>            </div>        </div>'),r=Oe({icon:"icon-close.svg",name:"close-article",size:48});r.css("top",_("#ecm").css("top")),d.prepend(r),d.click(le),_("#ecm").append(d),Fe();var o=_.getJSON(a+e);o.done(function(e){var t=_('<div class="ecm-article-logo"></div>'),a=_('<div class="ecm-article-img"></div>'),r=_('<div class="ecm-article-img-caption"></div>'),o=_("<h1>"+e.title+"</h1>"),n=_('<div class="ecm-article-body"></div>');e.text?n.html(e.text):e.content&&n.html(e.content),void 0!==e.publication&&je(e.publication.image)&&(t.css("background-image","url('"+e.publication.image+"')"),je(e.publication.themeColor)&&t.css("background-color",e.publication.themeColor),_(".ecm-article").append(t)),e.caption&&je(e.caption)&&(r.append("<p>"+e.caption+"</p>"),a.append(r)),void 0!==e.images&&je(e.images.large)?(a.css("background-image","url('"+e.images.large+"')"),_(".ecm-article").append(a)):je(e.image)&&(a.css("background-image","url('"+e.image+"')"),_(".ecm-article").append(a)),n.prepend(o);var i=_('<div class="ecm-article-info"></div>'),l="";e.authors&&je(e.authors)?l=e.authors:e.user&&je(e.user.name)&&(l=e.user.name),je(l)&&i.append('<p class="ecm-article-author">'+l+"</p>"),i.append('<p class="ecm-article-datetime">'+Ee(e.published)+"</p>"),n.prepend(i),d.find(".ecm-article").append(n),_(".ecm-article").click(function(e){e.stopPropagation()});var s=_('            <ul class="ecm-share">                <li><a href="#" class="ecm-icon-facebook" target="_blank"><span class="sr-only">Share on Facebook</span></a></li>                <li><a href="#" class="ecm-icon-twitter" target="_blank"><span class="sr-only">Share on Twitter</span></a></li>                <li><a href="#" class="ecm-icon-linkedin" target="_blank"><span class="sr-only">Share on LinkedIn</span></a></li>            </ul>            '),c=encodeURIComponent(window.location.href);s.find(".ecm-icon-facebook").attr("href","https://www.facebook.com/sharer.php?u="+c),s.find(".ecm-icon-twitter").attr("href","https://twitter.com/share?url="+c),s.find(".ecm-icon-linkedin").attr("href","https://www.linkedin.com/cws/share?url="+c),d.find(".ecm-article").append('<h2 class="ecm-share-h">'+ee[X.lan].shareArticle+"</h2>"),d.find(".ecm-article").append(s),d.find(".ecm-loader").remove()}),o.fail(function(e,t,a){console.error("Loading Explories article failed: "+t+", "+a)})},le=function(){_(".ecm-article-container").remove(),X.routing&&E({})},se=function(e){if(e){var t=_('<div class="ecm-cards-container ecm-feed ecm-feed-condensed"></div>'),a=_('<div class="ecm-cards"></div>');if(te.routes.show)for(var r in p)ve(p[r])&&(null===T||he(p[r]))&&je(p[r].url)&&a.append(Me(p[r]));for(var o=Te(),n=C.concat(o),i=0;i<n.length;i++){var l=n[i].index,s=c[l];n[i].external&&(s=K[n[i].name][l]),je(s.url)&&a.append(Me(s))}a.find(".ecm-card").click(function(e){var t;e.stopPropagation(),_(this).attr("data-article-api-url")&&(e.preventDefault(),t={view:"article",sourceSlug:_(this).attr("data-article-source"),articleId:_(this).attr("data-article-id"),articleSlug:_(this).attr("data-article-slug"),articleApiUrl:_(this).attr("data-article-api-url"),title:_(this).find("h1").text()},E(t),ie("",t.articleApiUrl))}),t.append(a),_("#ecm").append(t)}else _(".ecm-feed").remove()},ce=function(r,e,o){y[r]=new google.maps.DirectionsService,b[r]=new google.maps.DirectionsRenderer({routeIndex:Date.now(),suppressPolylines:!0,suppressMarkers:J.getZoom()<X.mapRouteMarkersThreshold,suppressInfoWindows:!1,preserveViewport:!0,markerOptions:{icon:{path:"M-20,0a20,20 0 1,0 40,0a20,20 0 1,0 -40,0",fillColor:o.strokeColor,fillOpacity:1,strokeWeight:2,strokeColor:"#ffffff",scale:.4}}}),b[r].setMap(J),y[r].route(e,function(e,t){var a;"OK"===t?(b[r].setDirections(e),a=e.routes[0],p[r].length=be(a),p[r].duration=Ce(a),w[r]=e,ye(r,e,o)):console.error("Directions request failed due to "+t)})},de=function(e){if(L[e])for(var t=0;t<L[e].length;t++)L[e][t].setMap(null),I[e][t].setMap(null)},pe=function(){if(!function(){ae(x);for(var e=0;e<M.length;e++)if(Array.isArray(M[e])){for(var t=0;t<M[e].length;t++)M[e][t].setMap(null);b[e].setMap(null)}else M[e]&&M[e].setMap(null),S[e]&&S[e].setMap(null)}(),ae(x),x=[],te.routes.show){for(var e,t,a,r,o=0;o<p.length;o++){ve(p[o])&&(null!==T&&!he(p[o])||(p[o].travelMode?ye(o,w[o],p[o].polylineOptions):(ke(o),je(p[o].icon)&&(e={lat:p[o].latitude,lng:p[o].longitude},Ne(p[o].icon)||(p[o].icon=H+"images/markers/"+p[o].icon),t=new google.maps.MarkerImage(p[o].icon,null,null,null,new google.maps.Size(32,32)),a=new google.maps.Marker({index:parseInt(o),id:p[o].id,position:e,map:J,icon:t,optimized:!0,route:!0}),r=o,a.addListener("click",function(e){var t=p[r];g.setContent(Me(t)),g.setPosition(e.latLng),g.open(J)}),x.push(a)))))}ge()}},ge=function(){for(var e in b)void 0!==M[e]&&null!==M[e][0].getMap()&&(b[e].setOptions({suppressMarkers:J.getZoom()<X.mapRouteMarkersThreshold}),b[e].setMap(J))},me=function(){if(X.mapLayers)for(var e=0;e<X.mapLayers.length;e++){var t=X.mapLayers[e];if(!t.minZoom||!t.maxZoom)return;var a=t.minZoom>J.getZoom()||t.maxZoom<J.getZoom();_("#ecmFiltersLayers input:eq("+e+")").prop("disabled",a)}},ue=function(){J.overlayMapTypes.setAt(0,null),_("#zoom").attr("min",X.mapMinZoom),_("#zoom").attr("max",X.mapMaxZoom),J.setOptions({minZoom:X.mapMinZoom,maxZoom:X.mapMaxZoom}),_e&&localStorage.removeItem("mapLayer")},fe=function(){T={tags:[],badges:[]},_("#ecmFiltersTags .ecm-checkbox:not(.ecm-toggle-all)").each(function(){_(this).prop("checked")?T.tags.push(parseInt(_(this).val())):_("#toggleTagsCB").prop("checked",!1)}),_("#ecmFiltersBadges .ecm-checkbox").each(function(){_(this).prop("checked")&&T.badges.push(parseInt(_(this).val()))}),0==T.tags.length&&0==T.badges.length&&(T=null),_e&&localStorage.setItem("filters",JSON.stringify(T)),j(),pe(),oe(),0<_(".ecm-feed").length&&(se(!1),se(!0))},he=function(e){var t,a,r=!1;return e.tags&&(t=_.map(e.tags,function(e){return e.id}),r=Be(T.tags,t)),e.badges&&(a=_.map(e.badges,function(e){return e.id}),r=r&&Be(T.badges,a)),r},ve=function(e){return!e.modes||-1!=e.modes.indexOf(o)},ke=function(a){var e,t,r=p[a];Array.isArray(r.waypoints)&&(e=new google.maps.Polyline({path:r.waypoints,geodesic:!0,strokeColor:"#ffffff",strokeOpacity:1,strokeWeight:8}),t=new google.maps.Polyline({path:r.waypoints,geodesic:!0,strokeColor:r.polylineOptions.strokeColor,strokeOpacity:r.polylineOptions.strokeOpacity,strokeWeight:r.polylineOptions.strokeWeight}),e.setMap(J),S[a]=e,t.setMap(J),M[a]=t,p[a].length=t.getLengthInMeters(),google.maps.event.addListener(t,"click",function(e){var t=p[a];g.setContent(Me(t)),g.setPosition(e.latLng),g.open(J)}))},ye=function(a,e,t){for(var r=[],o=e.routes[0].legs,n=0;n<o.length;n++)for(var i=o[n].steps,l=0;l<i.length;l++){for(var s=i[l].path,c=new google.maps.Polyline(t),d=0;d<s.length;d++)c.getPath().push(s[d]);r.push(c),c.setMap(J),google.maps.event.addListener(c,"click",function(e){var t=p[a];g.setContent(Me(t)),g.setPosition(e.latLng),g.open(J)})}M[a]=r},be=function(e){for(var t=0,a=0;a<e.legs.length;++a)t+=e.legs[a].distance.value;return t},Ce=function(e){for(var t=0,a=0;a<e.legs.length;++a)t+=e.legs[a].duration.value;return t},we=function(e){var t=e.waypoints[0],a=e.waypoints[e.waypoints.length-1],r=new google.maps.LatLng(t.lat,t.lng),o=new google.maps.LatLng(a.lat,a.lng),n=[];e.waypoints.shift(),e.waypoints.pop();for(var i=0;i<e.waypoints.length;i++)n.push({location:new google.maps.LatLng(e.waypoints[i].lat,e.waypoints[i].lng)});return void 0===e.travelMode&&(e.travelMode=X.mapDefaultTravelMode),{origin:r,destination:o,waypoints:n,optimizeWaypoints:!0,travelMode:e.travelMode}},xe=function(){J.setZoom(J.getZoom()-1),google.maps.event.addListenerOnce(J,"idle",function(){J.getBounds().contains(V)||xe()})},Me=function(e){var t,a,r,o,n,i,l,s,c=_('<a class="ecm-card"></a>');if(e.external&&(c.addClass("ecm-card-external"),!e.articleApiUrl&&je(e.url)&&c.append('<div class="ecm-card-external-icon"></div>'),e.logo&&(a=_('<div class="ecm-card-logo" style="background-image:url(\''+e.logo+"');\"></div>"),e.color&&a.css("background-color",e.color),c.append(a))),e.url?(c.attr("href",e.url),e.target&&c.attr("target",e.target)):c.addClass("ecm-card-no-link"),(e.image||je(X.cardDefaultImg))&&(r=_('<div class="ecm-card-img-container"></div>'),o=_('<div class="ecm-card-img"></div>'),e.image?(Ne(e.image)||(e.image=v+e.image),o.css("background-image","url('"+e.image+"')")):(o.css("background-image","url('"+X.cardDefaultImg+"')"),o.addClass("ecm-default-img")),r.append(o),c.append(r)),(e.badges||e.length)&&(n=_('<div class="ecm-card-info"></div>')),e.badges&&Array.isArray(e.badges))for(var d=0;d<e.badges.length;d++){var p=_('<span class="ecm-card-badge">'+e.badges[d].name+"</span>");p.addClass("ecm-card-badge-"+e.badges[d].id),n.append(p)}if(e.length&&(i=_('<span class="ecm-card-length">'+(e.length/1e3).toFixed(2)+" km</span>"),n.append(i)),(e.badges||e.length)&&c.append(n),e.title&&(l=_("<h1>"+e.title+"</h1>"),c.append(l)),e.description&&(s=_("<p>"+e.description+"</p>"),c.append(s)),e.tags&&Array.isArray(e.tags)){for(var g=_('<div class="ecm-card-tags"></div>'),m=0;m<e.tags.length;m++){Ne(e.tags[m].icon)||(e.tags[m].icon=H+"images/markers/"+e.tags[m].icon);var u=_("<img />");u.attr("src",e.tags[m].icon),u.attr("alt",e.tags[m].name),g.append(u)}c.append(g)}return X.routing&&e.slug&&e.articleApiUrl&&(t=e.articleApiUrl.replace("{id}",e.id),c.attr("data-article-api-url",t),c.attr("data-article-id",e.id),c.attr("data-article-slug",e.slug)),e.name&&X.routing&&X.externalMarkers[e.name].slug&&X.externalMarkers[e.name].articleApiUrl&&(t=X.externalMarkers[e.name].articleApiUrl.replace("{id}",e.id),c.attr("data-article-api-url",t),c.attr("data-article-source",X.externalMarkers[e.name].slug),c.attr("data-article-id",e.id),c.attr("data-article-slug",e.slug)),c[0].outerHTML},Se=function(){if(X.showModeButtons&&void 0!==X.modes&&null!==X.modes){var e,t,a=_('<div class="ecm-mode-buttons"></div>');for(var r in X.modes){X.modes.hasOwnProperty(r)&&(e=X.modes[r],(t=_('<button type="button" class="ecm-btn">'+ee[X.lan][r]+"</button>")).attr("id","ecm"+r.charAt(0).toUpperCase()+r.slice(1)+"Btn"),t.attr("data-id",e.id),t.attr("data-mode",r),t.addClass("ecm-btn-"+r),r==X.initMode&&t.addClass("ecm-btn-active"),t.click(function(){var e;_(".ecm-mode-buttons .ecm-btn").removeClass("ecm-btn-active"),_(this).addClass("ecm-btn-active"),e=_(this).attr("data-mode"),void 0!==X.modes[e]?(o=e,n=X.modes[e].styles,J.setOptions({styles:n}),j(),pe()):console.error("Invalid mode")}),a.append(t))}_("#ecm").append(a)}},Le=function(){var e,t=_('<div class="ecm-map-controls"></div>');X.showPrint&&(e=Oe({icon:"icon-print.svg",name:"print",onClick:function(){window.print()},size:32}),t.append(e));var a=Oe({icon:"icon-location.svg",name:"location",onClick:function(){W()},size:32}),r=Oe({icon:"icon-plus.svg",name:"zoom-in",onClick:function(){J.setZoom(J.getZoom()+1)},size:32}),o=Oe({icon:"icon-minus.svg",name:"zoom-out",onClick:function(){J.setZoom(J.getZoom()-1)},size:32});t.append(a),t.append(r),t.append(o),_("#ecm").append(t)},Ie=function(){var e=Oe({icon:["icon-settings.svg"],id:"ecmSettingsBtn",name:"settings",onClick:function(){_("#ecmSettings").toggleClass("ecm-panel-open"),_(".ecm-feed").toggleClass("ecm-feed-condensed")},size:32});_("#ecm").append(e);var t,a=_('<div id="ecmSettings" class="ecm-panel ecm-panel-settings notranslate"></div>'),r=Oe({icon:["icon-close.svg"],id:"ecmCloseSettingsBtn",name:"settings-close",onClick:function(){_("#ecmSettings").toggleClass("ecm-panel-open"),_(".ecm-feed").toggleClass("ecm-feed-condensed")},size:32});if(a.append(r),X.showMapFeedToggle&&(t=Ze({id:"feedCB",className:"ecm-switch",groupClass:"ecm-switch-group",label:"Feed",labelPre:"Map",onChange:function(){se(_(this).prop("checked"))}}),a.append(t)),X.showTypeFilters){var o,n,i,l=_('<fieldset id="ecmFiltersTypes" class="ecm-filters"></fieldset>');for(var s in l.append("<legend>"+ee[X.lan].typeFiltersLegend+"</legend>"),te){te.hasOwnProperty(s)&&(o=te[s],n=!0,_e&&je(localStorage.getItem("types"))&&0==JSON.parse(localStorage.getItem("types"))[s].show&&(n=!1),i=Ze({id:"typeCB_"+o.id,checked:n,label:ee[X.lan][o.name],onChange:function(){!function(){_("#ecmFiltersTypes .ecm-checkbox").each(function(){var e=_(this).val();te[e].show=_(this).is(":checked")}),te.markers.show||q.clearMarkers(),_("#ecmFiltersBadges").prop("disabled",!te.routes.show),_("#ecmFiltersBadges .ecm-checkbox").prop("disabled",!te.routes.show);var e=!te.markers.show&&!te.routes.show;_("#ecmFiltersTags").prop("disabled",e),_("#ecmFiltersTags .ecm-checkbox").prop("disabled",e),_e&&localStorage.setItem("types",JSON.stringify(te)),fe()}()},value:s}),l.append(i))}a.append(l)}if(X.showTagFilters){var c=_('<fieldset id="ecmFiltersTags" class="ecm-filters"></fieldset>');c.append("<legend>"+ee[X.lan].tagFiltersLegend+"</legend>");var d=Ze({id:"toggleTagsCB",className:"ecm-toggle-all",groupClass:"ecm-toggle-tags-group",checked:!0,label:ee[X.lan].toggleTags,onChange:function(){_("#ecmFiltersTags .ecm-checkbox").prop("checked",_(this).prop("checked")),fe()}});X.tagFiltersIcons&&d.addClass("ecm-toggle-all-icon"),c.append(d);for(var p=0;p<Q.length;p++){var g=Q[p],m=!0;_e&&je(localStorage.getItem("filters"))&&"null"!=localStorage.getItem("filters")&&-1==JSON.parse(localStorage.getItem("filters")).tags.indexOf(g.id)&&(m=!1);var u=Ze({id:"tagCB_"+g.id,checked:m,label:Q[p].name,onChange:fe,value:g.id});X.tagFiltersIcons&&(u.addClass("ecm-form-group-cb-icon"),Ne(g.icon)?u.css("background-image","url('"+g.icon+"')"):u.css("background-image","url('"+H+"images/markers/"+g.icon+"')")),c.append(u)}a.append(c)}if(Array.isArray(X.externalMarkersSets)&&0<X.externalMarkersSets.length)for(var f=0;f<X.externalMarkersSets.length;f++){var h,v,k,y=X.externalMarkersSets[f],b="ecmFiltersExternalMarkers"+y.id[0].toUpperCase()+y.id.substring(1),C=_('<fieldset id="'+b+'" class="ecm-filters"></fieldset>');for(var w in C.append("<legend>"+ee[X.lan][y.id]+"</legend>"),y.showToggleAll&&(h=Ze({id:"toggleExternal"+y.id+"CB",className:"ecm-toggle-all",groupClass:"ecm-toggle-tags-group",checked:!0,label:ee[X.lan].toggleTags,onChange:function(){var e=_(this).parent().parent();_(e).find(".ecm-checkbox:not(.ecm-toggle-all)").prop("checked",_(this).prop("checked")),_(e).find(".ecm-checkbox:not(.ecm-toggle-all)").trigger("change")}}),X.tagFiltersIcons&&h.addClass("ecm-toggle-all-icon"),C.append(h)),X.externalMarkers){X.externalMarkers.hasOwnProperty(w)&&X.externalMarkers[w].set==y.id&&(v=X.externalMarkers[w].checked,_e&&je(localStorage.getItem(w))&&(v=JSON.parse(localStorage.getItem(w))),k=Ze({id:w,label:ee[X.lan][w],checked:v,onChange:function(){var e,t=_(this).parent().parent();_(this).prop("checked")?(D(_(this).attr("id")),_(t).find(".ecm-checkbox:not(.ecm-toggle-all):checked").length==_(t).find(".ecm-checkbox:not(.ecm-toggle-all)").length&&_(t).find(".ecm-toggle-all").prop("checked",!0)):(e=_(this).attr("id"),delete K[e],G[e]=ae(G[e]),delete G[e],oe(),delete R[e],de(e),0<_(".ecm-feed").length&&(se(!1),se(!0)),_(t).find(".ecm-toggle-all").prop("checked",!1)),_e&&localStorage.setItem(_(this).attr("id"),_(this).prop("checked"))},value:w}),X.tagFiltersIcons&&(k.addClass("ecm-form-group-cb-icon"),k.css("background-image","url('"+X.externalMarkers[w].filtersIcon+"')")),y.showToggleAll&&!X.externalMarkers[w].checked&&C.find(".ecm-toggle-all").prop("checked",!1),C.append(k))}a.append(C)}if(X.showBadgeFilters&&0<Y.length){var x=_('<fieldset id="ecmFiltersBadges" class="ecm-filters"></fieldset>');x.append("<legend>"+ee[X.lan].badgeFiltersLegend+"</legend>");for(f=0;f<Y.length;f++){var M=Y[f],S=!0;_e&&je(localStorage.getItem("filters"))&&"null"!=localStorage.getItem("filters")&&-1==JSON.parse(localStorage.getItem("filters")).badges.indexOf(M.id)&&(S=!1);var L=Ze({id:"badgeCB_"+M.id,checked:S,label:Y[f].name,onChange:fe,value:M.id});x.append(L)}a.append(x)}var I=_('<fieldset id="ecmFiltersMapSettings" class="ecm-filters"></fieldset>');I.append("<legend>"+ee[X.lan].mapSettings+"</legend>");var T=_('<div class="ecm-form-group"></div>');T.append('<label for="mapType">'+ee[X.lan].mapType+"</label><br />");for(var A,O,Z=_('<select id="mapType"></select>'),F=0;F<X.mapTypes.length;F++){var P=X.mapTypes[F],z=_("<option></option>");z.attr("value",P),z.text(ee[X.lan][P]),X.mapTypeId==P&&z.prop("selected",!0),Z.append(z)}if(je(X.mapLayers))for(var U in X.mapLayers){X.mapLayers.hasOwnProperty(U)&&(A=X.mapLayers[U].checked,_e&&localStorage.getItem("mapLayer")==X.mapLayers[U].name&&(A=!0),(O=_("<option></option>")).attr("value",U),O.text(ee[X.lan][X.mapLayers[U].name]),A&&O.prop("selected",!0),Z.append(O))}T.append(Z),Z.change(function(){var e,t,a,d,p;-1!=X.mapTypes.indexOf(_(this).val())?(ue(),J.setOptions({mapTypeId:_(this).val()}),_e&&localStorage.setItem("mapTypeId",_(this).val())):(e=_(this).val(),t=!0,d=X.mapLayers[e],p=new google.maps.LatLngBounds(new google.maps.LatLng(d.bounds[1],d.bounds[0]),new google.maps.LatLng(d.bounds[3],d.bounds[2])),t?(_("#ecmFiltersLayers").addClass("loading"),_("#ecmFiltersLayers .ecm-checkbox").each(function(){_(this).val()!=e&&_(this).prop("checked",!1)}),J.overlayMapTypes.setAt(0,null),X.mapMinZoom<d.minZoom&&(_("#zoom").attr("min",d.minZoom),J.setOptions({minZoom:d.minZoom})),X.mapMaxZoom>d.maxZoom&&(_("#zoom").attr("max",d.maxZoom),J.setOptions({maxZoom:d.maxZoom})),(a=new google.maps.ImageMapType({name:d.name,minZoom:d.minZoom,maxZoom:d.maxZoom,tileSize:new google.maps.Size(256,256),isPng:!0,opacity:1,getTileUrl:function(e,t){var a=J.getProjection(),r=Math.pow(2,t),o=256/r,n=256/r,i=new google.maps.LatLngBounds(a.fromPointToLatLng(new google.maps.Point(e.x*o,(e.y+1)*n)),a.fromPointToLatLng(new google.maps.Point((e.x+1)*o,e.y*n))),l=0<=e.x?e.x:r+e.x,s=e.y;if(p.intersects(i)&&t>=d.minZoom&&t<=d.maxZoom){var c=d.url.replace("{zoom}",t);return c=(c=c.replace("{x}",l)).replace("{y}",s)}}})).addListener("tilesloaded",function(){_("#ecmFiltersLayers").removeClass("loading")}),J.overlayMapTypes.insertAt(0,a),_e&&localStorage.setItem("mapLayer",d.name)):ue())}),I.append(T);var B=_('<div class="ecm-form-group"></div>');B.append('<label for="zoom">'+ee[X.lan].mapZoom+"</label><br />"),B.append('<div class="ecm-range-labels"><span class="pull-left">-</span><span id="zoomVal">'+J.getZoom()+'</span><span class="pull-right">+</span></div>');var N=_('<input id="zoom" type="range" step="1" />');N.attr("min",X.mapMinZoom),N.attr("max",X.mapMaxZoom),B.append(N),N.val(J.getZoom()),N.on("input",function(){J.setZoom(parseInt(_(this).val())),_("#zoomVal").text(_(this).val())}),I.append(B);var j=Oe({id:"myLocationBtn",icon:"icon-location.svg",name:"location",className:"ecm-btn-icon-text ecm-btn-block",text:ee[X.lan].myLocationShow,onClick:function(){W()}}),E=Ze({id:"followUserCB",checked:$,label:ee[X.lan].myLocationCenter,onChange:function(){($=_(this).prop("checked"))&&J.panTo(V)}});for(var w in E.hide(),I.append(j),I.append(E),a.append(I),_("#ecm").append(a),fe(),X.externalMarkers)X.externalMarkers.hasOwnProperty(w)&&_("#"+w).prop("checked")&&D(w);_("#mapType").trigger("change")},Te=function(){var e=[];for(var t in G)if(G.hasOwnProperty(t))for(var a=0;a<G[t].length;a++)e.push(G[t][a]);return e},Ae=function(e){var t=[];if(Array.isArray(e))for(var a=0;a<e.length;a++)t.push({lat:e[a][1],lng:e[a][0]});return t},Oe=function(e){var t={className:null,disabled:!1,icon:null,id:null,name:null,onClick:null,size:null,text:null,tooltip:null};_.extend(t,e);var a,r=_('<button type="button" class="ecm-btn"></button>');if(t.disabled&&r.prop("disabled",!0),t.id&&r.attr("id",t.id),t.size&&r.addClass("ecm-btn-"+t.size),t.name&&r.addClass("ecm-btn-"+t.name),t.className&&r.addClass(t.className),t.icon)if(Array.isArray(t.icon))for(var o=0;o<t.icon.length;o++)a=_('<svg data-src="'+v+"images/"+t.icon[o]+'"></svg>'),r.append(a);else a=_('<svg data-src="'+v+"images/"+t.icon+'"></svg>'),r.append(a);return t.text&&r.append(t.text),t.onClick&&r.click(t.onClick),r},Ze=function(e){var t={checked:!1,className:null,data:null,groupClass:null,id:null,label:null,labelPre:null,name:null,onChange:null,tooltip:null,value:null};_.extend(t,e);var a,r=_('<div class="ecm-form-group-cb"></div>');t.labelPre&&((a=_("<label></label>")).text(t.labelPre),r.append(a));var o,n=_('<input type="checkbox" class="ecm-checkbox" />');if(n.attr("id",t.id),n.attr("value",t.value),t.name&&n.attr("name",t.name),t.className&&n.addClass(t.className),t.groupClass&&r.addClass(t.groupClass),t.data)for(var i=0;i<t.data.length;i++)n.attr("data-"+t.data[i].name,t.data[i].value);return t.checked&&n.prop("checked",!0),t.onChange&&n.change(t.onChange),r.append(n),t.label&&((o=_("<label></label>")).text(t.label),o.attr("for",t.id),r.append(o)),r},Fe=function(){var e=document.querySelectorAll("svg[data-src]");SVGInjector(e,{evalScripts:!1,each:function(e){}},function(e){})},Pe=function(){_("#ecm").prepend('<div class="ecm-loader"></div>')},ze=function(){_("#ecm > .ecm-loader").remove()},Ue=function(){0<_(X.offsetTopSel).length&&(document.getElementById("ecm").style.top=_(X.offsetTopSel).outerHeight()+"px")},Be=function(t,e){return e.some(function(e){return 0<=t.indexOf(e)})},Ne=function(e){return/^((http|https):\/\/)|\/\//.test(e)},je=function(e){return"undefined"!==e&&null!==e&&""!=e},Ee=function(e){if(null==e||null==e||""==e)return"";var t=new Date(e.replace(/-/g,"/"));return t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear()+" "+(("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2))},_e=function(){var e="test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}},We=function(e){for(var t in c)if(c[t].id==e)return c[t].articleApiUrl;return!1},De=function(e){for(var t in X.externalMarkers)if(X.externalMarkers.hasOwnProperty(t)&&X.externalMarkers[t].slug==e)return X.externalMarkers[t].articleApiUrl;return!1};return{init:function(){var e,t=document.createElement("div");if(t.id="ecmMap",document.getElementById("ecm").appendChild(t),"undefined"==typeof jQuery)throw new Error("ECM requires jQuery");"undefined"==typeof SVGInjector&&(A.ecmSVGi={id:"ecmSVGi",file:v+"vendor/svg-injector-1.1.3/dist/svg-injector.min.js",elType:"script",loaded:!1}),i.getAttribute("data-lan")&&(X.lan=i.getAttribute("data-lan")),i.getAttribute("data-theme")?(s=i.getAttribute("data-theme"),d=(H=v+"themes/"+s+"/")+s+".css",m=H+"config.js",u=H+"images/map-cluster.svg"):i.getAttribute("data-theme-key")&&(e=i.getAttribute("data-theme-key"),d=l+"?key="+e+"&type=css",m=l+"?key="+e+"&type=config",u=l+"?key="+e+"&type=mapCluster"),A.ecmThemeCss={id:"ecmThemeCss",file:d,elType:"link",loaded:!1},A.ecmThemeConfig={id:"ecmThemeConfig",file:m,elType:"script",loaded:!1},O(),window.onpopstate=function(e){null!=e.state&&e.state.view?null!=e.state&&"article"==e.state.view?ie("",e.state.articleApiUrl):null!=e.state&&e.state.view:_(".ecm-article-container").is(":visible")?(_(".ecm-article-container").remove(),re(e.state)):_(".ecm-cards-container").is(":visible")&&(_(".ecm-cards-container").remove(),_("#ecmSettingsBtn").show(),re(e.state))}},setConfig:function(e){for(var t in e)e.hasOwnProperty(t)&&(X[t]=e[t]);X.markersUrl&&(X.markersUrl=X.markersUrl.replace("{lan}",X.lan)),X.routesUrl&&(X.routesUrl=X.routesUrl.replace("{lan}",X.lan)),X.themeName&&(H=l+X.themeName+"/")},setTexts:function(e){for(var t in e)if(e.hasOwnProperty(t))for(var a=Object.getOwnPropertyNames(e[t]),r=0;r<a.length;r++)ee[t][a[r]]=e[t][a[r]]},convertLN2ECM:function(e,t){K[t]=[];for(var a=0;a<e.length;a++){e[a].images||(e[a].images={medium:e[a].thumbnail});var r="https://explori.es/fi/Article/"+e[a].id+"/"+e[a].slug,o="_blank",n=!0;X.externalMarkers[t].articleViewUrl&&(r=(r=(r=X.externalMarkers[t].articleViewUrl).replace("{id}",e[a].id)).replace("{slug}",e[a].slug),n=!(o="_self")),void 0!==X.externalMarkers[t].external&&(n=X.externalMarkers[t].external);var i={id:e[a].id,name:t,title:e[a].title,slug:e[a].slug,image:e[a].images.medium,logo:e[a].publication.image,color:e[a].publication.themeColor,latitude:parseFloat(e[a].latitude),longitude:parseFloat(e[a].longitude),url:r,target:o,icon:e[a].publication.marker,external:n};X.routing&&X.externalMarkers[t].slug&&X.externalMarkers[t].articleApiUrl&&(i.articleApiUrl=X.externalMarkers[t].articleApiUrl,i.articleApiUrl=i.articleApiUrl.replace("{id}",e[a].id)),K[t].push(i)}f(t)},convertLocationsDB2ECM:function(e,t){var a,r,o,n,i=X.externalMarkers[t].filtersIcon;K[t]=[],R[t]=[],de(t),L[t]=[],I[t]=[];for(var l=0;l<e.places.length;l++)o="_blank",n=!0,void 0!==X.externalMarkers[t].external&&(n=X.externalMarkers[t].external),e.places[l].source.icon&&(i=e.places[l].source.icon),a={id:e.places[l].id,name:t,title:e.places[l].title,slug:e.places[l].slug,image:e.places[l].image,latitude:parseFloat(e.places[l].latitude),longitude:parseFloat(e.places[l].longitude),url:e.places[l].url,target:o,icon:i,external:n},K[t].push(a);for(l=0;l<e.routes.length;l++)o="_blank",n=!0,void 0!==X.externalMarkers[t].external&&(n=X.externalMarkers[t].external),e.routes[l].source.icon&&(i=e.routes[l].source.icon),a={id:e.routes[l].id,name:t,title:e.routes[l].title,slug:e.routes[l].slug,image:e.routes[l].image,latitude:parseFloat(e.routes[l].waypoints[0].lat),longitude:parseFloat(e.routes[l].waypoints[0].lng),url:e.routes[l].url,target:o,icon:i,external:n},r={id:e.routes[l].id,title:e.routes[l].title,image:e.routes[l].image,polylineOptions:{strokeColor:"#0099ff",strokeOpacity:1,strokeWeight:5},waypoints:e.routes[l].waypoints},R[t].push(r),h(t,R[t].length-1),K[t].push(a);f(t)},convertRetkipaikka2ECM:function(t,e){K[e]=[],R[e]=[],de(e),L[e]=[],I[e]=[];for(var a=0;a<t.length;a++){var r=!1;for(var o in K)if(K.hasOwnProperty(o)&&-1!=o.search("retkipaikka")&&o!=e&&(r=K[o].some(function(e){return e.id===t[a].id})))break;if(!r){t[a].images||(t[a].images={medium:t[a].thumbnail});var n,i,l,s,c=!0,d="https://kartta.retkipaikka.fi/assets/marker.png",p={esteeton:0,helppo:1,keskivaativa:2,vaativa:3,luokittelematon:4},g={esteeton:"#3c3",helppo:"#03c",keskivaativa:"#c33",vaativa:"#000",luokittelematon:"#cc3"};if(t[a].marker&&(d="https://kartta.retkipaikka.fi/assets/"+t[a].marker),null!=t[a].link&&t[a].link.search("retkipaikka.fi")&&(c=!1),void 0!==X.externalMarkers[e].external&&(c=X.externalMarkers[e].external),t[a].images[0]&&(t[a].images[0]=t[a].images[0].replace("http://","https://")),"Point"==t[a].geometry.type)n=parseFloat(t[a].geometry.coordinates[1]),i=parseFloat(t[a].geometry.coordinates[0]);else if("LineString"==t[a].geometry.type)n=parseFloat(t[a].geometry.coordinates[0][1]),i=parseFloat(t[a].geometry.coordinates[0][0]),s=Ae(t[a].geometry.coordinates),l={id:t[a].id,title:t[a].title,image:t[a].images[0],polylineOptions:{strokeColor:"#0099ff",strokeOpacity:1,strokeWeight:5},waypoints:s},je(t[a].route_difficulty)&&(l.badges=[{id:p[t[a].route_difficulty],name:t[a].route_difficulty[0].toUpperCase()+t[a].route_difficulty.substring(1)}],l.polylineOptions.strokeColor=g[t[a].route_difficulty]),R[e].push(l),h(e,R[e].length-1);else if("MultiLineString"==t[a].geometry.type){n=parseFloat(t[a].geometry.coordinates[0][0][1]),i=parseFloat(t[a].geometry.coordinates[0][0][0]);for(var m=0;m<t[a].geometry.coordinates.length;m++)s=Ae(t[a].geometry.coordinates[m]),l={id:t[a].id,title:t[a].title,image:t[a].images[0],polylineOptions:{strokeColor:"#0099ff",strokeOpacity:1,strokeWeight:5},waypoints:s},je(t[a].route_difficulty)&&(l.badges=[{id:p[t[a].route_difficulty],name:t[a].route_difficulty[0].toUpperCase()+t[a].route_difficulty.substring(1)}],l.polylineOptions.strokeColor=g[t[a].route_difficulty]),R[e].push(l),h(e,R[e].length-1)}var u={id:t[a].id,name:e,title:t[a].title,image:t[a].images[0],logo:null,color:null,latitude:n,longitude:i,url:t[a].link,target:"_blank",icon:d,external:c};K[e].push(u)}}f(e)}}}(jQuery);