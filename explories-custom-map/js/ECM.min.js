var ECM=function(I){"use strict";function A(){navigator.geolocation?Z?P.panTo(Z):(I("#myLocationBtn").prop("disabled",!0),I(".ecm-btn-location").prop("disabled",!0),I("#myLocationBtn").addClass("ecm-btn-loading"),I(".ecm-btn-location").addClass("ecm-btn-loading"),navigator.geolocation.getCurrentPosition(function(e){Z={lat:e.coords.latitude,lng:e.coords.longitude},a=new google.maps.Marker({position:Z,map:P,optimized:!1,icon:{path:"M-20,0a20,20 0 1,0 40,0a20,20 0 1,0 -40,0",fillColor:"#06c",fillOpacity:1,strokeWeight:2,strokeColor:"#ffffff",scale:.4},title:"Your location"}),P.getBounds().contains(Z)||we(),I("#followUserCB").parent().show(),setTimeout(q,G.userPosInterval),I("#myLocationBtn").removeClass("ecm-btn-loading"),I("#myLocationBtn").hide(),I(".ecm-btn-location").removeClass("ecm-btn-loading"),I(".ecm-btn-location").prop("disabled",!1)},function(e){I("#myLocationBtn").removeClass("ecm-btn-loading"),I(".ecm-btn-location").removeClass("ecm-btn-loading"),I("#myLocationBtn").prop("disabled",!1),I(".ecm-btn-location").prop("disabled",!1),1===e.code&&alert(J[G.lan].myLocationNoPermissionInfo),console.error("Getting user location failed: "+e)},{enableHighAccuracy:!0})):console.error("Unable to get user location because geolocation is not supported by browser.")}function O(r){var a=I("#"+r).parent();a.addClass("loading");var e=P.getBounds(),t=G.externalMarkers[r].url,n=G.initLocation.lat,o=G.initLocation.lat;P.getCenter().lat()&&(n=P.getCenter().lat(),o=P.getCenter().lng()),(t=(t=(t=(t=(t=(t=t.replace("{lat}",n)).replace("{lng}",o)).replace("{north}",e.getNorthEast().lat())).replace("{east}",e.getNorthEast().lng())).replace("{south}",e.getSouthWest().lat())).replace("{west}",e.getSouthWest().lng())).includes("explori.es/api/")&&"fi"===G.lan&&(t=t.replace("lan={lan}","")),t=t.replace("{lan}",G.lan),k[r]&&k[r].abort(),k[r]=I.getJSON(t),k[r].done(function(e){a.removeClass("loading");var t=G.externalMarkers[r].callbackName;window.ECM[t].call(this,e,r)}),k[r].fail(function(e,t,a){"abort"!=a&&console.error("Loading "+r+" failed: "+t+", "+a)})}function u(t){B[t]=[];for(var e=0;e<U[t].length;e++){var a=U[t][e],r=G.externalMarkers[t].iconW,n=G.externalMarkers[t].iconH,o={lat:a.latitude,lng:a.longitude},i=new google.maps.Size(r,n);void 0!==r&&void 0!==n&&null!=r&&null!=n||(i=null);i=new google.maps.MarkerImage(a.icon,null,null,null,i),i=new google.maps.Marker({index:parseInt(e),external:!0,id:a.id,name:a.name,position:o,map:P,icon:i,optimized:!0});i.addListener("click",function(){var e=U[t][this.index];g.setContent(Me(e)),g.open(P,this),google.maps.event.clearListeners(g,"domready"),e.name&&G.routing&&G.externalMarkers[e.name].slug&&G.externalMarkers[e.name].articleApiUrl&&g.addListener("domready",function(){I(".gm-style-iw .ecm-card").click(function(e){e.preventDefault();e={view:"article",sourceSlug:I(this).attr("data-article-source"),articleId:I(this).attr("data-article-id"),articleSlug:I(this).attr("data-article-slug"),articleApiUrl:I(this).attr("data-article-api-url"),title:I(this).find("h1").text()};ae(e),ie("",e.articleApiUrl)})})}),B[t].push(i)}ne(),0<I(".ecm-feed").length&&(se(!1),se(!0))}function f(a,r){var t=z[a][r],e=new google.maps.Polyline({path:t.waypoints,geodesic:!0,strokeColor:"#ffffff",strokeOpacity:1,strokeWeight:8}),n=new google.maps.Polyline({path:t.waypoints,geodesic:!0,strokeColor:t.polylineOptions.strokeColor,strokeOpacity:t.polylineOptions.strokeOpacity,strokeWeight:t.polylineOptions.strokeWeight});e.setMap(P),T[a][r]=e,n.setMap(P),S[a][r]=n,z[a][r].length=n.getLengthInMeters(),google.maps.event.addListener(n,"mouseover",function(e){this.setOptions({strokeColor:"#8E0DD0",zIndex:2})}),google.maps.event.addListener(n,"mouseout",function(e){this.setOptions({strokeColor:t.polylineOptions.strokeColor,zIndex:1})}),google.maps.event.addListener(n,"click",function(e){var t=z[a][r];g.setContent(Me(t)),g.setPosition(e.latLng),g.open(P)})}var t,n,s,p,P,e,o,g,Z,a,r=document.getElementById("ecmScript"),m=r.src.replace(/js\/(ECM.js|ECM.min.js).*$/,""),i=r.src.replace(/explories-custom-map\/js\/(ECM.js|ECM.min.js).*$/,""),l=document.getElementById("ecm"),c="https://ecm.explories.net/themes/",F=m+"themes/default/",d=F+"default.css",h=F+"config.js",v=F+"images/map-cluster.svg",U={},z={},k=[],y=[],b=[],x=[],B={},N=null,C=[],w=[],M=[],L=[],S=[],T=[],j=[],E=[],_=null,D=!1,W={ecmMarkerClusterer:{id:"ecmMarkerClusterer",file:m+"vendor/markerclusterer-1.0.1/markerclusterer.min.js",elType:"script",loaded:!1}},G={baseTheme:null,themeName:null,routing:!1,ecmUrl:null,ecmTitle:null,markersUrl:"markers.json",routesUrl:"routes.json",lan:"fi",initLocation:{lat:60.169872,lng:24.938099},cardDefaultImg:F+"images/default-img.jpg",externalMarkers:null,mapDefaultTravelMode:"WALKING",mapInitZoom:10,mapMinZoom:0,mapMaxZoom:21,mapLayers:null,mapTypeId:"terrain",mapTypes:["roadmap","satellite","hybrid","terrain"],mapRouteMarkersThreshold:12,markerClustererOptions:{gridSize:56,zoomOnClick:!1,minimumClusterSize:2,textColor:"white",textSize:10,width:32,height:32},modes:null,offsetTop:"auto",offsetTopSel:"header",showBadgeFilters:!0,showMapFeedToggle:!0,showModeButtons:!0,showPrint:!1,showTagFilters:!0,showTypeFilters:!0,tagFiltersIcons:!0,usePlugin:!1,userPosInterval:5e3},J={en:{badgeFiltersLegend:"Badges",hybrid:"Hybrid",mapLayers:"Map layers",mapSettings:"Map settings",mapType:"Map type",mapZoom:"Map zoom",marker:"Marker",myLocation:"My location",myLocationShow:"Show my location",myLocationCenter:"Center my location on map",myLocationNoPermissionInfo:"Location is not allowed in browser settings.",roadmap:"Roadmap",route:"Route",satellite:"Satellite",shareArticle:"Share article",tagFiltersLegend:"Category",toggleTags:"Toggle all",typeFiltersLegend:"Type",terrain:"Terrain"},fi:{badgeFiltersLegend:"Badges",hybrid:"Hybridi",mapLayers:"Karttatasot",mapSettings:"Kartan asetukset",mapType:"Kartan tyyppi",mapZoom:"Kartan zoomaus",marker:"Kohde",myLocation:"Oma sijainti",myLocationShow:"Näytä sijaintini kartalla",myLocationCenter:"Keskitä kartta sijaintini mukaan",myLocationNoPermissionInfo:"Selaimen asetukset estävät sijainnin hakemisen.",roadmap:"Tiekartta",route:"Reitti",satellite:"Satelliitti",shareArticle:"Jaa artikkeli",tagFiltersLegend:"Kategoria",toggleTags:"Valitse kaikki",typeFiltersLegend:"Tyyppi",terrain:"Maastokartta"}},V={markers:{id:1,name:"marker",show:!0},routes:{id:2,name:"route",show:!0}},H=function(){if(0!=Object.keys(W).length)for(var e in W){var t,a;W.hasOwnProperty(e)&&(t=W[e],0<I("#"+e).length||("script"==t.elType?((a=document.createElement("script")).id=e,a.src=t.file,document.body.appendChild(a)):"link"==t.elType&&((a=document.createElement("link")).id=e,a.href=t.file,a.rel="stylesheet",document.body.appendChild(a)),a.onload=function(){K(this.id)}))}},K=function(e){for(var t in W[e].loaded=!0,"ecmThemeConfig"==e&&1==G.usePlugin&&(W.ecmPluginConfig={id:"ecmPluginConfig",file:i+"assets/js/front.js",elType:"script",loaded:!1},H()),W)if(W.hasOwnProperty(t)&&!W[t].loaded)return!1;return n=G.initMode,l.getAttribute("data-offset-top")?(l.style.top=l.getAttribute("data-offset-top"),G.offsetTop=l.getAttribute("data-offset-top")):"auto"==G.offsetTop&&null!=G.offsetTopSel?(ze(),I(window).resize(function(){ze()})):null!=G.offsetTop&&(document.getElementById("ecm").style.top=G.offsetTop),_e&&(localStorage.getItem("lat")&&localStorage.getItem("lng")&&(G.initLocation.lat=parseFloat(localStorage.getItem("lat")),G.initLocation.lng=parseFloat(localStorage.getItem("lng"))),localStorage.getItem("mapInitZoom")&&(G.mapInitZoom=parseInt(localStorage.getItem("mapInitZoom"))),localStorage.getItem("types")&&(V=JSON.parse(localStorage.getItem("types")))),G.baseTheme&&(l.className=G.baseTheme),R(),!0},R=function(){e=document.getElementById("ecmMap"),o={center:G.initLocation,zoom:G.mapInitZoom,minZoom:G.mapMinZoom,maxZoom:G.mapMaxZoom,zoomControl:!1,scaleControl:!0,mapTypeId:G.mapTypeId,streetViewControl:!1,fullscreenControl:!1,mapTypeControl:!1,gestureHandling:"greedy",styles:G.modes[G.initMode].styles},P=new google.maps.Map(e,o),g=new google.maps.InfoWindow({maxWidth:320,content:""}),google.maps.event.addListener(g,"content_changed",function(){var e;"function"!=typeof doGTranslate||"function"!=typeof GTranslateGetCurrentLang||(e=GTranslateGetCurrentLang())&&doGTranslate(e)}),P.addListener("zoom_changed",function(){ge(),I("#zoom").val(P.getZoom()),I("#zoomVal").text(P.getZoom()),me(),_e&&localStorage.setItem("mapInitZoom",P.getZoom())}),P.addListener("idle",function(){for(var e in G.externalMarkers)G.externalMarkers.hasOwnProperty(e)&&G.externalMarkers[e].reloadOnBoundsChange&&I("#"+e).prop("checked")&&I("#"+e).trigger("change");_e&&(localStorage.setItem("lat",P.getCenter().lat()),localStorage.setItem("lng",P.getCenter().lng()))}),P.addListener("click",function(e){g.close()}),google.maps.LatLng.prototype.kmTo=function(e){var t=Math,a=t.PI/180,r=this.lat()*a,n=e.lat()*a,o=r-n,a=this.lng()*a-e.lng()*a;return 6378.137*(2*t.asin(t.sqrt(t.pow(t.sin(o/2),2)+t.cos(r)*t.cos(n)*t.pow(t.sin(a/2),2))))},google.maps.Polyline.prototype.getLengthInMeters=function(e){for(var t=this.getPath(e),a=t.getLength(),r=0,n=0;n<a-1;n++)r+=t.getAt(n).kmTo(t.getAt(n+1));return 1e3*r},google.maps.event.addListenerOnce(P,"idle",function(){Le(),Q(),Y()})},q=function(){navigator.geolocation.getCurrentPosition(function(e){Z={lat:e.coords.latitude,lng:e.coords.longitude},a.setPosition(Z),D&&P.panTo(Z),setTimeout(q,G.userPosInterval)},function(e){console.error("Updating user location failed.")},{enableHighAccuracy:!0})},Q=function(){if(Fe(),null===G.markersUrl)return s=[],void(Array.isArray(p)&&$());var e=I.getJSON(G.markersUrl);e.done(function(e){s=e,te(),X(s),Array.isArray(p)&&$()}),e.fail(function(e,t,a){console.error("Loading markers failed: "+t+", "+a)})},Y=function(){if(Fe(),null===G.routesUrl)return p=[],void(Array.isArray(s)&&$());var e=I.getJSON(G.routesUrl);e.done(function(e){for(var t in p=e){var a;je(p[t])?p[t].travelMode?(a=Ce(p[t]),ce(t,a,p[t].polylineOptions)):ke(t):p.splice(t,1)}X(p),Array.isArray(s)&&$()}),e.fail(function(e,t,a){console.error("Loading routes failed: "+t+", "+a)})},$=function(){var e,t,a;pe(),Se(),Te(),Ze(),l.getAttribute("data-feed")?(I("#ecmSettingsBtn").trigger("click"),I("#feedCB").trigger("click")):setTimeout(function(){I("#ecmSettingsBtn").trigger("click")},500),l.getAttribute("data-article")&&l.getAttribute("data-article-api-url")?ie(l.getAttribute("data-article"),l.getAttribute("data-article-api-url")):l.getAttribute("data-article")&&ie(l.getAttribute("data-article"),null),G.routing&&(a=(a=window.location.href).replace(G.ecmUrl,""),je(a)&&"/"!=a&&(a=a.split("/"),(t=I.isNumeric(a[0])?(e=parseInt(a[0]),De(e)):(t=a[0],e=a[1],We(t)))&&(t=t.replace("{id}",e),ie("",t)))),Ue()},X=function(t){for(var a=0;a<t.length;a++){if(t[a].tags&&null!=t[a].tags)for(var r=0;r<t[a].tags.length;r++)j.some(function(e){return e.id===t[a].tags[r].id})||j.push(t[a].tags[r]);if(t[a].badges&&null!=t[a].badges)for(var n=0;n<t[a].badges.length;n++)E.some(function(e){return e.id===t[a].tags[n].id})||E.push(t[a].badges[n])}},ee=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)e[t].setMap(null);return[]},te=function(){if(x=ee(x),V.markers.show){for(var e in s){var t,a;ve(s[e])&&(null===_||null!==_&&!he(s[e])||(t={lat:s[e].latitude,lng:s[e].longitude},Ne(s[e].icon)||(s[e].icon=F+"images/markers/"+s[e].icon),a=new google.maps.MarkerImage(s[e].icon,null,null,null,new google.maps.Size(32,32)),(a=new google.maps.Marker({index:parseInt(e),id:s[e].id,position:t,map:P,icon:a,optimized:!0})).addListener("click",function(){var e=s[this.index];g.setContent(Me(e)),g.open(P,this),google.maps.event.clearListeners(g,"domready"),G.routing&&e.slug&&e.articleApiUrl&&g.addListener("domready",function(){I(".gm-style-iw .ecm-card").click(function(e){e.preventDefault();e={view:"article",sourceSlug:I(this).attr("data-article-source"),articleId:I(this).attr("data-article-id"),articleSlug:I(this).attr("data-article-slug"),articleApiUrl:I(this).attr("data-article-api-url"),title:I(this).find("h1").text()};ae(e),ie("",e.articleApiUrl)})})}),x.push(a)))}ne()}},ae=function(e){var t;G.routing&&(t="",e.sourceSlug&&(t=e.sourceSlug+"/"),e.articleId&&(t+=e.articleId+"/"),e.articleSlug&&(t+=e.articleSlug+"/"),""==t&&(t=G.ecmUrl),history.pushState(e,"",t),re(e))},re=function(e){e.title?I("title").text(e.title+" - "+G.ecmTitle):I("title").text(G.ecmTitle)},ne=function(){null!==N&&N.clearMarkers();var e=[{textColor:G.markerClustererOptions.textColor,textSize:G.markerClustererOptions.textSize,url:v,width:G.markerClustererOptions.width,height:G.markerClustererOptions.height}],t={gridSize:G.markerClustererOptions.gridSize,zoomOnClick:G.markerClustererOptions.zoomOnClick,minimumClusterSize:G.markerClustererOptions.minimumClusterSize,styles:e},a=Ie();try{N=new MarkerClusterer(P,x.concat(w,a),t)}catch(e){throw alert("Unable to load MarkerClusterer. If you are using private browsing please disable it."),new Error("MarkerClusterer is undefined. Probably caused by private browsing mode.")}google.maps.event.addListener(N,"clusterclick",function(e){oe(e.getMarkers())})},oe=function(e){var t=I('<div class="ecm-cards-container"></div>');t.click(function(){t.remove(),I("#ecmSettingsBtn").show()});for(var a=Oe({icon:"icon-close.svg",name:"close",onClick:function(){t.remove(),I("#ecmSettingsBtn").show()},size:32}),r=I('<div class="ecm-cards"></div>'),n=0;n<e.length;n++){var o=e[n].index,i=s[o];e[n].external&&(i=U[e[n].name][o]),e[n].route&&(i=p[o]),r.append(Me(i))}r.find(".ecm-card").click(function(e){e.stopPropagation(),I(this).attr("data-article-api-url")&&(e.preventDefault(),e={view:"article",sourceSlug:I(this).attr("data-article-source"),articleId:I(this).attr("data-article-id"),articleSlug:I(this).attr("data-article-slug"),articleApiUrl:I(this).attr("data-article-api-url"),title:I(this).find("h1").text()},ae(e),ie("",e.articleApiUrl))}),t.append(a),t.append(r),I("#ecm").append(t),Ze(),I("#ecmSettingsBtn").hide(),ae({view:"cluster"})},ie=function(e,t){var a,i;void 0!==t&&(a=null!=t?t:"https://explori.es/api/news/",I(".ecm-article-container").remove(),i=I('        <div class="ecm-article-container">            <div class="ecm-article">                <div class="ecm-loader"></div>            </div>        </div>'),(t=Oe({icon:"icon-close.svg",name:"close-article",size:48})).css("top",I("#ecm").css("top")),i.prepend(t),i.click(le),I("#ecm").append(i),Ze(),(e=I.getJSON(a+e)).done(function(e){var t=I('<div class="ecm-article-logo"></div>'),a=I('<div class="ecm-article-img"></div>'),r=I('<div class="ecm-article-img-caption"></div>'),n=I("<h1>"+e.title+"</h1>"),o=I('<div class="ecm-article-body"></div>');e.text?o.html(e.text):e.content&&o.html(e.content),o.find("a").attr("target","_blank"),void 0!==e.publication&&je(e.publication.image)&&(t.css("background-image","url('"+e.publication.image+"')"),je(e.publication.themeColor)&&t.css("background-color",e.publication.themeColor),I(".ecm-article").append(t)),e.caption&&je(e.caption)&&(r.append("<p>"+e.caption+"</p>"),a.append(r)),void 0!==e.images&&je(e.images.large)?(a.css("background-image","url('"+e.images.large+"')"),I(".ecm-article").append(a)):je(e.image)&&(a.css("background-image","url('"+e.image+"')"),I(".ecm-article").append(a)),o.prepend(n);a=I('<div class="ecm-article-info"></div>'),n="";e.authors&&je(e.authors)?n=e.authors:e.user&&je(e.user.name)&&(n=e.user.name),je(n)&&a.append('<p class="ecm-article-author">'+n+"</p>"),a.append('<p class="ecm-article-datetime">'+Ee(e.published)+"</p>"),o.prepend(a),i.find(".ecm-article").append(o),I(".ecm-article").click(function(e){e.stopPropagation()});a=I('            <ul class="ecm-share">                <li><a href="#" class="ecm-icon-facebook" target="_blank"><span class="sr-only">Share on Facebook</span></a></li>                <li><a href="#" class="ecm-icon-twitter" target="_blank"><span class="sr-only">Share on Twitter</span></a></li>                <li><a href="#" class="ecm-icon-linkedin" target="_blank"><span class="sr-only">Share on LinkedIn</span></a></li>            </ul>            '),o=encodeURIComponent(window.location.href);a.find(".ecm-icon-facebook").attr("href","https://www.facebook.com/sharer.php?u="+o),a.find(".ecm-icon-twitter").attr("href","https://twitter.com/share?url="+o),a.find(".ecm-icon-linkedin").attr("href","https://www.linkedin.com/cws/share?url="+o),i.find(".ecm-article").append('<h2 class="ecm-share-h">'+J[G.lan].shareArticle+"</h2>"),i.find(".ecm-article").append(a),i.find(".ecm-loader").remove(),!1===e.allowTranslate&&i.addClass("notranslate")}),e.fail(function(e,t,a){console.error("Loading Explories article failed: "+t+", "+a)}))},le=function(){I(".ecm-article-container").remove(),G.routing&&ae({})},se=function(e){if(e){var t=I('<div class="ecm-cards-container ecm-feed ecm-feed-condensed"></div>'),a=I('<div class="ecm-cards"></div>');if(V.routes.show)for(var r in p)ve(p[r])&&(null===_||he(p[r]))&&je(p[r].url)&&a.append(Me(p[r]));for(var e=Ie(),n=x.concat(e),o=0;o<n.length;o++){var i=n[o].index,l=s[i];n[o].external&&(l=U[n[o].name][i]),je(l.url)&&a.append(Me(l))}a.find(".ecm-card").click(function(e){e.stopPropagation(),I(this).attr("data-article-api-url")&&(e.preventDefault(),e={view:"article",sourceSlug:I(this).attr("data-article-source"),articleId:I(this).attr("data-article-id"),articleSlug:I(this).attr("data-article-slug"),articleApiUrl:I(this).attr("data-article-api-url"),title:I(this).find("h1").text()},ae(e),ie("",e.articleApiUrl))}),t.append(a),I("#ecm").append(t)}else I(".ecm-feed").remove()},ce=function(r,e,n){y[r]=new google.maps.DirectionsService,b[r]=new google.maps.DirectionsRenderer({routeIndex:Date.now(),suppressPolylines:!0,suppressMarkers:P.getZoom()<G.mapRouteMarkersThreshold,suppressInfoWindows:!1,preserveViewport:!0,markerOptions:{icon:{path:"M-20,0a20,20 0 1,0 40,0a20,20 0 1,0 -40,0",fillColor:n.strokeColor,fillOpacity:1,strokeWeight:2,strokeColor:"#ffffff",scale:.4}}}),b[r].setMap(P),y[r].route(e,function(e,t){var a;"OK"===t?(b[r].setDirections(e),a=e.routes[0],p[r].length=be(a),p[r].duration=xe(a),C[r]=e,ye(r,e,n)):console.error("Directions request failed due to "+t)})},de=function(e){if(S[e])for(var t=0;t<S[e].length;t++)S[e][t].setMap(null),T[e][t].setMap(null)},pe=function(){if(!function(){ee(w);for(var e=0;e<M.length;e++)if(Array.isArray(M[e])){for(var t=0;t<M[e].length;t++)M[e][t].setMap(null);b[e].setMap(null)}else M[e]&&M[e].setMap(null),L[e]&&L[e].setMap(null)}(),ee(w),w=[],V.routes.show){for(var e,t,a,r=0;r<p.length;r++)ve(p[r])&&(null===_||null!==_&&!he(p[r])||(p[r].travelMode?ye(r,C[r],p[r].polylineOptions):(ke(r),je(p[r].icon)&&(e={lat:p[r].latitude,lng:p[r].longitude},Ne(p[r].icon)||(p[r].icon=F+"images/markers/"+p[r].icon),t=new google.maps.MarkerImage(p[r].icon,null,null,null,new google.maps.Size(32,32)),t=new google.maps.Marker({index:parseInt(r),id:p[r].id,position:e,map:P,icon:t,optimized:!0,route:!0}),a=r,t.addListener("click",function(e){var t=p[a];g.setContent(Me(t)),g.setPosition(e.latLng),g.open(P)}),w.push(t)))));ge()}},ge=function(){for(var e in b)void 0!==M[e]&&null!==M[e][0].getMap()&&(b[e].setOptions({suppressMarkers:P.getZoom()<G.mapRouteMarkersThreshold}),b[e].setMap(P))},me=function(){if(G.mapLayers)for(var e=0;e<G.mapLayers.length;e++){var t=G.mapLayers[e];if(!t.minZoom||!t.maxZoom)return;t=t.minZoom>P.getZoom()||t.maxZoom<P.getZoom();I("#ecmFiltersLayers input:eq("+e+")").prop("disabled",t)}},ue=function(){P.overlayMapTypes.setAt(0,null),I("#zoom").attr("min",G.mapMinZoom),I("#zoom").attr("max",G.mapMaxZoom),P.setOptions({minZoom:G.mapMinZoom,maxZoom:G.mapMaxZoom}),_e&&localStorage.removeItem("mapLayer")},fe=function(){_={tags:[],badges:[]},I("#ecmFiltersTags .ecm-checkbox:not(.ecm-toggle-all)").each(function(){I(this).prop("checked")?_.tags.push(parseInt(I(this).val())):I("#toggleTagsCB").prop("checked",!1)}),I("#ecmFiltersBadges .ecm-checkbox").each(function(){I(this).prop("checked")&&_.badges.push(parseInt(I(this).val()))}),0==_.tags.length&&0==_.badges.length&&(_=null),_e&&localStorage.setItem("filters",JSON.stringify(_)),te(),pe(),ne(),0<I(".ecm-feed").length&&(se(!1),se(!0))},he=function(e){var t,a=!1;return e.tags&&(t=I.map(e.tags,function(e){return e.id}),a=Be(_.tags,t)),e.badges&&(e=I.map(e.badges,function(e){return e.id}),a=a&&Be(_.badges,e)),a},ve=function(e){return!e.modes||-1!=e.modes.indexOf(n)},ke=function(a){var e,t=p[a];Array.isArray(t.waypoints)&&(e=new google.maps.Polyline({path:t.waypoints,geodesic:!0,strokeColor:"#ffffff",strokeOpacity:1,strokeWeight:8}),t=new google.maps.Polyline({path:t.waypoints,geodesic:!0,strokeColor:t.polylineOptions.strokeColor,strokeOpacity:t.polylineOptions.strokeOpacity,strokeWeight:t.polylineOptions.strokeWeight}),e.setMap(P),L[a]=e,t.setMap(P),M[a]=t,p[a].length=t.getLengthInMeters(),google.maps.event.addListener(t,"click",function(e){var t=p[a];g.setContent(Me(t)),g.setPosition(e.latLng),g.open(P)}))},ye=function(a,e,t){for(var r=[],n=e.routes[0].legs,o=0;o<n.length;o++)for(var i=n[o].steps,l=0;l<i.length;l++){for(var s=i[l].path,c=new google.maps.Polyline(t),d=0;d<s.length;d++)c.getPath().push(s[d]);r.push(c),c.setMap(P),google.maps.event.addListener(c,"click",function(e){var t=p[a];g.setContent(Me(t)),g.setPosition(e.latLng),g.open(P)})}M[a]=r},be=function(e){for(var t=0,a=0;a<e.legs.length;++a)t+=e.legs[a].distance.value;return t},xe=function(e){for(var t=0,a=0;a<e.legs.length;++a)t+=e.legs[a].duration.value;return t},Ce=function(e){var t=e.waypoints[0],a=e.waypoints[e.waypoints.length-1],t=new google.maps.LatLng(t.lat,t.lng),a=new google.maps.LatLng(a.lat,a.lng),r=[];e.waypoints.shift(),e.waypoints.pop();for(var n=0;n<e.waypoints.length;n++)r.push({location:new google.maps.LatLng(e.waypoints[n].lat,e.waypoints[n].lng)});return void 0===e.travelMode&&(e.travelMode=G.mapDefaultTravelMode),{origin:t,destination:a,waypoints:r,optimizeWaypoints:!0,travelMode:e.travelMode}},we=function(){P.setZoom(P.getZoom()-1),google.maps.event.addListenerOnce(P,"idle",function(){P.getBounds().contains(Z)||we()})},Me=function(e){var t,a,r,n,o,i=I('<div class="ecm-card-wrapper text-center"></div>'),l=I('<a class="ecm-card"></a>');if(e.external&&(l.addClass("ecm-card-external"),!e.articleApiUrl&&je(e.url)&&l.append('<div class="ecm-card-external-icon"></div>'),e.logo&&(a=I('<div class="ecm-card-logo" style="background-image:url(\''+e.logo+"');\"></div>"),e.color&&a.css("background-color",e.color),l.append(a))),e.url?(l.attr("href",e.url),e.target&&l.attr("target",e.target)):e.articleApiUrl?l.attr("href","#"):l.addClass("ecm-card-no-link"),(e.image||je(G.externalMarkers[e.name].externalCardDefaultImg)||je(G.cardDefaultImg))&&(n=I('<div class="ecm-card-img-container"></div>'),a=I('<div class="ecm-card-img"></div>'),e.image?(Ne(e.image)||(e.image=m+e.image),a.css("background-image","url('"+e.image+"')")):(je(G.externalMarkers[e.name].externalCardDefaultImg)?a.css("background-image","url('"+G.externalMarkers[e.name].externalCardDefaultImg+"')"):a.css("background-image","url('"+G.cardDefaultImg+"')"),a.addClass("ecm-default-img")),n.append(a),l.append(n)),(e.badges||e.length)&&(r=I('<div class="ecm-card-info"></div>')),e.badges&&Array.isArray(e.badges))for(var s=0;s<e.badges.length;s++){var c=I('<span class="ecm-card-badge">'+e.badges[s].name+"</span>");c.addClass("ecm-card-badge-"+e.badges[s].id),r.append(c)}if(e.length&&(n=I('<span class="ecm-card-length">'+(e.length/1e3).toFixed(2)+" km</span>"),r.append(n)),(e.badges||e.length)&&l.append(r),e.title&&(o=I("<h1>"+e.title+"</h1>"),l.append(o)),e.description&&(o=I("<p>"+e.description+"</p>"),l.append(o)),e.tags&&Array.isArray(e.tags)){for(var d=I('<div class="ecm-card-tags"></div>'),p=0;p<e.tags.length;p++){Ne(e.tags[p].icon)||(e.tags[p].icon=F+"images/markers/"+e.tags[p].icon);var g=I("<img />");g.attr("src",e.tags[p].icon),g.attr("alt",e.tags[p].name),d.append(g)}l.append(d)}return G.routing&&e.slug&&e.articleApiUrl&&(t=e.articleApiUrl.replace("{id}",e.id),l.attr("data-article-api-url",t),l.attr("data-article-id",e.id),l.attr("data-article-slug",e.slug)),e.name&&G.routing&&G.externalMarkers[e.name].slug&&G.externalMarkers[e.name].articleApiUrl&&!1!==e.hasText&&(t=(t=G.externalMarkers[e.name].articleApiUrl.replace("{id}",e.id)).replace("{lan}",G.lan),l.attr("data-article-api-url",t),l.attr("data-article-source",G.externalMarkers[e.name].slug),l.attr("data-article-id",e.id),l.attr("data-article-slug",e.slug)),G.externalMarkers&&G.externalMarkers[e.name]&&!1===G.externalMarkers[e.name].allowTranslate&&l.addClass("notranslate"),i.append(l),e.hasGpx&&(l=I('<a target="_blank" href="https://locations.explories.net/api/routes/'+e.id+'/gpx" class="ecm-btn gpx-button"><img src="'+m+'images/icon-download.svg" style="width: 24px; height: 24px; vertical-align: middle;" />GPX</a>'),i.append(l)),i[0].outerHTML},Le=function(){if(G.showModeButtons&&void 0!==G.modes&&null!==G.modes){var e,t,a,r=I('<div class="ecm-mode-buttons"></div>');for(e in G.modes)G.modes.hasOwnProperty(e)&&(t=G.modes[e],(a=I('<button type="button" class="ecm-btn">'+J[G.lan][e]+"</button>")).attr("id","ecm"+e.charAt(0).toUpperCase()+e.slice(1)+"Btn"),a.attr("data-id",t.id),a.attr("data-mode",e),a.addClass("ecm-btn-"+e),e==G.initMode&&a.addClass("ecm-btn-active"),a.click(function(){var e;I(".ecm-mode-buttons .ecm-btn").removeClass("ecm-btn-active"),I(this).addClass("ecm-btn-active"),e=I(this).attr("data-mode"),void 0!==G.modes[e]?(n=e,o=G.modes[e].styles,P.setOptions({styles:o}),te(),pe()):console.error("Invalid mode")}),r.append(a));I("#ecm").append(r)}},Se=function(){var e=I('<div class="ecm-map-controls"></div>');G.showPrint&&(r=Oe({icon:"icon-print.svg",name:"print",onClick:function(){window.print()},size:32}),e.append(r));var t=Oe({icon:"icon-location.svg",name:"location",onClick:function(){A()},size:32}),a=Oe({icon:"icon-plus.svg",name:"zoom-in",onClick:function(){P.setZoom(P.getZoom()+1)},size:32}),r=Oe({icon:"icon-minus.svg",name:"zoom-out",onClick:function(){P.setZoom(P.getZoom()-1)},size:32});e.append(t),e.append(a),e.append(r),I("#ecm").append(e)},Te=function(){var e=Oe({icon:["icon-settings.svg"],id:"ecmSettingsBtn",name:"settings",onClick:function(){I("#ecmSettings").toggleClass("ecm-panel-open"),I(".ecm-feed").toggleClass("ecm-feed-condensed")},size:32});I("#ecm").append(e);var t=I('<div id="ecmSettings" class="ecm-panel ecm-panel-settings notranslate"></div>'),e=Oe({icon:["icon-close.svg"],id:"ecmCloseSettingsBtn",name:"settings-close",onClick:function(){I("#ecmSettings").toggleClass("ecm-panel-open"),I(".ecm-feed").toggleClass("ecm-feed-condensed")},size:32});if(t.append(e),G.showMapFeedToggle&&(y=Pe({id:"feedCB",className:"ecm-switch",groupClass:"ecm-switch-group",label:"Feed",labelPre:"Map",onChange:function(){se(I(this).prop("checked"))}}),t.append(y)),G.showTypeFilters){var a,r,n,o=I('<fieldset id="ecmFiltersTypes" class="ecm-filters"></fieldset>');for(a in o.append("<legend>"+J[G.lan].typeFiltersLegend+"</legend>"),V)V.hasOwnProperty(a)&&(n=V[a],r=!0,_e&&je(localStorage.getItem("types"))&&0==JSON.parse(localStorage.getItem("types"))[a].show&&(r=!1),n=Pe({id:"typeCB_"+n.id,checked:r,label:J[G.lan][n.name],onChange:function(){!function(){I("#ecmFiltersTypes .ecm-checkbox").each(function(){var e=I(this).val();V[e].show=I(this).is(":checked")}),V.markers.show||N.clearMarkers(),I("#ecmFiltersBadges").prop("disabled",!V.routes.show),I("#ecmFiltersBadges .ecm-checkbox").prop("disabled",!V.routes.show);var e=!V.markers.show&&!V.routes.show;I("#ecmFiltersTags").prop("disabled",e),I("#ecmFiltersTags .ecm-checkbox").prop("disabled",e),_e&&localStorage.setItem("types",JSON.stringify(V)),fe()}()},value:a}),o.append(n));t.append(o)}if(G.showTagFilters){var i=I('<fieldset id="ecmFiltersTags" class="ecm-filters"></fieldset>');i.append("<legend>"+J[G.lan].tagFiltersLegend+"</legend>");var l=Pe({id:"toggleTagsCB",className:"ecm-toggle-all",groupClass:"ecm-toggle-tags-group",checked:!0,label:J[G.lan].toggleTags,onChange:function(){I("#ecmFiltersTags .ecm-checkbox").prop("checked",I(this).prop("checked")),fe()}});G.tagFiltersIcons&&l.addClass("ecm-toggle-all-icon"),i.append(l);for(var s=0;s<j.length;s++){var c=j[s],d=!0;_e&&je(localStorage.getItem("filters"))&&"null"!=localStorage.getItem("filters")&&-1==JSON.parse(localStorage.getItem("filters")).tags.indexOf(c.id)&&(d=!1);d=Pe({id:"tagCB_"+c.id,checked:d,label:j[s].name,onChange:fe,value:c.id});G.tagFiltersIcons&&(d.addClass("ecm-form-group-cb-icon"),Ne(c.icon)?d.css("background-image","url('"+c.icon+"')"):d.css("background-image","url('"+F+"images/markers/"+c.icon+"')")),i.append(d)}t.append(i)}if(Array.isArray(G.externalMarkersSets)&&0<G.externalMarkersSets.length)for(var p=0;p<G.externalMarkersSets.length;p++){var g,m=G.externalMarkersSets[p],u="ecmFiltersExternalMarkers"+m.id[0].toUpperCase()+m.id.substring(1),f=I('<fieldset id="'+u+'" class="ecm-filters"></fieldset>');for(T in f.append("<legend>"+J[G.lan][m.id]+"</legend>"),m.showToggleAll&&(u=Pe({id:"toggleExternal"+m.id+"CB",className:"ecm-toggle-all",groupClass:"ecm-toggle-tags-group",checked:!0,label:J[G.lan].toggleTags,onChange:function(){var e=I(this).parent().parent();I(e).find(".ecm-checkbox:not(.ecm-toggle-all)").prop("checked",I(this).prop("checked")),I(e).find(".ecm-checkbox:not(.ecm-toggle-all)").trigger("change")}}),G.tagFiltersIcons&&u.addClass("ecm-toggle-all-icon"),f.append(u)),G.externalMarkers)G.externalMarkers.hasOwnProperty(T)&&G.externalMarkers[T].set==m.id&&(g=G.externalMarkers[T].checked,_e&&je(localStorage.getItem(T))&&(g=JSON.parse(localStorage.getItem(T))),g=Pe({id:T,label:J[G.lan][T],checked:g,onChange:function(){var e,t=I(this).parent().parent();I(this).prop("checked")?(O(I(this).attr("id")),I(t).find(".ecm-checkbox:not(.ecm-toggle-all):checked").length==I(t).find(".ecm-checkbox:not(.ecm-toggle-all)").length&&I(t).find(".ecm-toggle-all").prop("checked",!0)):(e=I(this).attr("id"),delete U[e],B[e]=ee(B[e]),delete B[e],ne(),delete z[e],de(e),0<I(".ecm-feed").length&&(se(!1),se(!0)),I(t).find(".ecm-toggle-all").prop("checked",!1)),_e&&localStorage.setItem(I(this).attr("id"),I(this).prop("checked"))},value:T}),G.tagFiltersIcons&&(g.addClass("ecm-form-group-cb-icon"),g.css("background-image","url('"+G.externalMarkers[T].filtersIcon+"')")),m.showToggleAll&&!G.externalMarkers[T].checked&&f.find(".ecm-toggle-all").prop("checked",!1),f.append(g));t.append(f)}if(G.showBadgeFilters&&0<E.length){var h=I('<fieldset id="ecmFiltersBadges" class="ecm-filters"></fieldset>');h.append("<legend>"+J[G.lan].badgeFiltersLegend+"</legend>");for(p=0;p<E.length;p++){var v=E[p],k=!0;_e&&je(localStorage.getItem("filters"))&&"null"!=localStorage.getItem("filters")&&-1==JSON.parse(localStorage.getItem("filters")).badges.indexOf(v.id)&&(k=!1);v=Pe({id:"badgeCB_"+v.id,checked:k,label:E[p].name,onChange:fe,value:v.id});h.append(v)}t.append(h)}e=I('<fieldset id="ecmFiltersMapSettings" class="ecm-filters"></fieldset>');e.append("<legend>"+J[G.lan].mapSettings+"</legend>");var y=I('<div class="ecm-form-group"></div>');y.append('<label for="mapType">'+J[G.lan].mapType+"</label><br />");for(var b,x,C=I('<select id="mapType"></select>'),w=0;w<G.mapTypes.length;w++){var M=G.mapTypes[w],L=I("<option></option>");L.attr("value",M),L.text(J[G.lan][M]),G.mapTypeId==M&&L.prop("selected",!0),C.append(L)}if(je(G.mapLayers))for(var S in G.mapLayers)G.mapLayers.hasOwnProperty(S)&&(b=G.mapLayers[S].checked,_e&&localStorage.getItem("mapLayer")==G.mapLayers[S].name&&(b=!0),(x=I("<option></option>")).attr("value",S),x.text(J[G.lan][G.mapLayers[S].name]),b&&x.prop("selected",!0),C.append(x));y.append(C),C.change(function(){var e,t,i,l;-1!=G.mapTypes.indexOf(I(this).val())?(ue(),P.setOptions({mapTypeId:I(this).val()}),_e&&localStorage.setItem("mapTypeId",I(this).val())):(e=I(this).val(),t=!0,i=G.mapLayers[e],l=new google.maps.LatLngBounds(new google.maps.LatLng(i.bounds[1],i.bounds[0]),new google.maps.LatLng(i.bounds[3],i.bounds[2])),t?(I("#ecmFiltersLayers").addClass("loading"),I("#ecmFiltersLayers .ecm-checkbox").each(function(){I(this).val()!=e&&I(this).prop("checked",!1)}),P.overlayMapTypes.setAt(0,null),G.mapMinZoom<i.minZoom&&(I("#zoom").attr("min",i.minZoom),P.setOptions({minZoom:i.minZoom})),G.mapMaxZoom>i.maxZoom&&(I("#zoom").attr("max",i.maxZoom),P.setOptions({maxZoom:i.maxZoom})),(t=new google.maps.ImageMapType({name:i.name,minZoom:i.minZoom,maxZoom:i.maxZoom,tileSize:new google.maps.Size(256,256),isPng:!0,opacity:1,getTileUrl:function(e,t){var a=P.getProjection(),r=Math.pow(2,t),n=256/r,o=256/r,o=new google.maps.LatLngBounds(a.fromPointToLatLng(new google.maps.Point(e.x*n,(e.y+1)*o)),a.fromPointToLatLng(new google.maps.Point((e.x+1)*n,e.y*o))),r=0<=e.x?e.x:r+e.x,e=e.y;if(l.intersects(o)&&t>=i.minZoom&&t<=i.maxZoom){t=i.url.replace("{zoom}",t);return t=(t=t.replace("{x}",r)).replace("{y}",e)}}})).addListener("tilesloaded",function(){I("#ecmFiltersLayers").removeClass("loading")}),P.overlayMapTypes.insertAt(0,t),_e&&localStorage.setItem("mapLayer",i.name)):ue())}),e.append(y);l=I('<div class="ecm-form-group"></div>');l.append('<label for="zoom">'+J[G.lan].mapZoom+"</label><br />"),l.append('<div class="ecm-range-labels"><span class="pull-left">-</span><span id="zoomVal">'+P.getZoom()+'</span><span class="pull-right">+</span></div>');y=I('<input id="zoom" type="range" step="1" />');y.attr("min",G.mapMinZoom),y.attr("max",G.mapMaxZoom),l.append(y),y.val(P.getZoom()),y.on("input",function(){P.setZoom(parseInt(I(this).val())),I("#zoomVal").text(I(this).val())}),e.append(l);var T,y=Oe({id:"myLocationBtn",icon:"icon-location.svg",name:"location",className:"ecm-btn-icon-text ecm-btn-block",text:J[G.lan].myLocationShow,onClick:function(){A()}}),l=Pe({id:"followUserCB",checked:D,label:J[G.lan].myLocationCenter,onChange:function(){(D=I(this).prop("checked"))&&P.panTo(Z)}});for(T in l.hide(),e.append(y),e.append(l),t.append(e),I("#ecm").append(t),fe(),G.externalMarkers)G.externalMarkers.hasOwnProperty(T)&&I("#"+T).prop("checked")&&O(T);I("#mapType").trigger("change")},Ie=function(){var e,t=[];for(e in B)if(B.hasOwnProperty(e))for(var a=0;a<B[e].length;a++)t.push(B[e][a]);return t},Ae=function(e){var t=[];if(Array.isArray(e))for(var a=0;a<e.length;a++)t.push({lat:e[a][1],lng:e[a][0]});return t},Oe=function(e){var t={className:null,disabled:!1,icon:null,id:null,name:null,onClick:null,size:null,text:null,tooltip:null};I.extend(t,e);var a,r=I('<button type="button" class="ecm-btn"></button>');if(t.disabled&&r.prop("disabled",!0),t.id&&r.attr("id",t.id),t.size&&r.addClass("ecm-btn-"+t.size),t.name&&r.addClass("ecm-btn-"+t.name),t.className&&r.addClass(t.className),t.icon)if(Array.isArray(t.icon))for(var n=0;n<t.icon.length;n++)a=I('<svg data-src="'+m+"images/"+t.icon[n]+'"></svg>'),r.append(a);else a=I('<svg data-src="'+m+"images/"+t.icon+'"></svg>'),r.append(a);return t.text&&r.append(t.text),t.onClick&&r.click(t.onClick),r},Pe=function(e){var t={checked:!1,className:null,data:null,groupClass:null,id:null,label:null,labelPre:null,name:null,onChange:null,tooltip:null,value:null};I.extend(t,e);e=I('<div class="ecm-form-group-cb"></div>');t.labelPre&&((a=I("<label></label>")).text(t.labelPre),e.append(a));var a,r=I('<input type="checkbox" class="ecm-checkbox" />');if(r.attr("id",t.id),r.attr("value",t.value),t.name&&r.attr("name",t.name),t.className&&r.addClass(t.className),t.groupClass&&e.addClass(t.groupClass),t.data)for(var n=0;n<t.data.length;n++)r.attr("data-"+t.data[n].name,t.data[n].value);return t.checked&&r.prop("checked",!0),t.onChange&&r.change(t.onChange),e.append(r),t.label&&((a=I("<label></label>")).text(t.label),a.attr("for",t.id),e.append(a)),e},Ze=function(){var e=document.querySelectorAll("svg[data-src]");SVGInjector(e,{evalScripts:!1,each:function(e){}},function(e){})},Fe=function(){I("#ecm").prepend('<div class="ecm-loader"></div>')},Ue=function(){I("#ecm > .ecm-loader").remove()},ze=function(){0<I(G.offsetTopSel).length&&(document.getElementById("ecm").style.top=I(G.offsetTopSel).outerHeight()+"px")},Be=function(t,e){return e.some(function(e){return 0<=t.indexOf(e)})},Ne=function(e){return/^((http|https):\/\/)|\/\//.test(e)},je=function(e){return null!=e&&""!=e},Ee=function(e){if(null==e||null==e||""==e)return"";e=new Date(e.replace(/-/g,"/"));return e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear()+" "+(("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2))},_e=function(){var e="test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}},De=function(e){for(var t in s)if(s[t].id==e)return s[t].articleApiUrl;return!1},We=function(e){for(var t in G.externalMarkers)if(G.externalMarkers.hasOwnProperty(t)&&G.externalMarkers[t].slug==e)return G.externalMarkers[t].articleApiUrl;return!1};return{init:function(){var e=document.createElement("div");if(e.id="ecmMap",document.getElementById("ecm").appendChild(e),"undefined"==typeof jQuery)throw new Error("ECM requires jQuery");"undefined"==typeof SVGInjector&&(W.ecmSVGi={id:"ecmSVGi",file:m+"vendor/svg-injector-1.1.3/dist/svg-injector.min.js",elType:"script",loaded:!1}),l.getAttribute("data-lan")&&(G.lan=l.getAttribute("data-lan")),l.getAttribute("data-theme")?(t=l.getAttribute("data-theme"),d=(F=m+"themes/"+t+"/")+t+".css",h=F+"config.js",v=F+"images/map-cluster.svg"):l.getAttribute("data-theme-key")&&(e=l.getAttribute("data-theme-key"),d=c+"?key="+e+"&type=css",h=c+"?key="+e+"&type=config",v=c+"?key="+e+"&type=mapCluster"),W.ecmThemeCss={id:"ecmThemeCss",file:d,elType:"link",loaded:!1},W.ecmThemeConfig={id:"ecmThemeConfig",file:h,elType:"script",loaded:!1},H(),window.onpopstate=function(e){null!=e.state&&e.state.view?null!=e.state&&"article"==e.state.view?ie("",e.state.articleApiUrl):null!=e.state&&e.state.view:I(".ecm-article-container").is(":visible")?(I(".ecm-article-container").remove(),re(e.state)):I(".ecm-cards-container").is(":visible")&&(I(".ecm-cards-container").remove(),I("#ecmSettingsBtn").show(),re(e.state))}},setConfig:function(e){for(var t in e)e.hasOwnProperty(t)&&(G[t]=e[t]);G.markersUrl&&(G.markersUrl=G.markersUrl.replace("{lan}",G.lan)),G.routesUrl&&(G.routesUrl=G.routesUrl.replace("{lan}",G.lan)),G.themeName&&(F=c+G.themeName+"/")},setTexts:function(e){for(var t in e)if(e.hasOwnProperty(t))for(var a=Object.getOwnPropertyNames(e[t]),r=0;r<a.length;r++)J[t][a[r]]=e[t][a[r]]},convertLN2ECM:function(e,t){U[t]=[];const a=G.externalMarkers[t].excludeIds&&new Set(G.externalMarkers[t].excludeIds);for(var r,n,o,i=0;i<e.length;i++)a&&a.has(e[i].id)||(e[i].images||(e[i].images={medium:e[i].thumbnail}),r="https://explori.es/fi/Article/"+e[i].id+"/"+e[i].slug,n="_blank",o=!0,G.externalMarkers[t].articleViewUrl&&(r=(r=(r=G.externalMarkers[t].articleViewUrl).replace("{id}",e[i].id)).replace("{slug}",e[i].slug),o=!(n="_self")),void 0!==G.externalMarkers[t].external&&(o=G.externalMarkers[t].external),o={id:e[i].id,name:t,title:e[i].title,slug:e[i].slug,image:e[i].images.medium,logo:e[i].publication.image,color:e[i].publication.themeColor,latitude:parseFloat(e[i].latitude),longitude:parseFloat(e[i].longitude),url:r,target:n,icon:e[i].publication.marker,external:o},G.routing&&G.externalMarkers[t].slug&&G.externalMarkers[t].articleApiUrl&&(o.articleApiUrl=G.externalMarkers[t].articleApiUrl,o.articleApiUrl=o.articleApiUrl.replace("{id}",e[i].id)),U[t].push(o));u(t)},convertLocationsDB2ECM:function(e,t){var a,r,n,o,i=G.externalMarkers[t].filtersIcon,l=G.externalMarkers[t].articleApiUrl;U[t]=[],z[t]=[],de(t),S[t]=[],T[t]=[];for(var s=0;s<e.places.length;s++)n="_blank",o=!0,void 0!==G.externalMarkers[t].external&&(o=G.externalMarkers[t].external),a={id:e.places[s].id,name:t,title:e.places[s].title,description:e.places[s].description,slug:e.places[s].slug,image:e.places[s].image,latitude:parseFloat(e.places[s].latitude),longitude:parseFloat(e.places[s].longitude),url:e.places[s].url,target:n,icon:i,external:o,hasText:!1!==e.places[s].hasText},je(l)&&a.hasText&&(a.articleApiUrl=l),U[t].push(a);for(s=0;s<e.routes.length;s++){n="_blank",o=!0,void 0!==G.externalMarkers[t].external&&(o=G.externalMarkers[t].external),a={id:e.routes[s].id,name:t,title:e.routes[s].title,slug:e.routes[s].slug,image:e.routes[s].image,latitude:parseFloat(e.routes[s].waypoints[0][0].lat),longitude:parseFloat(e.routes[s].waypoints[0][0].lng),url:e.routes[s].url,target:n,icon:i,external:o,hasGpx:e.routes[s].hasGpx,hasText:!0===e.routes[s].hasText},je(l)&&a.hasText&&(a.articleApiUrl=l),U[t].push(a);for(var c=e.routes[s].waypoints,d=0;d<c.length;d++)r={id:e.routes[s].id,name:t,title:e.routes[s].title,slug:e.routes[s].slug,image:e.routes[s].image,polylineOptions:{strokeColor:"#0099ff",strokeOpacity:1,strokeWeight:5},waypoints:c[d],hasGpx:e.routes[s].hasGpx,hasText:!0===e.routes[s].hasText},je(l)&&a.hasText&&(r.articleApiUrl=l),z[t].push(r),f(t,z[t].length-1)}u(t)},convertRetkipaikka2ECM:function(t,e){U[e]=[],z[e]=[],de(e),S[e]=[],T[e]=[];for(var a=0;a<t.length;a++){var r,n=!1;for(r in U)if(U.hasOwnProperty(r)&&-1!=r.search("retkipaikka")&&r!=e&&(n=U[r].some(function(e){return e.id===t[a].id})))break;if(!n){t[a].images||(t[a].images={medium:t[a].thumbnail});var o,i,l,s,c=!0,d="https://kartta.retkipaikka.fi/assets/marker.png",p={esteeton:0,helppo:1,keskivaativa:2,vaativa:3,luokittelematon:4},g={esteeton:"#3c3",helppo:"#03c",keskivaativa:"#c33",vaativa:"#000",luokittelematon:"#cc3"};if(t[a].marker&&(d="https://kartta.retkipaikka.fi/assets/"+t[a].marker),null!=t[a].link&&t[a].link.search("retkipaikka.fi")&&(c=!1),void 0!==G.externalMarkers[e].external&&(c=G.externalMarkers[e].external),t[a].images[0]&&(t[a].images[0]=t[a].images[0].replace("http://","https://")),"Point"==t[a].geometry.type)o=parseFloat(t[a].geometry.coordinates[1]),i=parseFloat(t[a].geometry.coordinates[0]);else if("LineString"==t[a].geometry.type)o=parseFloat(t[a].geometry.coordinates[0][1]),i=parseFloat(t[a].geometry.coordinates[0][0]),s=Ae(t[a].geometry.coordinates),l={id:t[a].id,title:t[a].title,image:t[a].images[0],polylineOptions:{strokeColor:"#0099ff",strokeOpacity:1,strokeWeight:5},waypoints:s},je(t[a].route_difficulty)&&(l.badges=[{id:p[t[a].route_difficulty],name:t[a].route_difficulty[0].toUpperCase()+t[a].route_difficulty.substring(1)}],l.polylineOptions.strokeColor=g[t[a].route_difficulty]),z[e].push(l),f(e,z[e].length-1);else if("MultiLineString"==t[a].geometry.type){o=parseFloat(t[a].geometry.coordinates[0][0][1]),i=parseFloat(t[a].geometry.coordinates[0][0][0]);for(var m=0;m<t[a].geometry.coordinates.length;m++)s=Ae(t[a].geometry.coordinates[m]),l={id:t[a].id,title:t[a].title,image:t[a].images[0],polylineOptions:{strokeColor:"#0099ff",strokeOpacity:1,strokeWeight:5},waypoints:s},je(t[a].route_difficulty)&&(l.badges=[{id:p[t[a].route_difficulty],name:t[a].route_difficulty[0].toUpperCase()+t[a].route_difficulty.substring(1)}],l.polylineOptions.strokeColor=g[t[a].route_difficulty]),z[e].push(l),f(e,z[e].length-1)}c={id:t[a].id,name:e,title:t[a].title,image:t[a].images[0],logo:null,color:null,latitude:o,longitude:i,url:t[a].link,target:"_blank",icon:d,external:c};U[e].push(c)}}u(e)}}}(jQuery);