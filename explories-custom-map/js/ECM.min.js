/**
 * ECM.min.js
 * @copyright   2018 Fakiirimedia Oy
 * @author      Hape Haavikko <hape.haavikko@fakiirimedia.com>
 * @version     1.3.5
 */
var ECM=function(_){"use strict";function W(){if(navigator.geolocation)if(H)V.panTo(H);else{_("#myLocationBtn").prop("disabled",!0),_(".ecm-btn-location").prop("disabled",!0),_("#myLocationBtn").addClass("ecm-btn-loading"),_(".ecm-btn-location").addClass("ecm-btn-loading");navigator.geolocation.getCurrentPosition(function(e){H={lat:e.coords.latitude,lng:e.coords.longitude},t=new google.maps.Marker({position:H,map:V,optimized:!1,icon:{path:"M-20,0a20,20 0 1,0 40,0a20,20 0 1,0 -40,0",fillColor:"#06c",fillOpacity:1,strokeWeight:2,strokeColor:"#ffffff",scale:.4},title:"Your location"}),V.getBounds().contains(H)||Me(),_("#followUserCB").parent().show(),setTimeout(z,X.userPosInterval),_("#myLocationBtn").removeClass("ecm-btn-loading"),_("#myLocationBtn").hide(),_(".ecm-btn-location").removeClass("ecm-btn-loading"),_(".ecm-btn-location").prop("disabled",!1)},function(e){_("#myLocationBtn").removeClass("ecm-btn-loading"),_(".ecm-btn-location").removeClass("ecm-btn-loading"),_("#myLocationBtn").prop("disabled",!1),_(".ecm-btn-location").prop("disabled",!1),console.error("Getting user location failed: "+e)},{enableHighAccuracy:!0})}else console.error("Unable to get user location because geolocation is not supported by browser.")}function D(r){var a=_("#"+r).parent();a.addClass("loading");var e=V.getBounds(),t=X.externalMarkers[r].url,i=X.initLocation.lat,o=X.initLocation.lat;V.getCenter().lat()&&(i=V.getCenter().lat(),o=V.getCenter().lng()),t=(t=(t=(t=(t=(t=t.replace("{lat}",i)).replace("{lng}",o)).replace("{north}",e.getNorthEast().lat())).replace("{east}",e.getNorthEast().lng())).replace("{south}",e.getSouthWest().lat())).replace("{west}",e.getSouthWest().lng()),k[r]&&k[r].abort(),k[r]=_.getJSON(t),k[r].done(function(e){a.removeClass("loading");var t=X.externalMarkers[r].callbackName;window.ECM[t].call(this,e,r)}),k[r].fail(function(e,t,a){"abort"!=a&&console.error("Loading "+r+" failed: "+t+", "+a)})}function f(t){q[t]=[];for(var e=0;e<R[t].length;e++){var a=R[t][e],r=X.externalMarkers[t].iconW,i=X.externalMarkers[t].iconH,o={lat:a.latitude,lng:a.longitude},n=new google.maps.Size(r,i);void 0!==r&&void 0!==i&&null!=r&&null!=i||(n=null);var l=new google.maps.MarkerImage(a.icon,null,null,null,n),s=new google.maps.Marker({index:parseInt(e),external:!0,id:a.id,name:a.name,position:o,map:V,icon:l,optimized:!0});s.addListener("click",function(){var e=R[t][this.index];m.setContent(Se(e)),m.open(V,this),google.maps.event.clearListeners(m,"domready"),e.name&&X.routing&&X.externalMarkers[e.name].slug&&X.externalMarkers[e.name].articleApiUrl&&m.addListener("domready",function(){_(".gm-style-iw .ecm-card").click(function(e){e.preventDefault();var t={view:"article",sourceSlug:_(this).attr("data-article-source"),articleId:_(this).attr("data-article-id"),articleSlug:_(this).attr("data-article-slug"),articleApiUrl:_(this).attr("data-article-api-url"),title:_(this).find("h1").text()};re(t),le("",t.articleApiUrl)})})}),q[t].push(s)}oe(),0<_(".ecm-feed").length&&(ce(!1),ce(!0))}function J(){_("#ecmFiltersTypes .ecm-checkbox").each(function(){var e=_(this).val();te[e].show=_(this).is(":checked")}),te.markers.show||w.clearMarkers(),_("#ecmFiltersBadges").prop("disabled",!te.routes.show),_("#ecmFiltersBadges .ecm-checkbox").prop("disabled",!te.routes.show);var e=!te.markers.show&&!te.routes.show;_("#ecmFiltersTags").prop("disabled",e),_("#ecmFiltersTags .ecm-checkbox").prop("disabled",e),We&&localStorage.setItem("types",JSON.stringify(te)),he()}function h(a,r){var e=G[a][r],t=new google.maps.Polyline({path:e.waypoints,geodesic:!0,strokeColor:"#ffffff",strokeOpacity:1,strokeWeight:8}),i=new google.maps.Polyline({path:e.waypoints,geodesic:!0,strokeColor:e.polylineOptions.strokeColor,strokeOpacity:e.polylineOptions.strokeOpacity,strokeWeight:e.polylineOptions.strokeWeight});t.setMap(V),I[a][r]=t,i.setMap(V),T[a][r]=i,G[a][r].length=i.getLengthInMeters(),google.maps.event.addListener(i,"click",function(e){var t=G[a][r];m.setContent(Se(t)),m.setPosition(e.latLng),m.open(V)})}var i,c,p,V,e,o,m,H,t,a=document.getElementById("ecmScript"),v=a.src.replace(/js\/(ECM.js|ECM.min.js).*$/,""),r=a.src.replace(/explories-custom-map\/js\/(ECM.js|ECM.min.js).*$/,""),n=document.getElementById("ecm"),l="https://ecm.explories.net/themes/",s="default",K=v+"themes/"+s+"/",d=K+s+".css",g=K+"config.js",u=K+"images/map-cluster.svg",R={},G={},k=[],y=[],b=[],C=[],q={},w=null,x=[],M=[],S=[],L=[],T=[],I=[],Q=[],Y=[],A=null,$=!1,O={ecmMarkerClusterer:{id:"ecmMarkerClusterer",file:v+"vendor/markerclusterer-1.0.1/markerclusterer.min.js",elType:"script",loaded:!1}},X={baseTheme:null,themeName:null,routing:!1,ecmUrl:null,ecmTitle:null,markersUrl:"markers.json",routesUrl:"routes.json",lan:"fi",initLocation:{lat:60.169872,lng:24.938099},cardDefaultImg:K+"images/default-img.jpg",externalMarkers:null,mapDefaultTravelMode:"WALKING",mapInitZoom:10,mapMinZoom:0,mapMaxZoom:21,mapLayers:null,mapTypeId:"terrain",mapTypes:["roadmap","satellite","hybrid","terrain"],mapRouteMarkersThreshold:12,markerClustererOptions:{gridSize:56,zoomOnClick:!1,minimumClusterSize:2,textColor:"white",textSize:10,width:32,height:32},modes:null,offsetTop:"auto",offsetTopSel:"header",showBadgeFilters:!0,showMapFeedToggle:!0,showModeButtons:!0,showPrint:!1,showTagFilters:!0,showTypeFilters:!0,tagFiltersIcons:!0,usePlugin:!1,userPosInterval:5e3},ee={en:{badgeFiltersLegend:"Badges",hybrid:"Hybrid",mapLayers:"Map layers",mapSettings:"Map settings",mapType:"Map type",mapZoom:"Map zoom",marker:"Marker",myLocation:"My location",myLocationShow:"Show my location",myLocationCenter:"Center my location on map",roadmap:"Roadmap",route:"Route",satellite:"Satellite",shareArticle:"Share article",tagFiltersLegend:"Category",toggleTags:"Toggle all",typeFiltersLegend:"Type",terrain:"Terrain"},fi:{badgeFiltersLegend:"Badges",hybrid:"Hybridi",mapLayers:"Karttatasot",mapSettings:"Kartan asetukset",mapType:"Kartan tyyppi",mapZoom:"Kartan zoomaus",marker:"Kohde",myLocation:"Oma sijainti",myLocationShow:"Näytä sijaintini kartalla",myLocationCenter:"Keskitä kartta sijaintini mukaan",roadmap:"Tiekartta",route:"Reitti",satellite:"Satelliitti",shareArticle:"Jaa artikkeli",tagFiltersLegend:"Kategoria",toggleTags:"Valitse kaikki",typeFiltersLegend:"Tyyppi",terrain:"Maastokartta"}},te={markers:{id:1,name:"marker",show:!0},routes:{id:2,name:"route",show:!0}},Z=function(){if(0!=Object.keys(O).length)for(var e in O)if(O.hasOwnProperty(e)){var t,a=O[e];if(0<_("#"+e).length)continue;"script"==a.elType?((t=document.createElement("script")).id=e,t.src=a.file,document.body.appendChild(t)):"link"==a.elType&&((t=document.createElement("link")).id=e,t.href=a.file,t.rel="stylesheet",document.body.appendChild(t)),t.onload=function(){P(this.id)}}},P=function(e){for(var t in O[e].loaded=!0,"ecmThemeConfig"==e&&1==X.usePlugin&&(O.ecmPluginConfig={id:"ecmPluginConfig",file:r+"assets/js/front.js",elType:"script",loaded:!1},Z()),O)if(O.hasOwnProperty(t)&&!O[t].loaded)return!1;return i=X.initMode,n.getAttribute("data-offset-top")?(n.style.top=n.getAttribute("data-offset-top"),X.offsetTop=n.getAttribute("data-offset-top")):"auto"==X.offsetTop&&null!=X.offsetTopSel?(Be(),_(window).resize(function(){Be()})):null!=X.offsetTop&&(document.getElementById("ecm").style.top=X.offsetTop),We&&(localStorage.getItem("lat")&&localStorage.getItem("lng")&&(X.initLocation.lat=parseFloat(localStorage.getItem("lat")),X.initLocation.lng=parseFloat(localStorage.getItem("lng"))),localStorage.getItem("mapInitZoom")&&(X.mapInitZoom=parseInt(localStorage.getItem("mapInitZoom"))),localStorage.getItem("types")&&(te=JSON.parse(localStorage.getItem("types")))),X.baseTheme&&(n.className=X.baseTheme),F(),!0},F=function(){e=document.getElementById("ecmMap"),o={center:X.initLocation,zoom:X.mapInitZoom,minZoom:X.mapMinZoom,maxZoom:X.mapMaxZoom,zoomControl:!1,scaleControl:!0,mapTypeId:X.mapTypeId,streetViewControl:!1,fullscreenControl:!1,mapTypeControl:!1,gestureHandling:"greedy",styles:X.modes[X.initMode].styles},V=new google.maps.Map(e,o),m=new google.maps.InfoWindow({maxWidth:320,content:""}),V.addListener("zoom_changed",function(){ge(),_("#zoom").val(V.getZoom()),_("#zoomVal").text(V.getZoom()),ue(),We&&localStorage.setItem("mapInitZoom",V.getZoom())}),V.addListener("idle",function(){for(var e in X.externalMarkers)X.externalMarkers.hasOwnProperty(e)&&X.externalMarkers[e].reloadOnBoundsChange&&_("#"+e).prop("checked")&&_("#"+e).trigger("change");We&&(localStorage.setItem("lat",V.getCenter().lat()),localStorage.setItem("lng",V.getCenter().lng()))}),V.addListener("click",function(e){m.close()}),google.maps.LatLng.prototype.kmTo=function(e){var t=Math,a=t.PI/180,r=this.lat()*a,i=e.lat()*a,o=r-i,n=this.lng()*a-e.lng()*a;return 6378.137*(2*t.asin(t.sqrt(t.pow(t.sin(o/2),2)+t.cos(r)*t.cos(i)*t.pow(t.sin(n/2),2))))},google.maps.Polyline.prototype.getLengthInMeters=function(e){for(var t=this.getPath(e),a=t.getLength(),r=0,i=0;i<a-1;i++)r+=t.getAt(i).kmTo(t.getAt(i+1));return 1e3*r},google.maps.event.addListenerOnce(V,"idle",function(){Le(),U(),B()})},z=function(){navigator.geolocation.getCurrentPosition(function(e){H={lat:e.coords.latitude,lng:e.coords.longitude},t.setPosition(H),$&&V.panTo(H),setTimeout(z,X.userPosInterval)},function(e){console.error("Updating user location failed.")},{enableHighAccuracy:!0})},U=function(){if(ze(),null===X.markersUrl)return c=[],void(Array.isArray(p)&&N());var e=_.getJSON(X.markersUrl);e.done(function(e){c=e,E(),j(c),Array.isArray(p)&&N()}),e.fail(function(e,t,a){console.error("Loading markers failed: "+t+", "+a)})},B=function(){if(ze(),null===X.routesUrl)return p=[],void(Array.isArray(c)&&N());var e=_.getJSON(X.routesUrl);e.done(function(e){for(var t in p=e)if(Ee(p[t]))if(p[t].travelMode){var a=xe(p[t]);de(t,a,p[t].polylineOptions)}else ye(t);else p.splice(t,1);j(p),Array.isArray(c)&&N()}),e.fail(function(e,t,a){console.error("Loading routes failed: "+t+", "+a)})},N=function(){if(me(),Te(),Ie(),Fe(),n.getAttribute("data-feed")?(_("#ecmSettingsBtn").trigger("click"),_("#feedCB").trigger("click")):setTimeout(function(){_("#ecmSettingsBtn").trigger("click")},500),n.getAttribute("data-article")&&n.getAttribute("data-article-api-url")?le(n.getAttribute("data-article"),n.getAttribute("data-article-api-url")):n.getAttribute("data-article")&&le(n.getAttribute("data-article"),null),X.routing){var e=window.location.href;if(e=e.replace(X.ecmUrl,""),Ee(e)&&"/"!=e){var t,a,r,i=e.split("/");(r=_.isNumeric(i[0])?(a=parseInt(i[0]),De(a)):(t=i[0],a=i[1],Je(t)))&&(r=r.replace("{id}",a),le("",r))}}Ue()},j=function(t){for(var a=0;a<t.length;a++){if(t[a].tags&&null!=t[a].tags)for(var r=0;r<t[a].tags.length;r++){Q.some(function(e){return e.id===t[a].tags[r].id})||Q.push(t[a].tags[r])}if(t[a].badges&&null!=t[a].badges)for(var i=0;i<t[a].badges.length;i++){Y.some(function(e){return e.id===t[a].tags[i].id})||Y.push(t[a].badges[i])}}},ae=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)e[t].setMap(null);return[]},E=function(){if(C=ae(C),te.markers.show){for(var e in c)if(ke(c[e])&&(null===A||ve(c[e]))){var t={lat:c[e].latitude,lng:c[e].longitude};je(c[e].icon)||(c[e].icon=K+"images/markers/"+c[e].icon);var a=new google.maps.MarkerImage(c[e].icon,null,null,null,new google.maps.Size(32,32)),r=new google.maps.Marker({index:parseInt(e),id:c[e].id,position:t,map:V,icon:a,optimized:!0});r.addListener("click",function(){var e=c[this.index];m.setContent(Se(e)),m.open(V,this),google.maps.event.clearListeners(m,"domready"),X.routing&&e.slug&&e.articleApiUrl&&m.addListener("domready",function(){_(".gm-style-iw .ecm-card").click(function(e){e.preventDefault();var t={view:"article",sourceSlug:_(this).attr("data-article-source"),articleId:_(this).attr("data-article-id"),articleSlug:_(this).attr("data-article-slug"),articleApiUrl:_(this).attr("data-article-api-url"),title:_(this).find("h1").text()};re(t),le("",t.articleApiUrl)})})}),C.push(r)}oe()}},re=function(e){if(X.routing){var t="";e.sourceSlug&&(t=e.sourceSlug+"/"),e.articleId&&(t+=e.articleId+"/"),e.articleSlug&&(t+=e.articleSlug+"/"),""==t&&(t=X.ecmUrl),history.pushState(e,"",t),ie(e)}},ie=function(e){e.title?_("title").text(e.title+" - "+X.ecmTitle):_("title").text(X.ecmTitle)},oe=function(){null!==w&&w.clearMarkers();var e=[{textColor:X.markerClustererOptions.textColor,textSize:X.markerClustererOptions.textSize,url:u,width:X.markerClustererOptions.width,height:X.markerClustererOptions.height}],t={gridSize:X.markerClustererOptions.gridSize,zoomOnClick:X.markerClustererOptions.zoomOnClick,minimumClusterSize:X.markerClustererOptions.minimumClusterSize,styles:e},a=Ae();try{w=new MarkerClusterer(V,C.concat(M,a),t)}catch(e){throw alert("Unable to load MarkerClusterer. If you are using private browsing please disable it."),new Error("MarkerClusterer is undefined. Probably caused by private browsing mode.")}google.maps.event.addListener(w,"clusterclick",function(e){ne(e.getMarkers())})},ne=function(e){var t=_('<div class="ecm-cards-container"></div>');t.click(function(){t.remove(),_("#ecmSettingsBtn").show()});for(var a=Ze({icon:"icon-close.svg",name:"close",onClick:function(){t.remove(),_("#ecmSettingsBtn").show()},size:32}),r=_('<div class="ecm-cards"></div>'),i=0;i<e.length;i++){var o=e[i].index,n=c[o];e[i].external&&(n=R[e[i].name][o]),e[i].route&&(n=p[o]),r.append(Se(n))}r.find(".ecm-card").click(function(e){if(e.stopPropagation(),_(this).attr("data-article-api-url")){e.preventDefault();var t={view:"article",sourceSlug:_(this).attr("data-article-source"),articleId:_(this).attr("data-article-id"),articleSlug:_(this).attr("data-article-slug"),articleApiUrl:_(this).attr("data-article-api-url"),title:_(this).find("h1").text()};re(t),le("",t.articleApiUrl)}}),t.append(a),t.append(r),_("#ecm").append(t),Fe(),_("#ecmSettingsBtn").hide(),re({view:"cluster"})},le=function(e,t){var a="https://explori.es/api/news/";null!=t&&(a=t),_(".ecm-article-container").remove();var d=_('        <div class="ecm-article-container">            <div class="ecm-article">                <div class="ecm-loader"></div>            </div>        </div>'),r=Ze({icon:"icon-close.svg",name:"close-article",size:48});r.css("top",_("#ecm").css("top")),d.prepend(r),d.click(se),_("#ecm").append(d),Fe();var i=_.getJSON(a+e);i.done(function(e){var t=_('<div class="ecm-article-logo"></div>'),a=_('<div class="ecm-article-img"></div>'),r=_('<div class="ecm-article-img-caption"></div>'),i=_("<h1>"+e.title+"</h1>"),o=_('<div class="ecm-article-body"></div>');e.text?o.html(e.text):e.content&&o.html(e.content),void 0!==e.publication&&Ee(e.publication.image)&&(t.css("background-image","url('"+e.publication.image+"')"),Ee(e.publication.themeColor)&&t.css("background-color",e.publication.themeColor),_(".ecm-article").append(t)),e.caption&&Ee(e.caption)&&(r.append("<p>"+e.caption+"</p>"),a.append(r)),void 0!==e.images&&Ee(e.images.large)?(a.css("background-image","url('"+e.images.large+"')"),_(".ecm-article").append(a)):Ee(e.image)&&(a.css("background-image","url('"+e.image+"')"),_(".ecm-article").append(a)),o.prepend(i);var n=_('<div class="ecm-article-info"></div>'),l="";e.authors&&Ee(e.authors)?l=e.authors:e.user&&Ee(e.user.name)&&(l=e.user.name),Ee(l)&&n.append('<p class="ecm-article-author">'+l+"</p>"),n.append('<p class="ecm-article-datetime">'+_e(e.published)+"</p>"),o.prepend(n),d.find(".ecm-article").append(o),_(".ecm-article").click(function(e){e.stopPropagation()});var s=_('            <ul class="ecm-share">                <li><a href="#" class="ecm-icon-facebook" target="_blank"><span class="sr-only">Share on Facebook</span></a></li>                <li><a href="#" class="ecm-icon-twitter" target="_blank"><span class="sr-only">Share on Twitter</span></a></li>                <li><a href="#" class="ecm-icon-linkedin" target="_blank"><span class="sr-only">Share on LinkedIn</span></a></li>            </ul>            '),c=encodeURIComponent(window.location.href);s.find(".ecm-icon-facebook").attr("href","https://www.facebook.com/sharer.php?u="+c),s.find(".ecm-icon-twitter").attr("href","https://twitter.com/share?url="+c),s.find(".ecm-icon-linkedin").attr("href","https://www.linkedin.com/cws/share?url="+c),d.find(".ecm-article").append('<h2 class="ecm-share-h">'+ee[X.lan].shareArticle+"</h2>"),d.find(".ecm-article").append(s),d.find(".ecm-loader").remove()}),i.fail(function(e,t,a){console.error("Loading Explories article failed: "+t+", "+a)})},se=function(){_(".ecm-article-container").remove(),X.routing&&re({})},ce=function(e){if(e){var t=_('<div class="ecm-cards-container ecm-feed ecm-feed-condensed"></div>'),a=_('<div class="ecm-cards"></div>');if(te.routes.show)for(var r in p)ke(p[r])&&(null===A||ve(p[r]))&&Ee(p[r].url)&&a.append(Se(p[r]));for(var i=Ae(),o=C.concat(i),n=0;n<o.length;n++){var l=o[n].index,s=c[l];o[n].external&&(s=R[o[n].name][l]),Ee(s.url)&&a.append(Se(s))}a.find(".ecm-card").click(function(e){if(e.stopPropagation(),_(this).attr("data-article-api-url")){e.preventDefault();var t={view:"article",sourceSlug:_(this).attr("data-article-source"),articleId:_(this).attr("data-article-id"),articleSlug:_(this).attr("data-article-slug"),articleApiUrl:_(this).attr("data-article-api-url"),title:_(this).find("h1").text()};re(t),le("",t.articleApiUrl)}}),t.append(a),_("#ecm").append(t)}else _(".ecm-feed").remove()},de=function(r,e,i){y[r]=new google.maps.DirectionsService,b[r]=new google.maps.DirectionsRenderer({routeIndex:Date.now(),suppressPolylines:!0,suppressMarkers:V.getZoom()<X.mapRouteMarkersThreshold,suppressInfoWindows:!1,preserveViewport:!0,markerOptions:{icon:{path:"M-20,0a20,20 0 1,0 40,0a20,20 0 1,0 -40,0",fillColor:i.strokeColor,fillOpacity:1,strokeWeight:2,strokeColor:"#ffffff",scale:.4}}}),b[r].setMap(V),y[r].route(e,function(e,t){if("OK"===t){b[r].setDirections(e);var a=e.routes[0];p[r].length=Ce(a),p[r].duration=we(a),x[r]=e,be(r,e,i)}else console.error("Directions request failed due to "+t)})},pe=function(e){if(T[e])for(var t=0;t<T[e].length;t++)T[e][t].setMap(null),I[e][t].setMap(null)},me=function(){if(!function(){ae(M);for(var e=0;e<S.length;e++)if(Array.isArray(S[e])){for(var t=0;t<S[e].length;t++)S[e][t].setMap(null);b[e].setMap(null)}else S[e]&&S[e].setMap(null),L[e]&&L[e].setMap(null)}(),ae(M),M=[],te.routes.show){for(var e=0;e<p.length;e++)if(ke(p[e])&&(null===A||ve(p[e])))if(p[e].travelMode)be(e,x[e],p[e].polylineOptions);else if(ye(e),Ee(p[e].icon)){var t={lat:p[e].latitude,lng:p[e].longitude};je(p[e].icon)||(p[e].icon=K+"images/markers/"+p[e].icon);var a=new google.maps.MarkerImage(p[e].icon,null,null,null,new google.maps.Size(32,32)),r=new google.maps.Marker({index:parseInt(e),id:p[e].id,position:t,map:V,icon:a,optimized:!0,route:!0}),i=e;r.addListener("click",function(e){var t=p[i];m.setContent(Se(t)),m.setPosition(e.latLng),m.open(V)}),M.push(r)}ge()}},ge=function(){for(var e in b)void 0!==S[e]&&null!==S[e][0].getMap()&&(b[e].setOptions({suppressMarkers:V.getZoom()<X.mapRouteMarkersThreshold}),b[e].setMap(V))},ue=function(){if(X.mapLayers)for(var e=0;e<X.mapLayers.length;e++){var t=X.mapLayers[e];if(!t.minZoom||!t.maxZoom)return;var a=t.minZoom>V.getZoom()||t.maxZoom<V.getZoom();_("#ecmFiltersLayers input:eq("+e+")").prop("disabled",a)}},fe=function(){V.overlayMapTypes.setAt(0,null),_("#zoom").attr("min",X.mapMinZoom),_("#zoom").attr("max",X.mapMaxZoom),V.setOptions({minZoom:X.mapMinZoom,maxZoom:X.mapMaxZoom}),We&&localStorage.removeItem("mapLayer")},he=function(){A={tags:[],badges:[]},_("#ecmFiltersTags .ecm-checkbox:not(.ecm-toggle-all)").each(function(){_(this).prop("checked")?A.tags.push(parseInt(_(this).val())):_("#toggleTagsCB").prop("checked",!1)}),_("#ecmFiltersBadges .ecm-checkbox").each(function(){_(this).prop("checked")&&A.badges.push(parseInt(_(this).val()))}),0==A.tags.length&&0==A.badges.length&&(A=null),We&&localStorage.setItem("filters",JSON.stringify(A)),E(),me(),oe(),0<_(".ecm-feed").length&&(ce(!1),ce(!0))},ve=function(e){var t=!1;if(e.tags){var a=_.map(e.tags,function(e){return e.id});t=Ne(A.tags,a)}if(e.badges){var r=_.map(e.badges,function(e){return e.id});t=t&&Ne(A.badges,r)}return t},ke=function(e){return!e.modes||-1!=e.modes.indexOf(i)},ye=function(a){var e=p[a];if(Array.isArray(e.waypoints)){var t=new google.maps.Polyline({path:e.waypoints,geodesic:!0,strokeColor:"#ffffff",strokeOpacity:1,strokeWeight:8}),r=new google.maps.Polyline({path:e.waypoints,geodesic:!0,strokeColor:e.polylineOptions.strokeColor,strokeOpacity:e.polylineOptions.strokeOpacity,strokeWeight:e.polylineOptions.strokeWeight});t.setMap(V),L[a]=t,r.setMap(V),S[a]=r,p[a].length=r.getLengthInMeters(),google.maps.event.addListener(r,"click",function(e){var t=p[a];m.setContent(Se(t)),m.setPosition(e.latLng),m.open(V)})}},be=function(a,e,t){for(var r=[],i=e.routes[0].legs,o=0;o<i.length;o++)for(var n=i[o].steps,l=0;l<n.length;l++){for(var s=n[l].path,c=new google.maps.Polyline(t),d=0;d<s.length;d++)c.getPath().push(s[d]);r.push(c),c.setMap(V),google.maps.event.addListener(c,"click",function(e){var t=p[a];m.setContent(Se(t)),m.setPosition(e.latLng),m.open(V)})}S[a]=r},Ce=function(e){for(var t=0,a=0;a<e.legs.length;++a)t+=e.legs[a].distance.value;return t},we=function(e){for(var t=0,a=0;a<e.legs.length;++a)t+=e.legs[a].duration.value;return t},xe=function(e){var t=e.waypoints[0],a=e.waypoints[e.waypoints.length-1],r=new google.maps.LatLng(t.lat,t.lng),i=new google.maps.LatLng(a.lat,a.lng),o=[];e.waypoints.shift(),e.waypoints.pop();for(var n=0;n<e.waypoints.length;n++)o.push({location:new google.maps.LatLng(e.waypoints[n].lat,e.waypoints[n].lng)});return void 0===e.travelMode&&(e.travelMode=X.mapDefaultTravelMode),{origin:r,destination:i,waypoints:o,optimizeWaypoints:!0,travelMode:e.travelMode}},Me=function(){V.setZoom(V.getZoom()-1),google.maps.event.addListenerOnce(V,"idle",function(){V.getBounds().contains(H)||Me()})},Se=function(e){var t,a=_('<a class="ecm-card"></a>');if(e.external&&(a.addClass("ecm-card-external"),e.articleApiUrl||a.append('<div class="ecm-card-external-icon"></div>'),Ee(e.logo))){var r=_('<div class="ecm-card-logo" style="background-image:url(\''+e.logo+"');\"></div>");Ee(e.color)&&r.css("background-color",e.color),a.append(r)}if(e.url?(a.attr("href",e.url),e.target&&a.attr("target",e.target)):a.addClass("ecm-card-no-link"),e.image||Ee(X.cardDefaultImg)){var i=_('<div class="ecm-card-img-container"></div>'),o=_('<div class="ecm-card-img"></div>');e.image?(je(e.image)||(e.image=v+e.image),o.css("background-image","url('"+e.image+"')")):(o.css("background-image","url('"+X.cardDefaultImg+"')"),o.addClass("ecm-default-img")),i.append(o),a.append(i)}if(e.badges||e.length)var n=_('<div class="ecm-card-info"></div>');if(e.badges&&Array.isArray(e.badges))for(var l=0;l<e.badges.length;l++){var s=_('<span class="ecm-card-badge">'+e.badges[l].name+"</span>");s.addClass("ecm-card-badge-"+e.badges[l].id),n.append(s)}if(e.length){var c=_('<span class="ecm-card-length">'+(e.length/1e3).toFixed(2)+" km</span>");n.append(c)}if((e.badges||e.length)&&a.append(n),e.title){var d=_("<h1>"+e.title+"</h1>");a.append(d)}if(e.description){var p=_("<p>"+e.description+"</p>");a.append(p)}if(e.tags&&Array.isArray(e.tags)){for(var m=_('<div class="ecm-card-tags"></div>'),g=0;g<e.tags.length;g++){je(e.tags[g].icon)||(e.tags[g].icon=K+"images/markers/"+e.tags[g].icon);var u=_("<img />");u.attr("src",e.tags[g].icon),u.attr("alt",e.tags[g].name),m.append(u)}a.append(m)}return X.routing&&e.slug&&e.articleApiUrl&&(t=e.articleApiUrl.replace("{id}",e.id),a.attr("data-article-api-url",t),a.attr("data-article-id",e.id),a.attr("data-article-slug",e.slug)),e.name&&X.routing&&X.externalMarkers[e.name].slug&&X.externalMarkers[e.name].articleApiUrl&&(t=X.externalMarkers[e.name].articleApiUrl.replace("{id}",e.id),a.attr("data-article-api-url",t),a.attr("data-article-source",X.externalMarkers[e.name].slug),a.attr("data-article-id",e.id),a.attr("data-article-slug",e.slug)),a[0].outerHTML},Le=function(){if(X.showModeButtons&&void 0!==X.modes&&null!==X.modes){var e=_('<div class="ecm-mode-buttons"></div>');for(var t in X.modes)if(X.modes.hasOwnProperty(t)){var a=X.modes[t],r=_('<button type="button" class="ecm-btn">'+ee[X.lan][t]+"</button>");r.attr("id","ecm"+t.charAt(0).toUpperCase()+t.slice(1)+"Btn"),r.attr("data-id",a.id),r.attr("data-mode",t),r.addClass("ecm-btn-"+t),t==X.initMode&&r.addClass("ecm-btn-active"),r.click(function(){var e;_(".ecm-mode-buttons .ecm-btn").removeClass("ecm-btn-active"),_(this).addClass("ecm-btn-active"),e=_(this).attr("data-mode"),void 0!==X.modes[e]?(i=e,o=X.modes[e].styles,V.setOptions({styles:o}),E(),me()):console.error("Invalid mode")}),e.append(r)}_("#ecm").append(e)}},Te=function(){var e=_('<div class="ecm-map-controls"></div>');if(X.showPrint){var t=Ze({icon:"icon-print.svg",name:"print",onClick:function(){window.print()},size:32});e.append(t)}var a=Ze({icon:"icon-location.svg",name:"location",onClick:function(){W()},size:32}),r=Ze({icon:"icon-plus.svg",name:"zoom-in",onClick:function(){V.setZoom(V.getZoom()+1)},size:32}),i=Ze({icon:"icon-minus.svg",name:"zoom-out",onClick:function(){V.setZoom(V.getZoom()-1)},size:32});e.append(a),e.append(r),e.append(i),_("#ecm").append(e)},Ie=function(){var e=Ze({icon:["icon-settings.svg"],id:"ecmSettingsBtn",name:"settings",onClick:function(){_("#ecmSettings").toggleClass("ecm-panel-open"),_(".ecm-feed").toggleClass("ecm-feed-condensed")},size:32});_("#ecm").append(e);var t=_('<div id="ecmSettings" class="ecm-panel ecm-panel-settings"></div>'),a=Ze({icon:["icon-close.svg"],id:"ecmCloseSettingsBtn",name:"settings-close",onClick:function(){_("#ecmSettings").toggleClass("ecm-panel-open"),_(".ecm-feed").toggleClass("ecm-feed-condensed")},size:32});if(t.append(a),X.showMapFeedToggle){var r=Pe({id:"feedCB",className:"ecm-switch",groupClass:"ecm-switch-group",label:"Feed",labelPre:"Map",onChange:function(){ce(_(this).prop("checked"))}});t.append(r)}if(X.showTypeFilters){var i=_('<fieldset id="ecmFiltersTypes" class="ecm-filters"></fieldset>');for(var o in i.append("<legend>"+ee[X.lan].typeFiltersLegend+"</legend>"),te)if(te.hasOwnProperty(o)){var n=te[o],l=!0;if(We&&Ee(localStorage.getItem("types")))0==JSON.parse(localStorage.getItem("types"))[o].show&&(l=!1);var s=Pe({id:"typeCB_"+n.id,checked:l,label:ee[X.lan][n.name],onChange:function(){J()},value:o});i.append(s)}t.append(i)}if(X.showTagFilters){var c=_('<fieldset id="ecmFiltersTags" class="ecm-filters"></fieldset>');c.append("<legend>"+ee[X.lan].tagFiltersLegend+"</legend>");var d=Pe({id:"toggleTagsCB",className:"ecm-toggle-all",groupClass:"ecm-toggle-tags-group",checked:!0,label:ee[X.lan].toggleTags,onChange:function(){_("#ecmFiltersTags .ecm-checkbox").prop("checked",_(this).prop("checked")),he()}});X.tagFiltersIcons&&d.addClass("ecm-toggle-all-icon"),c.append(d);for(var p=0;p<Q.length;p++){var m=Q[p],g=!0;if(We&&Ee(localStorage.getItem("filters"))&&"null"!=localStorage.getItem("filters"))-1==JSON.parse(localStorage.getItem("filters")).tags.indexOf(m.id)&&(g=!1);var u=Pe({id:"tagCB_"+m.id,checked:g,label:Q[p].name,onChange:he,value:m.id});X.tagFiltersIcons&&(u.addClass("ecm-form-group-cb-icon"),je(m.icon)?u.css("background-image","url('"+m.icon+"')"):u.css("background-image","url('"+K+"images/markers/"+m.icon+"')")),c.append(u)}t.append(c)}if(Array.isArray(X.externalMarkersSets)&&0<X.externalMarkersSets.length)for(var f=0;f<X.externalMarkersSets.length;f++){var h=X.externalMarkersSets[f],v="ecmFiltersExternalMarkers"+h.id[0].toUpperCase()+h.id.substring(1),k=_('<fieldset id="'+v+'" class="ecm-filters"></fieldset>');if(k.append("<legend>"+ee[X.lan][h.id]+"</legend>"),h.showToggleAll){var y=Pe({id:"toggleExternal"+h.id+"CB",className:"ecm-toggle-all",groupClass:"ecm-toggle-tags-group",checked:!0,label:ee[X.lan].toggleTags,onChange:function(){var e=_(this).parent().parent();_(e).find(".ecm-checkbox:not(.ecm-toggle-all)").prop("checked",_(this).prop("checked")),_(e).find(".ecm-checkbox:not(.ecm-toggle-all)").trigger("change")}});X.tagFiltersIcons&&y.addClass("ecm-toggle-all-icon"),k.append(y)}for(var b in X.externalMarkers)if(X.externalMarkers.hasOwnProperty(b)&&X.externalMarkers[b].set==h.id){var C=X.externalMarkers[b].checked;We&&Ee(localStorage.getItem(b))&&(C=JSON.parse(localStorage.getItem(b)));var w=Pe({id:b,label:ee[X.lan][b],checked:C,onChange:function(){var e,t=_(this).parent().parent();_(this).prop("checked")?(D(_(this).attr("id")),_(t).find(".ecm-checkbox:not(.ecm-toggle-all):checked").length==_(t).find(".ecm-checkbox:not(.ecm-toggle-all)").length&&_(t).find(".ecm-toggle-all").prop("checked",!0)):(e=_(this).attr("id"),delete R[e],q[e]=ae(q[e]),delete q[e],oe(),delete G[e],pe(e),0<_(".ecm-feed").length&&(ce(!1),ce(!0)),_(t).find(".ecm-toggle-all").prop("checked",!1)),We&&localStorage.setItem(_(this).attr("id"),_(this).prop("checked"))},value:b});X.tagFiltersIcons&&(w.addClass("ecm-form-group-cb-icon"),w.css("background-image","url('"+X.externalMarkers[b].filtersIcon+"')")),h.showToggleAll&&!X.externalMarkers[b].checked&&k.find(".ecm-toggle-all").prop("checked",!1),k.append(w)}t.append(k)}if(X.showBadgeFilters&&0<Y.length){var x=_('<fieldset id="ecmFiltersBadges" class="ecm-filters"></fieldset>');x.append("<legend>"+ee[X.lan].badgeFiltersLegend+"</legend>");for(f=0;f<Y.length;f++){var M=Y[f],S=!0;if(We&&Ee(localStorage.getItem("filters"))&&"null"!=localStorage.getItem("filters"))-1==JSON.parse(localStorage.getItem("filters")).badges.indexOf(M.id)&&(S=!1);var L=Pe({id:"badgeCB_"+M.id,checked:S,label:Y[f].name,onChange:he,value:M.id});x.append(L)}t.append(x)}var T=_('<fieldset id="ecmFiltersMapSettings" class="ecm-filters"></fieldset>');T.append("<legend>"+ee[X.lan].mapSettings+"</legend>");var I=_('<div class="ecm-form-group"></div>');I.append('<label for="mapType">'+ee[X.lan].mapType+"</label><br />");for(var A=_('<select id="mapType"></select>'),O=0;O<X.mapTypes.length;O++){var Z=X.mapTypes[O],P=_("<option></option>");P.attr("value",Z),P.text(ee[X.lan][Z]),X.mapTypeId==Z&&P.prop("selected",!0),A.append(P)}if(Ee(X.mapLayers))for(var F in X.mapLayers)if(X.mapLayers.hasOwnProperty(F)){var z=X.mapLayers[F].checked;We&&localStorage.getItem("mapLayer")==X.mapLayers[F].name&&(z=!0);var U=_("<option></option>");U.attr("value",F),U.text(ee[X.lan][X.mapLayers[F].name]),z&&U.prop("selected",!0),A.append(U)}I.append(A),A.change(function(){-1!=X.mapTypes.indexOf(_(this).val())?(fe(),V.setOptions({mapTypeId:_(this).val()}),We&&localStorage.setItem("mapTypeId",_(this).val())):function(e,t){var d=X.mapLayers[e],p=new google.maps.LatLngBounds(new google.maps.LatLng(d.bounds[1],d.bounds[0]),new google.maps.LatLng(d.bounds[3],d.bounds[2]));if(t){_("#ecmFiltersLayers").addClass("loading"),_("#ecmFiltersLayers .ecm-checkbox").each(function(){_(this).val()!=e&&_(this).prop("checked",!1)}),V.overlayMapTypes.setAt(0,null),X.mapMinZoom<d.minZoom&&(_("#zoom").attr("min",d.minZoom),V.setOptions({minZoom:d.minZoom})),X.mapMaxZoom>d.maxZoom&&(_("#zoom").attr("max",d.maxZoom),V.setOptions({maxZoom:d.maxZoom}));var a=new google.maps.ImageMapType({name:d.name,minZoom:d.minZoom,maxZoom:d.maxZoom,tileSize:new google.maps.Size(256,256),isPng:!0,opacity:1,getTileUrl:function(e,t){var a=V.getProjection(),r=Math.pow(2,t),i=256/r,o=256/r,n=new google.maps.LatLngBounds(a.fromPointToLatLng(new google.maps.Point(e.x*i,(e.y+1)*o)),a.fromPointToLatLng(new google.maps.Point((e.x+1)*i,e.y*o))),l=0<=e.x?e.x:r+e.x,s=e.y;if(p.intersects(n)&&t>=d.minZoom&&t<=d.maxZoom){var c=d.url.replace("{zoom}",t);return c=(c=c.replace("{x}",l)).replace("{y}",s)}}});a.addListener("tilesloaded",function(){_("#ecmFiltersLayers").removeClass("loading")}),V.overlayMapTypes.insertAt(0,a),We&&localStorage.setItem("mapLayer",d.name)}else fe()}(_(this).val(),!0)}),T.append(I);var B=_('<div class="ecm-form-group"></div>');B.append('<label for="zoom">'+ee[X.lan].mapZoom+"</label><br />"),B.append('<div class="ecm-range-labels"><span class="pull-left">-</span><span id="zoomVal">'+V.getZoom()+'</span><span class="pull-right">+</span></div>');var N=_('<input id="zoom" type="range" step="1" />');N.attr("min",X.mapMinZoom),N.attr("max",X.mapMaxZoom),B.append(N),N.val(V.getZoom()),N.on("input",function(){V.setZoom(parseInt(_(this).val())),_("#zoomVal").text(_(this).val())}),T.append(B);var j=Ze({id:"myLocationBtn",icon:"icon-location.svg",name:"location",className:"ecm-btn-icon-text ecm-btn-block",text:ee[X.lan].myLocationShow,onClick:function(){W()}}),E=Pe({id:"followUserCB",checked:$,label:ee[X.lan].myLocationCenter,onChange:function(){($=_(this).prop("checked"))&&V.panTo(H)}});for(var b in E.hide(),T.append(j),T.append(E),t.append(T),_("#ecm").append(t),he(),X.externalMarkers)X.externalMarkers.hasOwnProperty(b)&&_("#"+b).prop("checked")&&D(b);_("#mapType").trigger("change")},Ae=function(){var e=[];for(var t in q)if(q.hasOwnProperty(t))for(var a=0;a<q[t].length;a++)e.push(q[t][a]);return e},Oe=function(e){var t=[];if(Array.isArray(e))for(var a=0;a<e.length;a++)t.push({lat:e[a][1],lng:e[a][0]});return t},Ze=function(e){var t={className:null,disabled:!1,icon:null,id:null,name:null,onClick:null,size:null,text:null,tooltip:null};_.extend(t,e);var a,r=_('<button type="button" class="ecm-btn"></button>');if(t.disabled&&r.prop("disabled",!0),t.id&&r.attr("id",t.id),t.size&&r.addClass("ecm-btn-"+t.size),t.name&&r.addClass("ecm-btn-"+t.name),t.className&&r.addClass(t.className),t.icon)if(Array.isArray(t.icon))for(var i=0;i<t.icon.length;i++)a=_('<svg data-src="'+v+"images/"+t.icon[i]+'"></svg>'),r.append(a);else a=_('<svg data-src="'+v+"images/"+t.icon+'"></svg>'),r.append(a);return t.text&&r.append(t.text),t.onClick&&r.click(t.onClick),r},Pe=function(e){var t={checked:!1,className:null,data:null,groupClass:null,id:null,label:null,labelPre:null,name:null,onChange:null,tooltip:null,value:null};_.extend(t,e);var a=_('<div class="ecm-form-group-cb"></div>');if(t.labelPre){var r=_("<label></label>");r.text(t.labelPre),a.append(r)}var i=_('<input type="checkbox" class="ecm-checkbox" />');if(i.attr("id",t.id),i.attr("value",t.value),t.name&&i.attr("name",t.name),t.className&&i.addClass(t.className),t.groupClass&&a.addClass(t.groupClass),t.data)for(var o=0;o<t.data.length;o++)i.attr("data-"+t.data[o].name,t.data[o].value);if(t.checked&&i.prop("checked",!0),t.onChange&&i.change(t.onChange),a.append(i),t.label){var n=_("<label></label>");n.text(t.label),n.attr("for",t.id),a.append(n)}return a},Fe=function(){var e=document.querySelectorAll("svg[data-src]");SVGInjector(e,{evalScripts:!1,each:function(e){}},function(e){})},ze=function(){_("#ecm").prepend('<div class="ecm-loader"></div>')},Ue=function(){_("#ecm > .ecm-loader").remove()},Be=function(){0<_(X.offsetTopSel).length&&(document.getElementById("ecm").style.top=_(X.offsetTopSel).outerHeight()+"px")},Ne=function(t,e){return e.some(function(e){return 0<=t.indexOf(e)})},je=function(e){return/^((http|https):\/\/)|\/\//.test(e)},Ee=function(e){return"undefined"!==e&&null!==e&&""!=e},_e=function(e){if(null==e||null==e||""==e)return"";var t=new Date(e.replace(/-/g,"/"));return t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear()+" "+(("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2))},We=function(){var e="test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}},De=function(e){for(var t in c)if(c[t].id==e)return c[t].articleApiUrl;return!1},Je=function(e){for(var t in X.externalMarkers)if(X.externalMarkers.hasOwnProperty(t)&&X.externalMarkers[t].slug==e)return X.externalMarkers[t].articleApiUrl;return!1};return{init:function(){var e=document.createElement("div");if(e.id="ecmMap",document.getElementById("ecm").appendChild(e),"undefined"==typeof jQuery)throw new Error("ECM requires jQuery");if("undefined"==typeof SVGInjector&&(O.ecmSVGi={id:"ecmSVGi",file:v+"vendor/svg-injector-1.1.3/dist/svg-injector.min.js",elType:"script",loaded:!1}),n.getAttribute("data-lan")&&(X.lan=n.getAttribute("data-lan")),n.getAttribute("data-theme"))s=n.getAttribute("data-theme"),d=(K=v+"themes/"+s+"/")+s+".css",g=K+"config.js",u=K+"images/map-cluster.svg";else if(n.getAttribute("data-theme-key")){var t=n.getAttribute("data-theme-key");d=l+"?key="+t+"&type=css",g=l+"?key="+t+"&type=config",u=l+"?key="+t+"&type=mapCluster"}O.ecmThemeCss={id:"ecmThemeCss",file:d,elType:"link",loaded:!1},O.ecmThemeConfig={id:"ecmThemeConfig",file:g,elType:"script",loaded:!1},Z(),window.onpopstate=function(e){null!=e.state&&e.state.view?null!=e.state&&"article"==e.state.view?le("",e.state.articleApiUrl):null!=e.state&&e.state.view:_(".ecm-article-container").is(":visible")?(_(".ecm-article-container").remove(),ie(e.state)):_(".ecm-cards-container").is(":visible")&&(_(".ecm-cards-container").remove(),_("#ecmSettingsBtn").show(),ie(e.state))}},setConfig:function(e){for(var t in e)e.hasOwnProperty(t)&&(X[t]=e[t]);X.markersUrl&&(X.markersUrl=X.markersUrl.replace("{lan}",X.lan)),X.routesUrl&&(X.routesUrl=X.routesUrl.replace("{lan}",X.lan)),X.themeName&&(K=l+X.themeName+"/")},setTexts:function(e){for(var t in e)if(e.hasOwnProperty(t))for(var a=Object.getOwnPropertyNames(e[t]),r=0;r<a.length;r++)ee[t][a[r]]=e[t][a[r]]},convertLN2ECM:function(e,t){R[t]=[];for(var a=0;a<e.length;a++){e[a].images||(e[a].images={medium:e[a].thumbnail});var r="https://explori.es/fi/Article/"+e[a].id+"/"+e[a].slug,i="_blank",o=!0;X.externalMarkers[t].articleViewUrl&&(r=(r=(r=X.externalMarkers[t].articleViewUrl).replace("{id}",e[a].id)).replace("{slug}",e[a].slug),o=!(i="_self")),void 0!==X.externalMarkers[t].external&&(o=X.externalMarkers[t].external);var n={id:e[a].id,name:t,title:e[a].title,slug:e[a].slug,image:e[a].images.medium,logo:e[a].publication.image,color:e[a].publication.themeColor,latitude:parseFloat(e[a].latitude),longitude:parseFloat(e[a].longitude),url:r,target:i,icon:e[a].publication.marker,external:o};X.routing&&X.externalMarkers[t].slug&&X.externalMarkers[t].articleApiUrl&&(n.articleApiUrl=X.externalMarkers[t].articleApiUrl,n.articleApiUrl=n.articleApiUrl.replace("{id}",e[a].id)),R[t].push(n)}f(t)},convertRetkipaikka2ECM:function(t,e){R[e]=[],G[e]=[],pe(e),T[e]=[],I[e]=[];for(var a=0;a<t.length;a++){var r=!1;for(var i in R)if(R.hasOwnProperty(i)&&-1!=i.search("retkipaikka")&&i!=e&&(r=R[i].some(function(e){return e.id===t[a].id})))break;if(!r){t[a].images||(t[a].images={medium:t[a].thumbnail});var o,n,l,s,c=!0,d="https://kartta.retkipaikka.fi/assets/marker.png",p={esteeton:0,helppo:1,keskivaativa:2,vaativa:3,luokittelematon:4},m={esteeton:"#3c3",helppo:"#03c",keskivaativa:"#c33",vaativa:"#000",luokittelematon:"#cc3"};if(t[a].marker&&(d="https://kartta.retkipaikka.fi/assets/"+t[a].marker),null!=t[a].link&&t[a].link.search("retkipaikka.fi")&&(c=!1),void 0!==X.externalMarkers[e].external&&(c=X.externalMarkers[e].external),t[a].images[0]&&(t[a].images[0]=t[a].images[0].replace("http://","https://")),"Point"==t[a].geometry.type)o=parseFloat(t[a].geometry.coordinates[1]),n=parseFloat(t[a].geometry.coordinates[0]);else if("LineString"==t[a].geometry.type)o=parseFloat(t[a].geometry.coordinates[0][1]),n=parseFloat(t[a].geometry.coordinates[0][0]),s=Oe(t[a].geometry.coordinates),l={id:t[a].id,title:t[a].title,image:t[a].images[0],polylineOptions:{strokeColor:"#0099ff",strokeOpacity:1,strokeWeight:5},waypoints:s},Ee(t[a].route_difficulty)&&(l.badges=[{id:p[t[a].route_difficulty],name:t[a].route_difficulty[0].toUpperCase()+t[a].route_difficulty.substring(1)}],l.polylineOptions.strokeColor=m[t[a].route_difficulty]),G[e].push(l),h(e,G[e].length-1);else if("MultiLineString"==t[a].geometry.type){o=parseFloat(t[a].geometry.coordinates[0][0][1]),n=parseFloat(t[a].geometry.coordinates[0][0][0]);for(var g=0;g<t[a].geometry.coordinates.length;g++)s=Oe(t[a].geometry.coordinates[g]),l={id:t[a].id,title:t[a].title,image:t[a].images[0],polylineOptions:{strokeColor:"#0099ff",strokeOpacity:1,strokeWeight:5},waypoints:s},Ee(t[a].route_difficulty)&&(l.badges=[{id:p[t[a].route_difficulty],name:t[a].route_difficulty[0].toUpperCase()+t[a].route_difficulty.substring(1)}],l.polylineOptions.strokeColor=m[t[a].route_difficulty]),G[e].push(l),h(e,G[e].length-1)}var u={id:t[a].id,name:e,title:t[a].title,image:t[a].images[0],logo:null,color:null,latitude:o,longitude:n,url:t[a].link,target:"_blank",icon:d,external:c};R[e].push(u)}}f(e)}}}(jQuery);
