var ECM=function(D){"use strict";var e=document.getElementById("ecmScript");var h=e.src.replace(/js\/(ECM.js|ECM.min.js).*$/,"");var t=e.src.replace(/explories-custom-map\/js\/(ECM.js|ECM.min.js).*$/,"");var n=document.getElementById("ecm");var r="https://ecm.explories.net/themes/";var i="default";var V=h+"themes/"+i+"/";var o=V+i+".css";var l=V+"config.js";var s=V+"images/map-cluster.svg";var a=V+"images/default-img.jpg";var c;var d;var p;var v={};var k={};var m=[];var G;var g;var u;var f;var y=[];var b=[];var w=[];var x={};var C=null;var M=[];var S=[];var L=[];var T=[];var I=[];var A=[];var O=[];var J=[];var K=[];var F=null;var H;var Z;var P;var R=false;var U={ecmMarkerClusterer:{id:"ecmMarkerClusterer",file:h+"vendor/markerclusterer-1.0.1/markerclusterer.min.js",elType:"script",loaded:false}};var q={baseTheme:null,themeName:null,routing:false,ecmUrl:null,ecmTitle:null,markersUrl:"markers.json",routesUrl:"routes.json",lan:"fi",initLocation:{lat:60.169872,lng:24.938099},cardDefaultImg:a,externalMarkers:null,mapDefaultTravelMode:"WALKING",mapInitZoom:10,mapMinZoom:0,mapMaxZoom:21,mapLayers:null,mapTypeId:"terrain",mapTypes:["roadmap","satellite","hybrid","terrain"],mapRouteMarkersThreshold:12,markerClustererOptions:{gridSize:56,zoomOnClick:false,minimumClusterSize:2,textColor:"white",textSize:10,width:32,height:32},modes:null,offsetTop:"auto",offsetTopSel:"header",showBadgeFilters:true,showMapFeedToggle:true,showModeButtons:true,showPrint:false,showTagFilters:true,showTypeFilters:true,tagFiltersIcons:true,usePlugin:false,userPosInterval:5e3};var Q={en:{badgeFiltersLegend:"Badges",hybrid:"Hybrid",mapLayers:"Map layers",mapSettings:"Map settings",mapType:"Map type",mapZoom:"Map zoom",marker:"Marker",myLocation:"My location",myLocationShow:"Show my location",myLocationCenter:"Center my location on map",roadmap:"Roadmap",route:"Route",satellite:"Satellite",shareArticle:"Share article",tagFiltersLegend:"Category",toggleTags:"Toggle all",typeFiltersLegend:"Type",terrain:"Terrain"},fi:{badgeFiltersLegend:"Badges",hybrid:"Hybridi",mapLayers:"Karttatasot",mapSettings:"Kartan asetukset",mapType:"Kartan tyyppi",mapZoom:"Kartan zoomaus",marker:"Kohde",myLocation:"Oma sijainti",myLocationShow:"Näytä sijaintini kartalla",myLocationCenter:"Keskitä kartta sijaintini mukaan",roadmap:"Tiekartta",route:"Reitti",satellite:"Satelliitti",shareArticle:"Jaa artikkeli",tagFiltersLegend:"Kategoria",toggleTags:"Valitse kaikki",typeFiltersLegend:"Tyyppi",terrain:"Maastokartta"}};var Y={markers:{id:1,name:"marker",show:true},routes:{id:2,name:"route",show:true}};var z=function(){var e=document.createElement("div");e.id="ecmMap";document.getElementById("ecm").appendChild(e);if(typeof jQuery==="undefined"){throw new Error("ECM requires jQuery")}if(typeof SVGInjector==="undefined"){U.ecmSVGi={id:"ecmSVGi",file:h+"vendor/svg-injector-1.1.3/dist/svg-injector.min.js",elType:"script",loaded:false}}if(n.getAttribute("data-lan")){q.lan=n.getAttribute("data-lan")}if(n.getAttribute("data-theme")){i=n.getAttribute("data-theme");V=h+"themes/"+i+"/";o=V+i+".css";l=V+"config.js";s=V+"images/map-cluster.svg"}else if(n.getAttribute("data-theme-key")){var a=n.getAttribute("data-theme-key");o=r+"?key="+a+"&type=css";l=r+"?key="+a+"&type=config";s=r+"?key="+a+"&type=mapCluster"}U.ecmThemeCss={id:"ecmThemeCss",file:o,elType:"link",loaded:false};U.ecmThemeConfig={id:"ecmThemeConfig",file:l,elType:"script",loaded:false};B();window.onpopstate=function(e){if(e.state==null||!e.state.view){if(D(".ecm-article-container").is(":visible")){D(".ecm-article-container").remove();ce(e.state)}else if(D(".ecm-cards-container").is(":visible")){D(".ecm-cards-container").remove();D("#ecmSettingsBtn").show();ce(e.state)}}else if(e.state!=null&&e.state.view=="article"){me("",e.state.articleApiUrl)}else if(e.state!=null&&e.state.view=="cluster"){}}};var B=function(){if(Object.keys(U).length==0){return}for(var e in U){if(U.hasOwnProperty(e)){var a=U[e];var t;if(D("#"+e).length>0){continue}if(a.elType=="script"){t=document.createElement("script");t.id=e;t.src=a.file;document.body.appendChild(t)}else if(a.elType=="link"){t=document.createElement("link");t.id=e;t.href=a.file;t.rel="stylesheet";document.body.appendChild(t)}t.onload=function(){N(this.id)}}}};var N=function(e){U[e].loaded=true;if(e=="ecmThemeConfig"&&q.usePlugin==true){U.ecmPluginConfig={id:"ecmPluginConfig",file:t+"assets/js/front.js",elType:"script",loaded:false};B()}for(var a in U){if(U.hasOwnProperty(a)){if(!U[a].loaded){return false}}}c=q.initMode;if(n.getAttribute("data-offset-top")){n.style.top=n.getAttribute("data-offset-top");q.offsetTop=n.getAttribute("data-offset-top")}else if(q.offsetTop=="auto"&&q.offsetTopSel!=null){Xe();D(window).resize(function(){Xe()})}else if(q.offsetTop!=null){document.getElementById("ecm").style.top=q.offsetTop}if(ia){if(localStorage.getItem("lat")&&localStorage.getItem("lng")){q.initLocation.lat=parseFloat(localStorage.getItem("lat"));q.initLocation.lng=parseFloat(localStorage.getItem("lng"))}if(localStorage.getItem("mapInitZoom")){q.mapInitZoom=parseInt(localStorage.getItem("mapInitZoom"))}if(localStorage.getItem("types")){Y=JSON.parse(localStorage.getItem("types"))}}if(q.baseTheme){n.className=q.baseTheme}_();return true};var j=function(e){for(var a in e){if(e.hasOwnProperty(a)){q[a]=e[a]}}if(q.markersUrl){q.markersUrl=q.markersUrl.replace("{lan}",q.lan)}if(q.routesUrl){q.routesUrl=q.routesUrl.replace("{lan}",q.lan)}if(q.themeName){V=r+q.themeName+"/"}};var E=function(e){for(var a in e){if(e.hasOwnProperty(a)){var t=Object.getOwnPropertyNames(e[a]);for(var r=0;r<t.length;r++){Q[a][t[r]]=e[a][t[r]]}}}};var _=function(){g=document.getElementById("ecmMap");u={center:q.initLocation,zoom:q.mapInitZoom,minZoom:q.mapMinZoom,maxZoom:q.mapMaxZoom,zoomControl:false,scaleControl:true,mapTypeId:q.mapTypeId,streetViewControl:false,fullscreenControl:false,mapTypeControl:false,gestureHandling:"greedy",styles:q.modes[q.initMode].styles};G=new google.maps.Map(g,u);f=new google.maps.InfoWindow({maxWidth:320,content:""});G.addListener("zoom_changed",function(){ye();D("#zoom").val(G.getZoom());D("#zoomVal").text(G.getZoom());be();if(ia){localStorage.setItem("mapInitZoom",G.getZoom())}});G.addListener("idle",function(){for(var e in q.externalMarkers){if(q.externalMarkers.hasOwnProperty(e)){if(q.externalMarkers[e].reloadOnBoundsChange&&D("#"+e).prop("checked")){D("#"+e).trigger("change")}}}if(ia){localStorage.setItem("lat",G.getCenter().lat());localStorage.setItem("lng",G.getCenter().lng())}});G.addListener("click",function(e){f.close()});google.maps.LatLng.prototype.kmTo=function(e){var a=Math,t=a.PI/180;var r=this.lat()*t,i=e.lat()*t,n=r-i;var o=this.lng()*t-e.lng()*t;var l=2*a.asin(a.sqrt(a.pow(a.sin(n/2),2)+a.cos(r)*a.cos(i)*a.pow(a.sin(o/2),2)));return l*6378.137};google.maps.Polyline.prototype.getLengthInMeters=function(e){var a=this.getPath(e),t=a.getLength(),r=0;for(var i=0;i<t-1;i++){r+=a.getAt(i).kmTo(a.getAt(i+1))}return r*1e3};google.maps.event.addListenerOnce(G,"idle",function(){Ne();X();te()})};var $=function(){if(!navigator.geolocation){console.error("Unable to get user location because geolocation is not supported by browser.");return}if(H){G.panTo(H);return}D("#myLocationBtn").prop("disabled",true);D(".ecm-btn-location").prop("disabled",true);D("#myLocationBtn").addClass("ecm-btn-loading");D(".ecm-btn-location").addClass("ecm-btn-loading");var e={enableHighAccuracy:true};var a=function(e){H={lat:e.coords.latitude,lng:e.coords.longitude};P=new google.maps.Marker({position:H,map:G,optimized:false,icon:{path:"M-20,0a20,20 0 1,0 40,0a20,20 0 1,0 -40,0",fillColor:"#06c",fillOpacity:1,strokeWeight:2,strokeColor:"#ffffff",scale:.4},title:"Your location"});if(!G.getBounds().contains(H)){ze()}D("#followUserCB").parent().show();Z=setTimeout(W,q.userPosInterval);D("#myLocationBtn").removeClass("ecm-btn-loading");D("#myLocationBtn").hide();D(".ecm-btn-location").removeClass("ecm-btn-loading");D(".ecm-btn-location").prop("disabled",false)};var t=function(e){D("#myLocationBtn").removeClass("ecm-btn-loading");D(".ecm-btn-location").removeClass("ecm-btn-loading");D("#myLocationBtn").prop("disabled",false);D(".ecm-btn-location").prop("disabled",false);console.error("Getting user location failed: "+e)};navigator.geolocation.getCurrentPosition(a,t,e)};var W=function(){var e={enableHighAccuracy:true};var a=function(e){H={lat:e.coords.latitude,lng:e.coords.longitude};P.setPosition(H);if(R){G.panTo(H)}Z=setTimeout(W,q.userPosInterval)};var t=function(e){console.error("Updating user location failed.")};navigator.geolocation.getCurrentPosition(a,t,e)};var X=function(){qe();if(q.markersUrl===null){d=[];if(Array.isArray(p)){re()}return}var e=D.getJSON(q.markersUrl);e.done(function(e){d=e;oe();ie(d);if(Array.isArray(p)){re()}});e.fail(function(e,a,t){console.error("Loading markers failed: "+a+", "+t)})};var ee=function(r){var t=D("#"+r).parent();t.addClass("loading");var e=G.getBounds();var a=q.externalMarkers[r].url;var i=q.initLocation.lat;var n=q.initLocation.lat;if(G.getCenter().lat()){i=G.getCenter().lat();n=G.getCenter().lng()}a=a.replace("{lat}",i);a=a.replace("{lng}",n);a=a.replace("{north}",e.getNorthEast().lat());a=a.replace("{east}",e.getNorthEast().lng());a=a.replace("{south}",e.getSouthWest().lat());a=a.replace("{west}",e.getSouthWest().lng());if(m[r]){m[r].abort()}m[r]=D.getJSON(a);m[r].done(function(e){t.removeClass("loading");var a=q.externalMarkers[r].callbackName;window["ECM"][a].call(this,e,r)});m[r].fail(function(e,a,t){if(t!="abort"){console.error("Loading "+r+" failed: "+a+", "+t)}})};var ae=function(e){delete v[e];x[e]=ne(x[e]);delete x[e];de();delete k[e];he(e);if(D(".ecm-feed").length>0){ue(false);ue(true)}};var te=function(){qe();if(q.routesUrl===null){p=[];if(Array.isArray(d)){re()}return}var e=D.getJSON(q.routesUrl);e.done(function(e){p=e;for(var a in p){if(ta(p[a])){if(p[a].travelMode){var t=Ue(p[a]);fe(a,t,p[a].polylineOptions)}else{Ae(a)}}else{p.splice(a,1)}}ie(p);if(Array.isArray(d)){re()}});e.fail(function(e,a,t){console.error("Loading routes failed: "+a+", "+t)})};var re=function(){ke();je();Ee();Re();if(n.getAttribute("data-feed")){D("#ecmSettingsBtn").trigger("click");D("#feedCB").trigger("click")}else{setTimeout(function(){D("#ecmSettingsBtn").trigger("click")},500)}if(n.getAttribute("data-article")&&n.getAttribute("data-article-api-url")){me(n.getAttribute("data-article"),n.getAttribute("data-article-api-url"))}else if(n.getAttribute("data-article")){me(n.getAttribute("data-article"),null)}if(q.routing){var e=window.location.href;e=e.replace(q.ecmUrl,"");if(ta(e)&&e!="/"){var a=e.split("/");var t;var r;var i;if(D.isNumeric(a[0])){r=parseInt(a[0]);i=na(r)}else{t=a[0];r=a[1];i=oa(t)}if(i){i=i.replace("{id}",r);me("",i)}}}Qe()};var ie=function(t){for(var r=0;r<t.length;r++){if(t[r].tags&&t[r].tags!=null){for(var i=0;i<t[r].tags.length;i++){var e=function e(a){return a.id===t[r].tags[i].id};if(!J.some(e)){J.push(t[r].tags[i])}}}if(t[r].badges&&t[r].badges!=null){for(var n=0;n<t[r].badges.length;n++){var a=function e(a){return a.id===t[r].tags[n].id};if(!K.some(a)){K.push(t[r].badges[n])}}}}};var ne=function(e){if(Array.isArray(e)){for(var a=0;a<e.length;a++){e[a].setMap(null)}}return[]};var oe=function(){w=ne(w);if(!Y.markers.show){return}for(var e in d){if(!Ie(d[e])){continue}if(F===null||F!==null&&!Te(d[e])){continue}var a={lat:d[e].latitude,lng:d[e].longitude};if(!aa(d[e].icon)){d[e].icon=V+"images/markers/"+d[e].icon}var t=new google.maps.MarkerImage(d[e].icon,null,null,null,new google.maps.Size(32,32));var r=new google.maps.Marker({index:parseInt(e),id:d[e].id,position:a,map:G,icon:t,optimized:true});r.addListener("click",function(){var e=d[this.index];f.setContent(Be(e));f.open(G,this);google.maps.event.clearListeners(f,"domready");if(q.routing&&e.slug&&e.articleApiUrl){f.addListener("domready",function(){D(".gm-style-iw .ecm-card").click(function(e){e.preventDefault();var a={view:"article",sourceSlug:D(this).attr("data-article-source"),articleId:D(this).attr("data-article-id"),articleSlug:D(this).attr("data-article-slug"),articleApiUrl:D(this).attr("data-article-api-url"),title:D(this).find("h1").text()};se(a);me("",a.articleApiUrl)})})}});w.push(r)}de()};var le=function(a){x[a]=[];for(var e=0;e<v[a].length;e++){var t=v[a][e];var r=q.externalMarkers[a].iconW;var i=q.externalMarkers[a].iconH;var n={lat:t.latitude,lng:t.longitude};var o=new google.maps.Size(r,i);if(typeof r==="undefined"||typeof i==="undefined"||r==null||i==null){o=null}var l=new google.maps.MarkerImage(t.icon,null,null,null,o);var s=new google.maps.Marker({index:parseInt(e),external:true,id:t.id,name:t.name,position:n,map:G,icon:l,optimized:true});s.addListener("click",function(){var e=v[a][this.index];f.setContent(Be(e));f.open(G,this);google.maps.event.clearListeners(f,"domready");if(e.name&&q.routing&&q.externalMarkers[e.name].slug&&q.externalMarkers[e.name].articleApiUrl){f.addListener("domready",function(){D(".gm-style-iw .ecm-card").click(function(e){e.preventDefault();var a={view:"article",sourceSlug:D(this).attr("data-article-source"),articleId:D(this).attr("data-article-id"),articleSlug:D(this).attr("data-article-slug"),articleApiUrl:D(this).attr("data-article-api-url"),title:D(this).find("h1").text()};se(a);me("",a.articleApiUrl)})})}});x[a].push(s)}de();if(D(".ecm-feed").length>0){ue(false);ue(true)}};var se=function(e){if(q.routing){var a="";if(e.sourceSlug){a=e.sourceSlug+"/"}if(e.articleId){a+=e.articleId+"/"}if(e.articleSlug){a+=e.articleSlug+"/"}if(a==""){a=q.ecmUrl}history.pushState(e,"",a);ce(e)}};var ce=function(e){if(e.title){D("title").text(e.title+" - "+q.ecmTitle)}else{D("title").text(q.ecmTitle)}};var de=function(){if(C!==null){C.clearMarkers()}var e=[{textColor:q.markerClustererOptions.textColor,textSize:q.markerClustererOptions.textSize,url:s,width:q.markerClustererOptions.width,height:q.markerClustererOptions.height}];var a={gridSize:q.markerClustererOptions.gridSize,zoomOnClick:q.markerClustererOptions.zoomOnClick,minimumClusterSize:q.markerClustererOptions.minimumClusterSize,styles:e};var t=_e();try{C=new MarkerClusterer(G,w.concat(S,t),a)}catch(e){alert("Unable to load MarkerClusterer. If you are using private browsing please disable it.");throw new Error("MarkerClusterer is undefined. Probably caused by private browsing mode.")}google.maps.event.addListener(C,"clusterclick",function(e){pe(e.getMarkers())})};var pe=function(e){var a=D('<div class="ecm-cards-container"></div>');a.click(function(){a.remove();D("#ecmSettingsBtn").show()});var t=Je({icon:"icon-close.svg",name:"close",onClick:function(){a.remove();D("#ecmSettingsBtn").show()},size:32});var r=D('<div class="ecm-cards"></div>');for(var i=0;i<e.length;i++){var n=e[i].index;var o=d[n];if(e[i].external){o=v[e[i].name][n]}if(e[i].route){o=p[n]}r.append(Be(o))}r.find(".ecm-card").click(function(e){e.stopPropagation();if(D(this).attr("data-article-api-url")){e.preventDefault();var a={view:"article",sourceSlug:D(this).attr("data-article-source"),articleId:D(this).attr("data-article-id"),articleSlug:D(this).attr("data-article-slug"),articleApiUrl:D(this).attr("data-article-api-url"),title:D(this).find("h1").text()};se(a);me("",a.articleApiUrl)}});a.append(t);a.append(r);D("#ecm").append(a);Re();D("#ecmSettingsBtn").hide();se({view:"cluster"})};var me=function(e,a){var t="https://explori.es/api/news/";if(a!=null){t=a}D(".ecm-article-container").remove();var d=D('        <div class="ecm-article-container">            <div class="ecm-article">                <div class="ecm-loader"></div>            </div>        </div>');var r=Je({icon:"icon-close.svg",name:"close-article",size:48});r.css("top",D("#ecm").css("top"));d.prepend(r);d.click(ge);D("#ecm").append(d);Re();var i=D.getJSON(t+e);i.done(function(e){var a=D('<div class="ecm-article-logo"></div>');var t=D('<div class="ecm-article-img"></div>');var r=D('<div class="ecm-article-img-caption"></div>');var i=D("<h1>"+e.title+"</h1>");var n=D('<div class="ecm-article-body"></div>');if(e.text){n.html(e.text)}else if(e.content){n.html(e.content)}if(typeof e.publication!=="undefined"&&ta(e.publication.image)){a.css("background-image","url('"+e.publication.image+"')");if(ta(e.publication.themeColor)){a.css("background-color",e.publication.themeColor)}D(".ecm-article").append(a)}if(e.caption&&ta(e.caption)){r.append("<p>"+e.caption+"</p>");t.append(r)}if(typeof e.images!=="undefined"&&ta(e.images.large)){t.css("background-image","url('"+e.images.large+"')");D(".ecm-article").append(t)}else if(ta(e.image)){t.css("background-image","url('"+e.image+"')");D(".ecm-article").append(t)}n.prepend(i);var o=D('<div class="ecm-article-info"></div>');var l="";if(e.authors&&ta(e.authors)){l=e.authors}else if(e.user&&ta(e.user.name)){l=e.user.name}if(ta(l)){o.append('<p class="ecm-article-author">'+l+"</p>")}o.append('<p class="ecm-article-datetime">'+ra(e.published)+"</p>");n.prepend(o);d.find(".ecm-article").append(n);D(".ecm-article").click(function(e){e.stopPropagation()});var s=D('            <ul class="ecm-share">                <li><a href="#" class="ecm-icon-facebook" target="_blank"><span class="sr-only">Share on Facebook</span></a></li>                <li><a href="#" class="ecm-icon-twitter" target="_blank"><span class="sr-only">Share on Twitter</span></a></li>                <li><a href="#" class="ecm-icon-linkedin" target="_blank"><span class="sr-only">Share on LinkedIn</span></a></li>            </ul>            ');var c=encodeURIComponent(window.location.href);s.find(".ecm-icon-facebook").attr("href","https://www.facebook.com/sharer.php?u="+c);s.find(".ecm-icon-twitter").attr("href","https://twitter.com/share?url="+c);s.find(".ecm-icon-linkedin").attr("href","https://www.linkedin.com/cws/share?url="+c);d.find(".ecm-article").append('<h2 class="ecm-share-h">'+Q[q.lan].shareArticle+"</h2>");d.find(".ecm-article").append(s);d.find(".ecm-loader").remove()});i.fail(function(e,a,t){console.error("Loading Explories article failed: "+a+", "+t)})};var ge=function(){D(".ecm-article-container").remove();if(q.routing){se({})}};var ue=function(e){if(!e){D(".ecm-feed").remove();return}var a=D('<div class="ecm-cards-container ecm-feed ecm-feed-condensed"></div>');var t=D('<div class="ecm-cards"></div>');if(Y["routes"].show){for(var r in p){if(!Ie(p[r])){continue}if(F!==null&&!Te(p[r])){continue}if(ta(p[r].url)){t.append(Be(p[r]))}}}var i=_e();var n=w.concat(i);for(var o=0;o<n.length;o++){var l=n[o].index;var s=d[l];if(n[o].external){s=v[n[o].name][l]}if(ta(s.url)){t.append(Be(s))}}t.find(".ecm-card").click(function(e){e.stopPropagation();if(D(this).attr("data-article-api-url")){e.preventDefault();var a={view:"article",sourceSlug:D(this).attr("data-article-source"),articleId:D(this).attr("data-article-id"),articleSlug:D(this).attr("data-article-slug"),articleApiUrl:D(this).attr("data-article-api-url"),title:D(this).find("h1").text()};se(a);me("",a.articleApiUrl)}});a.append(t);D("#ecm").append(a)};var fe=function(r,e,i){y[r]=new google.maps.DirectionsService;b[r]=new google.maps.DirectionsRenderer({routeIndex:Date.now(),suppressPolylines:true,suppressMarkers:G.getZoom()<q.mapRouteMarkersThreshold,suppressInfoWindows:false,preserveViewport:true,markerOptions:{icon:{path:"M-20,0a20,20 0 1,0 40,0a20,20 0 1,0 -40,0",fillColor:i.strokeColor,fillOpacity:1,strokeWeight:2,strokeColor:"#ffffff",scale:.4}}});b[r].setMap(G);y[r].route(e,function(e,a){if(a==="OK"){b[r].setDirections(e);var t=e.routes[0];p[r].length=Ze(t);p[r].duration=Pe(t);M[r]=e;Oe(r,e,i)}else{console.error("Directions request failed due to "+a)}})};var ve=function(){ne(S);for(var e=0;e<L.length;e++){if(Array.isArray(L[e])){for(var a=0;a<L[e].length;a++){L[e][a].setMap(null)}b[e].setMap(null)}else{if(L[e]){L[e].setMap(null)}if(T[e]){T[e].setMap(null)}}}};var he=function(e){if(I[e]){for(var a=0;a<I[e].length;a++){I[e][a].setMap(null);A[e][a].setMap(null)}}};var ke=function(){ve();ne(S);S=[];if(!Y.routes.show){return}for(var e=0;e<p.length;e++){if(!Ie(p[e])){continue}if(F===null||F!==null&&!Te(p[e])){continue}if(p[e].travelMode){Oe(e,M[e],p[e].polylineOptions)}else{Ae(e);if(ta(p[e].icon)){var a={lat:p[e].latitude,lng:p[e].longitude};if(!aa(p[e].icon)){p[e].icon=V+"images/markers/"+p[e].icon}var t=new google.maps.MarkerImage(p[e].icon,null,null,null,new google.maps.Size(32,32));var r=new google.maps.Marker({index:parseInt(e),id:p[e].id,position:a,map:G,icon:t,optimized:true,route:true});var i=e;r.addListener("click",function(e){var a=p[i];f.setContent(Be(a));f.setPosition(e.latLng);f.open(G)});S.push(r)}}}ye()};var ye=function(){for(var e in b){if(L[e]!==undefined&&L[e][0].getMap()!==null){b[e].setOptions({suppressMarkers:G.getZoom()<q.mapRouteMarkersThreshold});b[e].setMap(G)}}};var be=function(){if(q.mapLayers){for(var e=0;e<q.mapLayers.length;e++){var a=q.mapLayers[e];if(!a.minZoom||!a.maxZoom){return}var t=a.minZoom>G.getZoom()||a.maxZoom<G.getZoom();D("#ecmFiltersLayers input:eq("+e+")").prop("disabled",t)}}};var we=function(e,a){if(a){D("#ecmFiltersLayers").addClass("loading");var t=new google.maps.KmlLayer({url:q.mapLayers[e].url,map:G,preserveViewport:true});google.maps.event.addListener(t,"status_changed",function(){setTimeout(function(){D("#ecmFiltersLayers").removeClass("loading")},500)});O[e]=t}else{O[e].setMap(null)}};var xe=function(e,a){var d=q.mapLayers[e];var p=new google.maps.LatLngBounds(new google.maps.LatLng(d.bounds[1],d.bounds[0]),new google.maps.LatLng(d.bounds[3],d.bounds[2]));if(a){D("#ecmFiltersLayers").addClass("loading");D("#ecmFiltersLayers .ecm-checkbox").each(function(){if(D(this).val()!=e){D(this).prop("checked",false)}});G.overlayMapTypes.setAt(0,null);if(q.mapMinZoom<d.minZoom){D("#zoom").attr("min",d.minZoom);G.setOptions({minZoom:d.minZoom})}if(q.mapMaxZoom>d.maxZoom){D("#zoom").attr("max",d.maxZoom);G.setOptions({maxZoom:d.maxZoom})}var t=new google.maps.ImageMapType({name:d.name,minZoom:d.minZoom,maxZoom:d.maxZoom,tileSize:new google.maps.Size(256,256),isPng:true,opacity:1,getTileUrl:function(e,a){var t=G.getProjection();var r=Math.pow(2,a);var i=256/r;var n=256/r;var o=new google.maps.LatLngBounds(t.fromPointToLatLng(new google.maps.Point(e.x*i,(e.y+1)*n)),t.fromPointToLatLng(new google.maps.Point((e.x+1)*i,e.y*n)));var l=e.x>=0?e.x:r+e.x;var s=e.y;if(p.intersects(o)&&a>=d.minZoom&&a<=d.maxZoom){var c=d.url.replace("{zoom}",a);c=c.replace("{x}",l);c=c.replace("{y}",s);return c}}});t.addListener("tilesloaded",function(){D("#ecmFiltersLayers").removeClass("loading")});G.overlayMapTypes.insertAt(0,t);if(ia){localStorage.setItem("mapLayer",d.name)}}else{Ce()}};var Ce=function(){G.overlayMapTypes.setAt(0,null);D("#zoom").attr("min",q.mapMinZoom);D("#zoom").attr("max",q.mapMaxZoom);G.setOptions({minZoom:q.mapMinZoom,maxZoom:q.mapMaxZoom});if(ia){localStorage.removeItem("mapLayer")}};var Me=function(e){if(q.modes[e]===undefined){console.error("Invalid mode");return}c=e;u=q.modes[e].styles;G.setOptions({styles:u});oe();ke()};var Se=function(){D("#ecmFiltersTypes .ecm-checkbox").each(function(){var e=D(this).val();Y[e].show=D(this).is(":checked")});if(!Y["markers"].show){C.clearMarkers()}D("#ecmFiltersBadges").prop("disabled",!Y["routes"].show);D("#ecmFiltersBadges .ecm-checkbox").prop("disabled",!Y["routes"].show);var e=!Y["markers"].show&&!Y["routes"].show;D("#ecmFiltersTags").prop("disabled",e);D("#ecmFiltersTags .ecm-checkbox").prop("disabled",e);if(ia){localStorage.setItem("types",JSON.stringify(Y))}Le()};var Le=function(){F={tags:[],badges:[]};D("#ecmFiltersTags .ecm-checkbox:not(.ecm-toggle-all)").each(function(){if(D(this).prop("checked")){F.tags.push(parseInt(D(this).val()))}else{D("#toggleTagsCB").prop("checked",false)}});D("#ecmFiltersBadges .ecm-checkbox").each(function(){if(D(this).prop("checked")){F.badges.push(parseInt(D(this).val()))}});if(F.tags.length==0&&F.badges.length==0){F=null}if(ia){localStorage.setItem("filters",JSON.stringify(F))}oe();ke();de();if(D(".ecm-feed").length>0){ue(false);ue(true)}};var Te=function(e){var a=false;if(e.tags){var t=D.map(e.tags,function(e){return e.id});a=ea(F.tags,t)}if(e.badges){var r=D.map(e.badges,function(e){return e.id});if(a){a=ea(F.badges,r)}}return a};var Ie=function(e){if(e.modes){return e.modes.indexOf(c)!=-1}return true};var Ae=function(t){var e=p[t];if(!Array.isArray(e.waypoints)){return}var a=new google.maps.Polyline({path:e.waypoints,geodesic:true,strokeColor:"#ffffff",strokeOpacity:1,strokeWeight:8});var r=new google.maps.Polyline({path:e.waypoints,geodesic:true,strokeColor:e.polylineOptions.strokeColor,strokeOpacity:e.polylineOptions.strokeOpacity,strokeWeight:e.polylineOptions.strokeWeight});a.setMap(G);T[t]=a;r.setMap(G);L[t]=r;p[t].length=r.getLengthInMeters();google.maps.event.addListener(r,"click",function(e){var a=p[t];f.setContent(Be(a));f.setPosition(e.latLng);f.open(G)})};var Oe=function(t,e,a){var r=[];var i=e.routes[0].legs;for(var n=0;n<i.length;n++){var o=i[n].steps;for(var l=0;l<o.length;l++){var s=o[l].path;var c=new google.maps.Polyline(a);for(var d=0;d<s.length;d++){c.getPath().push(s[d])}r.push(c);c.setMap(G);google.maps.event.addListener(c,"click",function(e){var a=p[t];f.setContent(Be(a));f.setPosition(e.latLng);f.open(G)})}}L[t]=r};var Fe=function(t,r){var e=k[t][r];var a=new google.maps.Polyline({path:e.waypoints,geodesic:true,strokeColor:"#ffffff",strokeOpacity:1,strokeWeight:8});var i=new google.maps.Polyline({path:e.waypoints,geodesic:true,strokeColor:e.polylineOptions.strokeColor,strokeOpacity:e.polylineOptions.strokeOpacity,strokeWeight:e.polylineOptions.strokeWeight});a.setMap(G);A[t][r]=a;i.setMap(G);I[t][r]=i;k[t][r].length=i.getLengthInMeters();google.maps.event.addListener(i,"click",function(e){var a=k[t][r];f.setContent(Be(a));f.setPosition(e.latLng);f.open(G)})};var Ze=function(e){var a=0;for(var t=0;t<e.legs.length;++t){a+=e.legs[t].distance.value}return a};var Pe=function(e){var a=0;for(var t=0;t<e.legs.length;++t){a+=e.legs[t].duration.value}return a};var Ue=function(e){var a=e.waypoints[0];var t=e.waypoints[e.waypoints.length-1];var r=new google.maps.LatLng(a.lat,a.lng);var i=new google.maps.LatLng(t.lat,t.lng);var n=[];e.waypoints.shift();e.waypoints.pop();for(var o=0;o<e.waypoints.length;o++){n.push({location:new google.maps.LatLng(e.waypoints[o].lat,e.waypoints[o].lng)})}if(typeof e.travelMode==="undefined"){e.travelMode=q.mapDefaultTravelMode}return{origin:r,destination:i,waypoints:n,optimizeWaypoints:true,travelMode:e.travelMode}};var ze=function(){G.setZoom(G.getZoom()-1);google.maps.event.addListenerOnce(G,"idle",function(){if(!G.getBounds().contains(H)){ze()}})};var Be=function(e){var a;var t=D('<div class="ecm-card-wrapper text-center"></div>');var r=D('<a class="ecm-card"></a>');if(e.external){r.addClass("ecm-card-external");if(!e.articleApiUrl&&ta(e.url)){r.append('<div class="ecm-card-external-icon"></div>')}if(e.logo){var i=D('<div class="ecm-card-logo" style="background-image:url(\''+e.logo+"');\"></div>");if(e.color){i.css("background-color",e.color)}r.append(i)}}if(e.url){r.attr("href",e.url);if(e.target){r.attr("target",e.target)}}else if(e.articleApiUrl){r.attr("href","#")}else{r.addClass("ecm-card-no-link")}if(e.image||ta(q.cardDefaultImg)){var n=D('<div class="ecm-card-img-container"></div>');var o=D('<div class="ecm-card-img"></div>');if(e.image){if(!aa(e.image)){e.image=h+e.image}o.css("background-image","url('"+e.image+"')")}else{o.css("background-image","url('"+q.cardDefaultImg+"')");o.addClass("ecm-default-img")}n.append(o);r.append(n)}if(e.badges||e.length){var l=D('<div class="ecm-card-info"></div>')}if(e.badges){if(Array.isArray(e.badges)){for(var s=0;s<e.badges.length;s++){var c=D('<span class="ecm-card-badge">'+e.badges[s].name+"</span>");c.addClass("ecm-card-badge-"+e.badges[s].id);l.append(c)}}}if(e.length){var d=D('<span class="ecm-card-length">'+(e.length/1e3).toFixed(2)+" km</span>");l.append(d)}if(e.badges||e.length){r.append(l)}if(e.title){var p=D("<h1>"+e.title+"</h1>");r.append(p)}if(e.description){var m=D("<p>"+e.description+"</p>");r.append(m)}if(e.tags){if(Array.isArray(e.tags)){var g=D('<div class="ecm-card-tags"></div>');for(var u=0;u<e.tags.length;u++){if(!aa(e.tags[u].icon)){e.tags[u].icon=V+"images/markers/"+e.tags[u].icon}var f=D("<img />");f.attr("src",e.tags[u].icon);f.attr("alt",e.tags[u].name);g.append(f)}r.append(g)}}if(q.routing&&e.slug&&e.articleApiUrl){a=e.articleApiUrl.replace("{id}",e.id);r.attr("data-article-api-url",a);r.attr("data-article-id",e.id);r.attr("data-article-slug",e.slug)}if(e.name&&q.routing&&q.externalMarkers[e.name].slug&&q.externalMarkers[e.name].articleApiUrl){a=q.externalMarkers[e.name].articleApiUrl.replace("{id}",e.id);r.attr("data-article-api-url",a);r.attr("data-article-source",q.externalMarkers[e.name].slug);r.attr("data-article-id",e.id);r.attr("data-article-slug",e.slug)}t.append(r);if(e.hasGpx){var v=D('<a target="_blank" href="https://locations.explories.net/api/routes/'+e.id+'/gpx" class="ecm-btn gpx-button"><img src="'+h+'images/icon-download.svg" style="width: 24px; height: 24px; vertical-align: middle;" />GPX</a>');t.append(v)}return t[0].outerHTML};var Ne=function(){if(q.showModeButtons&&q.modes!==undefined&&q.modes!==null){var e=D('<div class="ecm-mode-buttons"></div>');for(var a in q.modes){if(q.modes.hasOwnProperty(a)){var t=q.modes[a];var r=D('<button type="button" class="ecm-btn">'+Q[q.lan][a]+"</button>");r.attr("id","ecm"+a.charAt(0).toUpperCase()+a.slice(1)+"Btn");r.attr("data-id",t.id);r.attr("data-mode",a);r.addClass("ecm-btn-"+a);if(a==q.initMode){r.addClass("ecm-btn-active")}r.click(function(){D(".ecm-mode-buttons .ecm-btn").removeClass("ecm-btn-active");D(this).addClass("ecm-btn-active");Me(D(this).attr("data-mode"))});e.append(r)}}D("#ecm").append(e)}};var je=function(){var e=D('<div class="ecm-map-controls"></div>');if(q.showPrint){var a=Je({icon:"icon-print.svg",name:"print",onClick:function(){window.print()},size:32});e.append(a)}var t=Je({icon:"icon-location.svg",name:"location",onClick:function(){$()},size:32});var r=Je({icon:"icon-plus.svg",name:"zoom-in",onClick:function(){G.setZoom(G.getZoom()+1)},size:32});var i=Je({icon:"icon-minus.svg",name:"zoom-out",onClick:function(){G.setZoom(G.getZoom()-1)},size:32});e.append(t);e.append(r);e.append(i);D("#ecm").append(e)};var Ee=function(){var e=Je({icon:["icon-settings.svg"],id:"ecmSettingsBtn",name:"settings",onClick:function(){D("#ecmSettings").toggleClass("ecm-panel-open");D(".ecm-feed").toggleClass("ecm-feed-condensed")},size:32});D("#ecm").append(e);var a=D('<div id="ecmSettings" class="ecm-panel ecm-panel-settings notranslate"></div>');var t=Je({icon:["icon-close.svg"],id:"ecmCloseSettingsBtn",name:"settings-close",onClick:function(){D("#ecmSettings").toggleClass("ecm-panel-open");D(".ecm-feed").toggleClass("ecm-feed-condensed")},size:32});a.append(t);if(q.showMapFeedToggle){var r=Ke({id:"feedCB",className:"ecm-switch",groupClass:"ecm-switch-group",label:"Feed",labelPre:"Map",onChange:function(){ue(D(this).prop("checked"))}});a.append(r)}if(q.showTypeFilters){var i=D('<fieldset id="ecmFiltersTypes" class="ecm-filters"></fieldset>');i.append("<legend>"+Q[q.lan].typeFiltersLegend+"</legend>");for(var n in Y){if(Y.hasOwnProperty(n)){var o=Y[n];var l=true;if(ia&&ta(localStorage.getItem("types"))){var s=JSON.parse(localStorage.getItem("types"));if(s[n].show==false){l=false}}var c=Ke({id:"typeCB_"+o.id,checked:l,label:Q[q.lan][o.name],onChange:function(){Se()},value:n});i.append(c)}}a.append(i)}if(q.showTagFilters){var d=D('<fieldset id="ecmFiltersTags" class="ecm-filters"></fieldset>');d.append("<legend>"+Q[q.lan].tagFiltersLegend+"</legend>");var p=Ke({id:"toggleTagsCB",className:"ecm-toggle-all",groupClass:"ecm-toggle-tags-group",checked:true,label:Q[q.lan].toggleTags,onChange:function(){D("#ecmFiltersTags .ecm-checkbox").prop("checked",D(this).prop("checked"));Le()}});if(q.tagFiltersIcons){p.addClass("ecm-toggle-all-icon")}d.append(p);for(var m=0;m<J.length;m++){var g=J[m];var u=true;if(ia&&ta(localStorage.getItem("filters"))&&localStorage.getItem("filters")!="null"){var f=JSON.parse(localStorage.getItem("filters"));if(f.tags.indexOf(g.id)==-1){u=false}}var v=Ke({id:"tagCB_"+g.id,checked:u,label:J[m].name,onChange:Le,value:g.id});if(q.tagFiltersIcons){v.addClass("ecm-form-group-cb-icon");if(aa(g.icon)){v.css("background-image","url('"+g.icon+"')")}else{v.css("background-image","url('"+V+"images/markers/"+g.icon+"')")}}d.append(v)}a.append(d)}if(Array.isArray(q.externalMarkersSets)&&q.externalMarkersSets.length>0){for(var h=0;h<q.externalMarkersSets.length;h++){var k=q.externalMarkersSets[h];var y="ecmFiltersExternalMarkers"+k.id[0].toUpperCase()+k.id.substring(1);var b=D('<fieldset id="'+y+'" class="ecm-filters"></fieldset>');b.append("<legend>"+Q[q.lan][k.id]+"</legend>");if(k.showToggleAll){var w=Ke({id:"toggleExternal"+k.id+"CB",className:"ecm-toggle-all",groupClass:"ecm-toggle-tags-group",checked:true,label:Q[q.lan].toggleTags,onChange:function(){var e=D(this).parent().parent();D(e).find(".ecm-checkbox:not(.ecm-toggle-all)").prop("checked",D(this).prop("checked"));D(e).find(".ecm-checkbox:not(.ecm-toggle-all)").trigger("change")}});if(q.tagFiltersIcons){w.addClass("ecm-toggle-all-icon")}b.append(w)}for(var x in q.externalMarkers){if(q.externalMarkers.hasOwnProperty(x)){if(q.externalMarkers[x].set==k.id){var C=q.externalMarkers[x].checked;if(ia&&ta(localStorage.getItem(x))){C=JSON.parse(localStorage.getItem(x))}var M=Ke({id:x,label:Q[q.lan][x],checked:C,onChange:function(){var e=D(this).parent().parent();if(D(this).prop("checked")){ee(D(this).attr("id"));if(D(e).find(".ecm-checkbox:not(.ecm-toggle-all):checked").length==D(e).find(".ecm-checkbox:not(.ecm-toggle-all)").length){D(e).find(".ecm-toggle-all").prop("checked",true)}}else{ae(D(this).attr("id"));D(e).find(".ecm-toggle-all").prop("checked",false)}if(ia){localStorage.setItem(D(this).attr("id"),D(this).prop("checked"))}},value:x});if(q.tagFiltersIcons){M.addClass("ecm-form-group-cb-icon");M.css("background-image","url('"+q.externalMarkers[x].filtersIcon+"')")}if(k.showToggleAll&&!q.externalMarkers[x].checked){b.find(".ecm-toggle-all").prop("checked",false)}b.append(M)}}}a.append(b)}}if(q.showBadgeFilters&&K.length>0){var S=D('<fieldset id="ecmFiltersBadges" class="ecm-filters"></fieldset>');S.append("<legend>"+Q[q.lan].badgeFiltersLegend+"</legend>");for(var h=0;h<K.length;h++){var L=K[h];var T=true;if(ia&&ta(localStorage.getItem("filters"))&&localStorage.getItem("filters")!="null"){var f=JSON.parse(localStorage.getItem("filters"));if(f.badges.indexOf(L.id)==-1){T=false}}var I=Ke({id:"badgeCB_"+L.id,checked:T,label:K[h].name,onChange:Le,value:L.id});S.append(I)}a.append(S)}var A=D('<fieldset id="ecmFiltersMapSettings" class="ecm-filters"></fieldset>');A.append("<legend>"+Q[q.lan].mapSettings+"</legend>");var O=D('<div class="ecm-form-group"></div>');O.append('<label for="mapType">'+Q[q.lan].mapType+"</label><br />");var F=D('<select id="mapType"></select>');for(var Z=0;Z<q.mapTypes.length;Z++){var P=q.mapTypes[Z];var U=D("<option></option>");U.attr("value",P);U.text(Q[q.lan][P]);if(q.mapTypeId==P){U.prop("selected",true)}F.append(U)}if(ta(q.mapLayers)){for(var z in q.mapLayers){if(q.mapLayers.hasOwnProperty(z)){var B=q.mapLayers[z].checked;if(ia&&localStorage.getItem("mapLayer")==q.mapLayers[z].name){B=true}var N=D("<option></option>");N.attr("value",z);N.text(Q[q.lan][q.mapLayers[z].name]);if(B){N.prop("selected",true)}F.append(N)}}}O.append(F);F.change(function(){if(q.mapTypes.indexOf(D(this).val())!=-1){Ce();G.setOptions({mapTypeId:D(this).val()});if(ia){localStorage.setItem("mapTypeId",D(this).val())}}else{xe(D(this).val(),true)}});A.append(O);var j=D('<div class="ecm-form-group"></div>');j.append('<label for="zoom">'+Q[q.lan].mapZoom+"</label><br />");j.append('<div class="ecm-range-labels"><span class="pull-left">-</span><span id="zoomVal">'+G.getZoom()+'</span><span class="pull-right">+</span></div>');var E=D('<input id="zoom" type="range" step="1" />');E.attr("min",q.mapMinZoom);E.attr("max",q.mapMaxZoom);j.append(E);E.val(G.getZoom());E.on("input",function(){G.setZoom(parseInt(D(this).val()));D("#zoomVal").text(D(this).val())});A.append(j);var _=Je({id:"myLocationBtn",icon:"icon-location.svg",name:"location",className:"ecm-btn-icon-text ecm-btn-block",text:Q[q.lan].myLocationShow,onClick:function(){$()}});var W=Ke({id:"followUserCB",checked:R,label:Q[q.lan].myLocationCenter,onChange:function(){R=D(this).prop("checked");if(R){G.panTo(H)}}});W.hide();A.append(_);A.append(W);a.append(A);D("#ecm").append(a);Le();for(var x in q.externalMarkers){if(q.externalMarkers.hasOwnProperty(x)){if(D("#"+x).prop("checked")){ee(x)}}}D("#mapType").trigger("change")};var _e=function(){var e=[];for(var a in x){if(x.hasOwnProperty(a)){for(var t=0;t<x[a].length;t++){e.push(x[a][t])}}}return e};var We=function(e,a){v[a]=[];for(var t=0;t<e.length;t++){if(!e[t].images){e[t].images={medium:e[t].thumbnail}}var r="https://explori.es/fi/Article/"+e[t].id+"/"+e[t].slug;var i="_blank";var n=true;if(q.externalMarkers[a].articleViewUrl){r=q.externalMarkers[a].articleViewUrl;r=r.replace("{id}",e[t].id);r=r.replace("{slug}",e[t].slug);i="_self";n=false}if(typeof q.externalMarkers[a].external!=="undefined"){n=q.externalMarkers[a].external}var o={id:e[t].id,name:a,title:e[t].title,slug:e[t].slug,image:e[t].images.medium,logo:e[t].publication.image,color:e[t].publication.themeColor,latitude:parseFloat(e[t].latitude),longitude:parseFloat(e[t].longitude),url:r,target:i,icon:e[t].publication.marker,external:n};if(q.routing&&q.externalMarkers[a].slug&&q.externalMarkers[a].articleApiUrl){o.articleApiUrl=q.externalMarkers[a].articleApiUrl;o.articleApiUrl=o.articleApiUrl.replace("{id}",e[t].id)}v[a].push(o)}le(a)};var De=function(e,a){var t;var r;var i=q.externalMarkers[a].filtersIcon;var n=q.externalMarkers[a].articleApiUrl;var o;var l;v[a]=[];k[a]=[];he(a);I[a]=[];A[a]=[];for(var s=0;s<e.places.length;s++){o="_blank";l=true;if(typeof q.externalMarkers[a].external!=="undefined"){l=q.externalMarkers[a].external}t={id:e.places[s].id,name:a,title:e.places[s].title,description:e.places[s].description,slug:e.places[s].slug,image:e.places[s].image,latitude:parseFloat(e.places[s].latitude),longitude:parseFloat(e.places[s].longitude),url:e.places[s].url,target:o,icon:i,external:l};if(ta(n)){t.articleApiUrl=n}v[a].push(t)}for(var s=0;s<e.routes.length;s++){o="_blank";l=true;if(typeof q.externalMarkers[a].external!=="undefined"){l=q.externalMarkers[a].external}t={id:e.routes[s].id,name:a,title:e.routes[s].title,slug:e.routes[s].slug,image:e.routes[s].image,latitude:parseFloat(e.routes[s].waypoints[0][0].lat),longitude:parseFloat(e.routes[s].waypoints[0][0].lng),url:e.routes[s].url,target:o,icon:i,external:l,hasGpx:e.routes[s].hasGpx};v[a].push(t);var c=e.routes[s].waypoints;for(var d=0;d<c.length;d++){r={id:e.routes[s].id,title:e.routes[s].title,image:e.routes[s].image,polylineOptions:{strokeColor:"#0099ff",strokeOpacity:1,strokeWeight:5},waypoints:c[d],hasGpx:e.routes[s].hasGpx};k[a].push(r);Fe(a,k[a].length-1)}}le(a)};var Ve=function(a,e){v[e]=[];k[e]=[];he(e);I[e]=[];A[e]=[];for(var t=0;t<a.length;t++){var r=false;for(var i in v){if(v.hasOwnProperty(i)&&i.search("retkipaikka")!=-1&&i!=e){r=v[i].some(function(e){return e.id===a[t].id});if(r){break}}}if(r){continue}if(!a[t].images){a[t].images={medium:a[t].thumbnail}}var n="_blank";var o=true;var l="https://kartta.retkipaikka.fi/assets/marker.png";var s;var c;var d;var p;var m={esteeton:0,helppo:1,keskivaativa:2,vaativa:3,luokittelematon:4};var g={esteeton:"#3c3",helppo:"#03c",keskivaativa:"#c33",vaativa:"#000",luokittelematon:"#cc3"};if(a[t].marker){l="https://kartta.retkipaikka.fi/assets/"+a[t].marker}if(a[t].link!=null&&a[t].link.search("retkipaikka.fi")){o=false}if(typeof q.externalMarkers[e].external!=="undefined"){o=q.externalMarkers[e].external}if(a[t].images[0]){a[t].images[0]=a[t].images[0].replace("http://","https://")}if(a[t].geometry.type=="Point"){s=parseFloat(a[t].geometry.coordinates[1]);c=parseFloat(a[t].geometry.coordinates[0])}else if(a[t].geometry.type=="LineString"){s=parseFloat(a[t].geometry.coordinates[0][1]);c=parseFloat(a[t].geometry.coordinates[0][0]);p=Ge(a[t].geometry.coordinates);d={id:a[t].id,title:a[t].title,image:a[t].images[0],polylineOptions:{strokeColor:"#0099ff",strokeOpacity:1,strokeWeight:5},waypoints:p};if(ta(a[t].route_difficulty)){d.badges=[{id:m[a[t].route_difficulty],name:a[t].route_difficulty[0].toUpperCase()+a[t].route_difficulty.substring(1)}];d.polylineOptions.strokeColor=g[a[t].route_difficulty]}k[e].push(d);Fe(e,k[e].length-1)}else if(a[t].geometry.type=="MultiLineString"){s=parseFloat(a[t].geometry.coordinates[0][0][1]);c=parseFloat(a[t].geometry.coordinates[0][0][0]);for(var u=0;u<a[t].geometry.coordinates.length;u++){p=Ge(a[t].geometry.coordinates[u]);d={id:a[t].id,title:a[t].title,image:a[t].images[0],polylineOptions:{strokeColor:"#0099ff",strokeOpacity:1,strokeWeight:5},waypoints:p};if(ta(a[t].route_difficulty)){d.badges=[{id:m[a[t].route_difficulty],name:a[t].route_difficulty[0].toUpperCase()+a[t].route_difficulty.substring(1)}];d.polylineOptions.strokeColor=g[a[t].route_difficulty]}k[e].push(d);Fe(e,k[e].length-1)}}var f={id:a[t].id,name:e,title:a[t].title,image:a[t].images[0],logo:null,color:null,latitude:s,longitude:c,url:a[t].link,target:n,icon:l,external:o};v[e].push(f)}le(e)};var Ge=function(e){var a=[];if(Array.isArray(e)){for(var t=0;t<e.length;t++){a.push({lat:e[t][1],lng:e[t][0]})}}return a};var Je=function(e){var a={className:null,disabled:false,icon:null,id:null,name:null,onClick:null,size:null,text:null,tooltip:null};D.extend(a,e);var t=D('<button type="button" class="ecm-btn"></button>');if(a.disabled){t.prop("disabled",true)}if(a.id){t.attr("id",a.id)}if(a.size){t.addClass("ecm-btn-"+a.size)}if(a.name){t.addClass("ecm-btn-"+a.name)}if(a.className){t.addClass(a.className)}if(a.icon){var r;if(Array.isArray(a.icon)){for(var i=0;i<a.icon.length;i++){r=D('<svg data-src="'+h+"images/"+a.icon[i]+'"></svg>');t.append(r)}}else{r=D('<svg data-src="'+h+"images/"+a.icon+'"></svg>');t.append(r)}}if(a.text){t.append(a.text)}if(a.onClick){t.click(a.onClick)}return t};var Ke=function(e){var a={checked:false,className:null,data:null,groupClass:null,id:null,label:null,labelPre:null,name:null,onChange:null,tooltip:null,value:null};D.extend(a,e);var t=D('<div class="ecm-form-group-cb"></div>');if(a.labelPre){var r=D("<label></label>");r.text(a.labelPre);t.append(r)}var i=D('<input type="checkbox" class="ecm-checkbox" />');i.attr("id",a.id);i.attr("value",a.value);if(a.name){i.attr("name",a.name)}if(a.className){i.addClass(a.className)}if(a.groupClass){t.addClass(a.groupClass)}if(a.data){for(var n=0;n<a.data.length;n++){i.attr("data-"+a.data[n].name,a.data[n].value)}}if(a.checked){i.prop("checked",true)}if(a.onChange){i.change(a.onChange)}t.append(i);if(a.label){var o=D("<label></label>");o.text(a.label);o.attr("for",a.id);t.append(o)}return t};var He=function(e){var a={title:null,className:null,buttons:[]};D.extend(a,e);var t=D('<div class="ecm-modal"></div>');return t};var Re=function(){var e=document.querySelectorAll("svg[data-src]");var a={evalScripts:false,each:function(e){}};SVGInjector(e,a,function(e){})};var qe=function(){D("#ecm").prepend('<div class="ecm-loader"></div>')};var Qe=function(){D("#ecm > .ecm-loader").remove()};var Ye=function(){D("#ecm").prepend('<div class="ecm-modal-overlay"></div>')};var $e=function(){D("#ecm > .ecm-modal-overlay").remove()};var Xe=function(){if(D(q.offsetTopSel).length>0){document.getElementById("ecm").style.top=D(q.offsetTopSel).outerHeight()+"px"}};var ea=function(a,e){return e.some(function(e){return a.indexOf(e)>=0})};var aa=function(e){var a=/^((http|https):\/\/)|\/\//;return a.test(e)};var ta=function(e){return e!==undefined&&e!==null&&e!=""};var ra=function(e){if(e==undefined||e==null||e==""){return""}var a=new Date(e.replace(/-/g,"/"));var t=a.getDate()+"."+(a.getMonth()+1)+"."+a.getFullYear();var r=("0"+a.getHours()).slice(-2)+":"+("0"+a.getMinutes()).slice(-2);return t+" "+r};var ia=function(){var e="test";try{localStorage.setItem(e,e);localStorage.removeItem(e);return true}catch(e){return false}};var na=function(e){for(var a in d){if(d[a].id==e){return d[a].articleApiUrl}}return false};var oa=function(e){for(var a in q.externalMarkers){if(q.externalMarkers.hasOwnProperty(a)){if(q.externalMarkers[a].slug==e){return q.externalMarkers[a].articleApiUrl}}}return false};return{init:z,setConfig:j,setTexts:E,convertLN2ECM:We,convertLocationsDB2ECM:De,convertRetkipaikka2ECM:Ve}}(jQuery);