var ECMAdminMap=function(){"use strict";function o(){if(n=document.getElementById(c.mapElId),a={center:c.initLocation,zoom:c.mapInitZoom,mapTypeId:c.mapTypeId,streetViewControl:!1,fullscreenControl:!1,mapTypeControl:!1,gestureHandling:"greedy",disableDoubleClickZoom:!0},t=new google.maps.Map(n,a),$(window).keydown(function(e){if(13==e.keyCode)return e.preventDefault(),!1}),"marker"==c.mode)void 0!==ecmWP_AdminMap.ecm&&null!==ecmWP_AdminMap.ecm&&void 0!==ecmWP_AdminMap.ecm.lat&&void 0!==ecmWP_AdminMap.ecm.lng&&(d({lat:parseFloat(ecmWP_AdminMap.ecm.lat),lng:parseFloat(ecmWP_AdminMap.ecm.lng)}),void 0!==ecmWP_AdminMap.ecm.coordinates&&($("#_ecm_coordinates").val(s()),$("#_ecm_map_placeholder code").text(s()))),google.maps.event.addListener(t,"click",function(e){d(e.latLng)}),google.maps.event.addListener(t,"dblclick",function(e){d(e.latLng)});else{if("route"!=c.mode)throw new Error('Invalid config.mode value. Valid values are "marker" or "route".');void 0!==ecmWP_AdminMap.ecm&&null!==ecmWP_AdminMap.ecm&&void 0!==ecmWP_AdminMap.ecm.mode&&void 0!==ecmWP_AdminMap.ecm.coordinates&&(ECMAdminMap.setConfig({mode:"route",route:{polylineOptions:{strokeColor:"#0099ff",strokeOpacity:1,strokeWeight:5},waypoints:ecmWP_AdminMap.ecm.coordinates}}),$("#_ecm_coordinates").val(JSON.stringify(ecmWP_AdminMap.ecm.coordinates,null,0)),$("#_ecm_map_placeholder code").text(JSON.stringify(ecmWP_AdminMap.ecm.coordinates,null,2))),null!=c.route&&p(c.route);var e=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYLINE,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_LEFT,drawingModes:["polyline"]}});e.addListener("overlaycomplete",function(e){null!=m&&(console.log("should clear overlay"),m.setMap(null),m=null),m=e.overlay}),e.addListener("polylinecomplete",function(e){var o=e.getPath().getArray();for(var n in l=[],o){var t=o[n];l.push({lat:t.lat(),lng:t.lng()})}$("#_ecm_coordinates").val(JSON.stringify(l,null,0)),$("#_ecm_map_placeholder code").text(JSON.stringify(l,null,2))}),e.setMap(t)}g()}var t,n,a,i,l,r,c={initLocation:{lat:parseFloat(ecmWP_AdminMap.lat),lng:parseFloat(ecmWP_AdminMap.lng)},mapElId:"ecm-map",mapTypeId:"roadmap",mapInitZoom:parseInt(ecmWP_AdminMap.zoom),mode:ecmWP_AdminMap.mode,route:null},m=null,d=function(e){i?(i.setPosition(e),$("#_ecm_coordinates").val(s()),$("#_ecm_map_placeholder code").text(s())):i=new google.maps.Marker({position:e,map:t,draggable:!0}),google.maps.event.addListener(i,"drag",function(e){$("#_ecm_coordinates").val(s()),$("#_ecm_map_placeholder code").text(s())}),google.maps.event.addListener(i,"dragend",function(e){$("#_ecm_coordinates").val(s()),$("#_ecm_map_placeholder code").text(s())})},p=function(e){var o=new google.maps.Polyline({path:e.waypoints,geodesic:!0,strokeColor:"#ffffff",strokeOpacity:1,strokeWeight:8}),n=new google.maps.Polyline({path:e.waypoints,geodesic:!0,strokeColor:e.polylineOptions.strokeColor,strokeOpacity:e.polylineOptions.strokeOpacity,strokeWeight:e.polylineOptions.strokeWeight});o.setMap(t),o,n.setMap(t),n},s=function(){return i?i.getPosition().lat()+","+i.getPosition().lng():null},g=function(){if(document.getElementById("ecmPacInput")){(r=document.getElementById("ecmPacInput")).value="";var a,n,o=new google.maps.places.Autocomplete(r);n=(a=r).addEventListener?a.addEventListener:a.attachEvent,a.addEventListener?a.addEventListener=e:a.attachEvent&&(a.attachEvent=e),o.addListener("place_changed",function(){var e=o.getPlace();e.geometry?(t.setCenter(e.geometry.location),"marker"==c.mode&&d(e.geometry.location)):console.error("No details available for input: '"+e.name+"'")})}function e(e,o){if("keydown"==e){var t=o;o=function(e){var o=0<$(".pac-item-selected").length;if(13==e.which&&!o){var n=$.Event("keydown",{keyCode:40,which:40});t.apply(a,[n])}t.apply(a,[e])}}n.apply(a,[e,o])}};return{init:o,getMarkerLocation:s,getRouteWaypoints:function(){return l},setConfig:function(e){for(var o in e)e.hasOwnProperty(o)&&(c[o]=e[o])},setMode:function(e){c.mode=e,i&&(i.setMap(null),i=null),o()}}}();
